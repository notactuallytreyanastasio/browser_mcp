import{_ as t,ay as e,g as a,az as n,bN as r,aQ as s,aJ as o,bO as i,bo as l,bP as c,bp as h,bQ as u,aA as g,n as d}from"./shell-2264602c.js";import{s as m}from"./icon-82dd10b4.js";class T extends m{constructor(){super(...arguments),this.translationContextValue=n,this.translationLanguage="",this.reportMetrics=!1,this.metricsScenario=r.PageLoad,this.objectTranslationCache=new Map,this._requestController=new s(this),this._isFetchingTranslations=!1,this.trackEvent=o,this.logError=t=>{i({error:t.error,metadata:t.metadata,element:this,componentName:this.tagName.toLowerCase()??this.constructor.name})}}updated(t){t.has("translationContextValue")&&this.onUpdateTranslationContextValue(t)}onUpdateTranslationContextValue(t){const e=t.get("translationContextValue"),a=this.translationContextValue.isTranslationActive,n=e?.isTranslationActive;try{void 0===n&&void 0!==a?this.metricsScenario=r.PageLoad:void 0!==a&&(this.metricsScenario=r.ToggleChange),!0!==n&&!0===a?this.onTranslationsEnabled():!1!==n&&!1===a&&this.onTranslationsDisabled()}catch(t){this.logError({error:t})}}async fetchRequestPartial(t,e){if(this._isFetchingTranslations)return null;try{this._isFetchingTranslations=!0;const a=await this._requestController.request(t,e),n=a?.text?await(a?.text()):"";this._isFetchingTranslations=!1;const r=n&&n.includes?.(l),s=n&&n.includes?.(c);return r&&this.logError({error:"base-translator: request partial error",metadata:{url:t,options:e}}),r||s?null:h(n)}catch(a){return this.logError({error:"base-translator: request partial error",metadata:{url:t,options:e}}),null}}saveElementsToCache(t,e){t.map((t=>{const a=t.getAttribute("id");if(a){const n=this.objectTranslationCache.get(a)||{},r={};t.querySelectorAll(`[${u.DATA_MT_TYPE}]`).forEach((t=>{const e=t.getAttribute(u.DATA_MT_TYPE);r[t.id]=e===u.TEXT_CONTENT?t.textContent||"":t.innerHTML})),e?n.translatedElement=r:n.originalElement=r,this.objectTranslationCache.set(a,n)}}))}updateTranslationCache(t,e){const a=this.objectTranslationCache.get(t),n=t=>!!t.originalElement||!!t.translatedElement;if(!a&&n(e))return void this.objectTranslationCache.set(t,e);const r={};e.originalElement&&!a.originalElement&&(r.originalElement=e.originalElement),e.translatedElement&&!a.translatedElement&&(r.translatedElement=e.translatedElement),n(r)&&this.objectTranslationCache.set(t,{...a,...r})}}t([e({context:g,subscribe:!0}),a()],T.prototype,"translationContextValue",void 0),t([d({type:String,attribute:"target-translation-language"})],T.prototype,"translationLanguage",void 0),t([d({type:Boolean,attribute:"report-metrics"})],T.prototype,"reportMetrics",void 0);export{T as B};
