import{a as t,ap as s,P as e,c as o,t as i,T as a,M as d,O as n,x as r,bG as c,_ as p,n as h,g as u,e as l}from"./shell-2264602c.js";import{c as m,I as y}from"./content-action-button-a25cd1f9.js";import{x as b,a1 as A,s as I}from"./icon-82dd10b4.js";import{P,b as v,g}from"./utils-19e4b642.js";var w;let k=w=class extends(t(I)){constructor(){super(...arguments),this.authorId="",this.postId="",this.subredditName="",this.viewType=s.CardView,this.isLoaded=!1,this.hasAnalytics=!1,this.promotedAdAccounts=[],this.pubsub=new e(this),this.handlePromotePostSuccess=({adAccount:t,postId:e})=>{if(e===this.postId&&this.viewType===s.CardView){this.hasAnalytics||(this.hasAnalytics=!0);this.promotedAdAccounts.find((s=>s.id===t.id))||this.promotedAdAccounts.push(t)}},this.handleClick=()=>{this.viewType===s.CardView&&this.hasAnalytics?this.dispatchEvent(o("toggle-promote-post-insights",{promotedAdAccounts:this.promotedAdAccounts})):this.identity&&P.activateAndOpenPromotePostModal({postId:this.postId,postType:this.postType,subredditName:this.subredditName,identity:this.identity}),this.trackEvent(v({source:"post",action:"click",noun:"promote_button"},this.postId,this.subredditName))}}static get styles(){return[i]}async connectedCallback(){super.connectedCallback?.(),this.pubsub.subscribe(a.PromotePostSuccess,this.handlePromotePostSuccess,!1);const t=d({operation:n.BoostedPostAdInsights,variables:{profileId:this.authorId,postId:this.postId,includeIdentity:!w.queryWithIdentityPromise,includeAdAccounts:!w.queryWithIdentityPromise}});w.queryWithIdentityPromise||(w.queryWithIdentityPromise=t);const s=await w.queryWithIdentityPromise,{adAccounts:e,email:o,isOnboarded:i}=g(s);this.identity={adAccounts:e,email:o,isOnboarded:i};const r=await t;if(r.data.adInsights){this.hasAnalytics=!!r.data.adInsights.edges.length;const t=new Set(r.data.adInsights.edges.map((t=>t?.node?.adAccountId)));this.promotedAdAccounts=Array.from(t).map((t=>e.find((s=>s.id===t))))}this.trackEvent(v({source:"post",action:"view",noun:"promote_button"},this.postId,this.subredditName)),this.isLoaded=!0}async disconnectedCallback(){super.disconnectedCallback?.(),this.pubsub.unsubscribe(a.PromotePostSuccess,this.handlePromotePostSuccess)}createRenderRoot(){return this}render(){return b`<span class="relative"> ${m({appearance:"plain",leadingIcon:A({size:y[r.Small],attributes:{className:"icon-promote-post","aria-hidden":"true"}}),attributes:{name:"promote-post-button","data-post-click-location":c.PROMOTE_POST_BUTTON,onclick:this.handleClick,className:"ml-auto mr-0",disabled:!this.isLoaded},size:r.Small,screenReaderContent:"Promote Post"})} </span>`}};p([h({attribute:"author-id"})],k.prototype,"authorId",void 0),p([h({attribute:"post-id"})],k.prototype,"postId",void 0),p([h({attribute:"post-type"})],k.prototype,"postType",void 0),p([h({attribute:"subreddit-name"})],k.prototype,"subredditName",void 0),p([h({attribute:"view-type"})],k.prototype,"viewType",void 0),p([u()],k.prototype,"isLoaded",void 0),p([u()],k.prototype,"hasAnalytics",void 0),p([u()],k.prototype,"identity",void 0),p([u()],k.prototype,"promotedAdAccounts",void 0),k=w=p([l("promote-post-button")],k);export{k as P};
