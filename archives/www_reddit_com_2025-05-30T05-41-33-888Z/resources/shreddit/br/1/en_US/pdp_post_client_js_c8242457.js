import{_ as t,g as e,n as s,e as i,aQ as o,dH as a,dI as r,dJ as n,bo as l,bp as d,dK as c,bn as p,dL as m,c as h,dM as u,dN as T,c6 as b,t as S,o as C,w as j,x as g}from"./shell-2264602c.js";import"./partial-feed-post-client-js-9aa6d44b.js";import"./shreddit-post-flair-d0271004.js";import"./user-hover-card-client-js-50e27133.js";import{B as y}from"./base-translator-57da136d.js";import{p as M}from"./links-9b598b77.js";import"./translation-feedback-modal-client-js-1348daab.js";import{x as A,s as v,a as w,A as E}from"./icon-82dd10b4.js";import"./shreddit-post-translator-5ae2a7ea.js";import"./pdp-back-button-7fd552ab.js";import{aT as f}from"./age-gate-standalone-client-js-5357b0cf.js";import"./comment-link-post-client-js-3910d5c4.js";import{g as _}from"./password-recovery-11761f51.js";import"./mod-log-takedown-preview-client-js-14bc18f8.js";import"./shop-gallery-data-fetcher-client-js-73ca6a07.js";import"./utils-19e4b642.js";import"./custom-event-7a897666.js";import"./index-95352f7c.js";import"./content-action-button-a25cd1f9.js";import"./award-controller-c1fa775d.js";import"./awardsTelemetryState-e939bf46.js";import"./header-action-item-chat-client-js-8d009dcd.js";import"./tooltip.base-7152f24f.js";import"./rpl-popper-2d8cefe0.js";import"./modActions-c13cf697.js";import"./mod-bulk-actions-285bd4b9.js";import"./distinguished-tags-ad178980.js";import"./awards-d066f3fe.js";import"./expandable-section-header-edd4c2b3.js";import"./rpl-coachmark-f5614db3.js";import"./rpl-coachmark-card-3cbe7edc.js";import"./mod-post-list-client-js-bec4e5a5.js";import"./content-tags-a35f6e45.js";import"./overflow-menu-actions-97fa1cfc.js";import"./shreddit-post-share-button-1df6e2be.js";import"./with-share-1ad32a0e.js";import"./promote-post-actions-controller-f5bf291f.js";import"./index-7436fa38.js";import"./profile-creation-1d60123b.js";import"./select-controller-e11d5e4c.js";import"./user-flair-afad799f.js";import"./expandable-mod-reports-base-769d69d1.js";import"./postFlair-707ffbfa.js";import"./promote-post-button-9b9319e1.js";import"./translation-intervention-modal-337135d6.js";import"./translations-8a80e526.js";import"./chat-mobile-xpromo-client-js-c803f3b0.js";import"./app-selector-client-js-3a92da0e.js";import"./TinyGesture-89d9957c.js";import"./v2-events-b6c86ff7.js";import"./mod-verdict-47cd849f.js";import"./gallery-4693e59b.js";import"./community-club-highlights-client-js-a6b43ba7.js";import"./subreddit-posting-eligibility-8f99a053.js";import"./index-7edea759.js";import"./qr-code-modal-upsell-client-js-7b7451da.js";import"./comment-client-js-815cfbd9.js";import"./cbau-81b2f8bd.js";import"./faceplate-progress-6bd32b2b.js";import"./follow-button-ea561889.js";import"./all-chats-page-recommendations-client-js-e670f708.js";import"./click-location-tracker-1589a523.js";import"./faceplate-textarea-input-97dc2a34.js";import"./text-input-7536667a.js";import"./filterNullish-60f7e90f.js";import"./constants-d65b7b38.js";import"./banned-user-banner-client-js-fbb59000.js";const I={TITLE:"title",TEXT_BODY:"text-body",TRANSLATION_SUFFIX:"-translated",TRANSLATION_ERROR:"#post-translation-error",STILL_IMAGE:`.${T}`,MEDIA_URL:"#media-url",MEDIA_FULLSIZE_URL:"#media-fullsize-url",SRC_SET:"#src-set",ZOOMABLE_IMG:"zoomable-img"};let x=class extends y{constructor(){super(),this.translatorChildrenName="shreddit-post",this.seoVisitSettled=!1,this.isSeoVisit=!1,this.translationState={originalMediaSrcset:"",originalMediaUrl:"",originalMediaFullsizeUrl:"",translatedMediaUrl:"",translatedMediaSrcset:"",translatedMediaFullsizeUrl:""},this._partialRequest=new o(this)}connectedCallback(){super.connectedCallback();const t=this.querySelector(this.translatorChildrenName);t&&this.translationContextValue.isTranslationActive&&t.isPostTranslated&&this.trackEvent(this,M(t,!0)),this.addEventListener(a,this.handleTranslationFeedback)}updated(t){t.has("translationContextValue")&&void 0!==this.translationContextValue.isTranslationActive&&(this.seoVisitSettled||!this.isSeoVisit?super.onUpdateTranslationContextValue(t):this.seoVisitSettled=!0)}handleTranslationFeedback(t){const e=this.translationContextValue.isTranslationActive,s=this.querySelector(this.translatorChildrenName),i=s?.id,o=s?.querySelector(e?'[slot="title-translated"]':'[slot="title"]'),a=s?.querySelector(e?'[slot="text-body-translated"]':'[slot="text-body"]'),n=this.shadowRoot?.getElementById(r.ID.PDP_POST_FEEDBACK_MODAL);n&&n.show?.({post:{id:i,title:o?.textContent?.trim(),body_text:a?.textContent?.trim(),translation_state:e}})}async onTranslationsEnabled(){this.togglePostTranslations(!0),this.submitTranslationMetrics()}async onTranslationsDisabled(){this.togglePostTranslations(!1),this.submitTranslationMetrics()}async togglePostTranslations(t){const e=this.findTranslatablePost(t);if(!e)return this.logError({error:"post not found"});if(e.isTranslationFetched)return this.trackEvent(this,M(e,t)),this.toggleMediaTranslation(t),void(e.isPostTranslated=t);if(!e.isTranslatable&&e.postType!==n.Image)return;const s=await this.loadPostTranslations(e,t);if(!(s&&!1===s.includes?.(l)))return this.logError({error:"api error",metadata:{id:e.id,isTranslationActive:t}});e.isTranslatable&&this.trackEvent(this,M(e,t));const i=d(s);this.appendResponseToPost(e,i),this.storeMediaResponseToCache(i,t),this.toggleMediaTranslation(t)}findTranslatablePost(t){const e=this.querySelector(this.translatorChildrenName);if(!(!e||e.isPostTranslated&&t))return e}async loadPostTranslations(t,e){if(t.isTranslatable||t.postType===n.Image){const s=e?c.GetTranslation:c.GetOriginal,i=new FormData;i.append("postId",t.id),i.append("translationState",s),t.isTranslatable&&i.append("isTranslatable","true");const o="/svc/shreddit/translated-post/",a=await this._partialRequest.request(o,{method:p.Post,body:i});return a?.text()}}appendResponseToPost(t,e){if(!t.isTranslatable)return;let s=!1;const i=t.isPostTranslated?[I.TITLE,I.TEXT_BODY]:[`${I.TITLE}${I.TRANSLATION_SUFFIX}`,`${I.TEXT_BODY}${I.TRANSLATION_SUFFIX}`];e.forEach((e=>{const o=e.getAttribute("slot")||"";o.includes(I.TEXT_BODY)&&this.isDevPlatformPost()||i.includes(o)&&!t.querySelector(`[slot="${o}"]`)&&(t.appendChild(e),s=!0)})),s&&(t.isTranslationFetched=!0,this.translationContextValue.isTranslationActive?(t.isPostTranslated=!0,t.isPostBodyTranslated=!0):(t.isPostTranslated=!1,t.isPostBodyTranslated=!1))}storeMediaResponseToCache(t,e){const s=document.querySelector(I.STILL_IMAGE),i=document.querySelector(I.ZOOMABLE_IMG),o=i?.querySelector("img");let a,r,n;t.forEach((t=>{t.id===I.MEDIA_URL.slice(1)&&(a=t.textContent||""),t.id===I.SRC_SET.slice(1)&&(n=t.textContent||""),t.id===I.MEDIA_FULLSIZE_URL.slice(1)&&(r=t.textContent||"")})),a&&n&&(e?(this.translationState.originalMediaUrl=s?.getAttribute("src")||"",this.translationState.originalMediaSrcset=s?.getAttribute("srcset")||"",this.translationState.originalMediaFullsizeUrl=o?.getAttribute("src")||"",this.translationState.translatedMediaUrl=a,this.translationState.translatedMediaSrcset=n,this.translationState.translatedMediaFullsizeUrl=r??""):(this.translationState.originalMediaUrl=a,this.translationState.originalMediaSrcset=n,this.translationState.originalMediaFullsizeUrl=r??"",this.translationState.translatedMediaUrl=s?.getAttribute("src")||"",this.translationState.translatedMediaSrcset=s?.getAttribute("srcset")||"",this.translationState.translatedMediaFullsizeUrl=o?.getAttribute("src")||""))}toggleMediaTranslation(t){if(!this.isMediaCacheStored())return;const e=document.querySelector(I.STILL_IMAGE),s=document.querySelector(I.ZOOMABLE_IMG),i=s?.querySelector("img");t?(e?.setAttribute("src",this.translationState.translatedMediaUrl),e?.setAttribute("srcset",this.translationState.translatedMediaSrcset),i?.setAttribute("src",this.translationState.translatedMediaFullsizeUrl)):(e?.setAttribute("src",this.translationState.originalMediaUrl),e?.setAttribute("srcset",this.translationState.originalMediaSrcset),i?.setAttribute("src",this.translationState.originalMediaFullsizeUrl))}isMediaCacheStored(){return!!this.translationState.translatedMediaUrl&&!!this.translationState.originalMediaUrl}isDevPlatformPost(){return null!==this.querySelector("shreddit-devvit-ui-loader")}submitTranslationMetrics(){if(!this.reportMetrics)return;const t=this.querySelector("shreddit-post");if(!t)return;const{id:e,postType:s="",isPostTranslated:i,isTranslatable:o,isPostBodyTranslated:a}=t,r=this.translationContextValue?.isTranslationActive||!1,n={},l=t.querySelector('[slot="title"')?.textContent||"",d=t.querySelector('[slot="title-translated"')?.textContent||"",c=t.querySelector('[slot="text-body"]')?.textContent||"",p=t.querySelector('[slot="text-body-translated"]')?.textContent||"",T=""!==c||""!==p;n.scenario=this.metricsScenario,n.targetLanguage=t.translationLanguage,n.post=m({postId:e,postType:s,translationSetting:r,originalTitle:l,translatedTitle:d,originalBody:c,translatedBody:p,isTitleTranslated:i,isBodyTranslated:T?a:i,isTranslatable:o}),this.dispatchEvent(h(u,n))}render(){return A` <div><slot></slot></div> <translation-feedback-modal id="${r.ID.PDP_POST_FEEDBACK_MODAL}"></translation-feedback-modal> `}};t([s({type:Boolean,attribute:"is-seo-visit"})],x.prototype,"isSeoVisit",void 0),t([e()],x.prototype,"translationState",void 0),x=t([i("post-translator")],x);let P=class extends v{constructor(){super(...arguments),this.isMobile=!1,this.showDurationS=8,this.postId="",this.isPillVisible=!1,this.hostCommentCount=0,this.isAddedTabEvent=!1,this.commentCountSubscriptionController=new b(this),this.onData=t=>{this.isAddedTabEvent||(document.querySelector(`.${f}`)?.addEventListener("click",this.handleAmaCommentTabClick),this.isAddedTabEvent=!0);const e=t.subscribe.data.hostCommentCountChange||0;e<=0||(this.hostCommentCount+=e,this.isPillVisible?clearTimeout(this.currentCountDown):this.isPillVisible=!0,this.currentCountDown=setTimeout((()=>{this.isPillVisible=!1}),1e3*this.showDurationS))},this.scrollToCommentsAndRefreshAnswers=()=>{const t=document.querySelector(`.${f}`)?.offsetTop;if(!t)return;const e=document.querySelector("nav")?.offsetHeight??0;window.scrollTo({top:t-e,behavior:"smooth"});const s=document.querySelector('button[value="answered"]');s?.click()},this.onPillClick=()=>{this.isPillVisible=!1,this.hostCommentCount=0,this.currentCountDown&&clearTimeout(this.currentCountDown),this.currentCountDown=void 0,this.scrollToCommentsAndRefreshAnswers()},this.handleAmaCommentTabClick=t=>{const e=t.target?.getAttribute("value"),s=e&&e.toLowerCase();"all"!==s&&"answered"!==s||(this.isPillVisible=!1,this.hostCommentCount=0,this.currentCountDown&&clearTimeout(this.currentCountDown))}}static get styles(){return[w`:host{left:50%;position:fixed;top:calc(var(--shreddit-header-height) + 32px);transform:translateX(-50%);z-index:1001}`,S]}getTitleText(){return C({count:this.hostCommentCount,one:`${this.hostCommentCount} new answer`,few:`${this.hostCommentCount} new answers`,many:`${this.hostCommentCount} new answers`,other:`${this.hostCommentCount} new answers`})}connectedCallback(){super.connectedCallback(),this.commentCountSubscriptionController.subscribe({query:{operationName:"SubscribeSubscription",query:"\n          subscription SubscribeSubscription($input: SubscribeInput!) {\n            subscribe(input: $input) {\n              ... on BasicMessage {\n                data {\n                  ... on CommentCountUpdateMessageData {\n                    hostCommentCountChange\n                  }\n                }\n              }\n            }\n          }\n          ",variables:{input:{channel:{teamOwner:"CONTENT_AND_COMMUNITIES",category:"COMMENT_COUNT_UPDATE",postID:this.postId}}}},onData:t=>{t.data&&this.onData(t.data)}})}disconnectedCallback(){super.disconnectedCallback(),document.querySelector(`.${f}`)?.removeEventListener("click",this.handleAmaCommentTabClick)}render(){return this.isPillVisible?j({appearance:"primary",attributes:{onclick:this.onPillClick},children:this.getTitleText(),size:this.isMobile?g.Small:g.Large,role:"button"}):E}};t([s({type:Boolean,attribute:"is-mobile"})],P.prototype,"isMobile",void 0),t([s({type:Number,attribute:"show-duration-in-s"})],P.prototype,"showDurationS",void 0),t([s({type:String,attribute:"post-id"})],P.prototype,"postId",void 0),t([e()],P.prototype,"isPillVisible",void 0),t([e()],P.prototype,"hostCommentCount",void 0),P=t([i("ama-new-comment-pill")],P),"enabled"===window.CLIENT_EXPERIMENTS?.shreddit_pdp_no_mod_js_lo?_()&&import("./index-logged-in-583af88f.js"):import("./index-logged-in-583af88f.js");
