import{y as t,B as e,a as n,dT as i,cR as s,cS as a,cT as o,dU as r,dV as d,_ as l,g as h,n as c,cP as p,b9 as v,e as m}from"./shell-2264602c.js";import{ax as u}from"./age-gate-standalone-client-js-5357b0cf.js";import{a as x,i as E,F as f,b as y,c as g}from"./flex-nav-2ca2e7d8.js";import{x as b,A as w,a as k}from"./icon-82dd10b4.js";let S=class extends(n(v)){constructor(){super(...arguments),this.isHovered=!1,this.hoverDelayStart=250,this.hoverDelayEnd=500,this.preventNextAnimations=!1,this.containerElement=null,this.contentsElement=null,this.expandButton=null,this.collapseButton=null,this.gridTransitionPromise=null,this.gridTransitioning=!1,this.trigger="hover",this.interactionController=new u(this,{hoverDelayStart:()=>this.hoverDelayStart,hoverDelayEnd:()=>this.hoverDelayEnd,isInteractedWith:t=>t.isHovered}),this.noAnimate=!1,this.parentGridSelector=".grid-container",this.hotkeysController=new i(this),this.handleSlotChange=t=>{const e=document.getElementById(f.ContainerDiv),n=document.getElementById(f.ContentsDiv),i=document.getElementById(f.ExpandButton),s=document.getElementById(f.CollapseButton);n&&this.contentsElement!==n&&(this.contentsElement?.removeEventListener("mouseenter",this.interactionController.handleMouseEnter),n.addEventListener("mouseenter",this.interactionController.handleMouseEnter),this.contentsElement=n,this.isExpanded||(this.contentsVisibility=!1)),e&&this.containerElement!==e&&(this.containerElement=e),s&&s!==this.collapseButton&&(this.collapseButton?.removeEventListener("click",this.toggleState),this.collapseButton=s,s.addEventListener("click",this.toggleState)),i&&i!==this.expandButton&&(this.expandButton?.removeEventListener("click",this.toggleState),this.expandButton?.removeEventListener("keydown",this.handleExpandKeydown),this.expandButton=i,i.addEventListener("click",this.toggleState),i.addEventListener("mouseover",this.handleExpandButtonMouseOver),i.addEventListener("keydown",this.handleExpandKeydown))},this.handleExpandKeydown=async t=>{if("Tab"!==t.key)return;t.preventDefault();const e=document.querySelector("reddit-skip-to-sidebar")?.shadowRoot?.querySelector("a");if(e)return this.emitter.dispatch("focus-delegate",{detail:{el:e}}),e.focus();const n=document.getElementById("shreddit-skip-link");n instanceof HTMLElement&&(this.emitter.dispatch("focus-delegate",{detail:{el:n}}),n.focus())},this.handleExpandButtonMouseOver=t=>{this.isHovered?this.interactionController.handleMouseEnter(t):t.stopImmediatePropagation()},this.toggleState=t=>{const n=document.querySelector(this.parentGridSelector);var i,s;void 0!==this.country&&void 0!==this.expanded&&n&&(this.emitTrackingEvent(this.isExpanded?"collapse":"expand"),this.expanded=this.isExpanded?y.Collapsed:y.Expanded,n instanceof HTMLElement&&(this.gridTransitioning=!0,this.gridTransitionPromise=this.preventNextAnimations?B():A(n).then((()=>{this.gridTransitioning=!1})),n.classList.remove(...Object.values(g)),n.classList.add(g[this.expanded])),i=this.expanded,s=this.country,e({name:x,value:i,country:s}))}}get isExpanded(){return this.expanded===y.Expanded}set contentsVisibility(t){this.contentsElement&&(this.contentsElement.hidden=!t)}emitTrackingEvent(t){const[e,n,i]={expand:["nav","click","open_community_nav"],collapse:["nav","click","close_community_nav"],hover:["nav","hover","open_community_nav"],unhover:["nav","hover","close_community_nav"]}[t];return this.trackEvent({source:e,action:n,noun:i,client_timestamp:Date.now()})}async stopAnimations(){const t=[];this.containerElement&&t.push(s(this.containerElement)),this.contentsElement&&t.push(s(this.contentsElement)),await Promise.all(t)}async runAnimations(t,e){if(this.preventNextAnimations)return;const n=[],i=a(this,`flex-left-nav-container.${t}-${e}`),s=a(this,`flex-left-nav-contents.${t}-${e}`);this.containerElement&&n.push(o(this.containerElement,i.keyframes,i.options)),this.contentsElement&&n.push(o(this.contentsElement,s.keyframes,s.options)),await Promise.all(n)}async connectedCallback(){super.connectedCallback(),await this.syncFlexNavStateNoAnimate(),this.isExpanded||this.updateComplete.then((()=>this.contentsVisibility=!1)),this.addEventListener("mouseleave",this.interactionController.handleMouseLeave),"enabled"===r("shreddit_hotkeys_m1")&&this.hotkeysController.subscribe(d.OPEN_NAVIGATION,this.toggleState)}disconnectedCallback(){super.disconnectedCallback(),this.removeEventListener("mouseleave",this.interactionController.handleMouseLeave),"enabled"===r("shreddit_hotkeys_m1")&&this.hotkeysController.unsubscribe(d.OPEN_NAVIGATION,this.toggleState)}willUpdate(t){t.has("expanded")&&this.hasUpdated&&this.handleExpandedStateChanged(),super.willUpdate(t)}updated(){}focusContents(){this.isExpanded?this.collapseButton?.focus():this.expandButton?.focus()}async syncFlexNavStateNoAnimate(){const e=(()=>{const e=t.get(x);return E(e)?e:null})();null!==e&&this.expanded!==e&&(this.preventAnimationsForUpdate(),this.toggleState(),await this.updateComplete)}async preventAnimationsForUpdate(){this.preventNextAnimations=!0;const t=document.querySelector(this.parentGridSelector);t instanceof HTMLElement&&(t.style.transition="none"),this.setAttribute("skip-animation",""),await Promise.all([this.updateComplete,B()]),this.removeAttribute("skip-animation"),t instanceof HTMLElement&&(t.style.transition=""),this.preventNextAnimations=!1}async handleExpandedStateChanged(){this.emitter.dispatch(this.isExpanded?"expand":"collapse");const t=this.updateComplete,e=(this.isExpanded?this.collapseButton:this.expandButton)?.parentElement,n=(this.isExpanded?this.expandButton:this.collapseButton)?.parentElement;if(C(e)&&(e.disabled=!0),C(n)&&n.hide?.(),t.then((async()=>{this.focusContents()})),await this.stopAnimations(),this.isExpanded&&(this.contentsVisibility=!0),!this.isHovered&&this.containerElement){const t=this.isExpanded?"show":"hide";await this.runAnimations("expand",t)}else this.gridTransitioning&&this.gridTransitionPromise?.then((()=>{this.emitter.dispatch("after-grid-transition"),this.isHovered=!1,this.classList.remove("hovered")}));this.isExpanded||(this.contentsVisibility=!1),C(e)&&(e.disabled=!1),this.emitter.dispatch(this.isExpanded?"after-expand":"after-collapse")}async startInteraction(){this.isExpanded||this.isHovered||this.gridTransitioning||(this.emitTrackingEvent("hover"),this.emitter.dispatch("hover"),await this.stopAnimations(),this.classList.add("hover-started"),this.contentsVisibility=!0,this.isHovered=!0,await this.runAnimations("hover","show"),this.classList.remove("hover-started"),this.classList.add("hovered"),this.emitter.dispatch("after-hover"))}async finishInteraction(){!this.isExpanded&&this.isHovered&&(this.emitTrackingEvent("unhover"),this.emitter.dispatch("unhover"),await this.stopAnimations(),await this.runAnimations("hover","hide"),this.classList.remove("hovered"),this.isHovered=!1,this.contentsVisibility=!1,this.emitter.dispatch("after-unhover"))}render(){return b` <slot @slotchange="${this.handleSlotChange}"></slot> ${this.isExpanded?w:b`<div class="hoverable-target ${this.isHovered?"hovered":""}" @mouseenter="${this.interactionController.handleMouseEnter}"></div>`} `}};S.styles=k`:host(.hover-started),:host(.hovered){z-index:10!important;border-top:1px solid var(--color-neutral-border)!important}.hoverable-target{position:fixed;top:calc(var(--shreddit-header-height) + 72px);width:calc(var(--flex-nav-closed-size) + 16px);bottom:0;z-index:calc(var(--flex-nav-z-index) + 1)}.hoverable-target.hovered{z-index:calc(var(--flex-nav-z-index) - 1);top:var(--shreddit-header-height);width:calc(var(--flex-nav-expanded-size) + 16px)}`,l([h()],S.prototype,"isHovered",void 0),l([c({type:String,reflect:!0})],S.prototype,"expanded",void 0),l([c({type:String})],S.prototype,"country",void 0),l([c({type:Boolean})],S.prototype,"noAnimate",void 0),l([c({type:String})],S.prototype,"parentGridSelector",void 0),S=l([m("flex-left-nav-container")],S);const C=t=>"rpl-tooltip"===t?.tagName.toLowerCase(),A=(t,e=1200)=>{const n=t=>new Promise((n=>{t.addEventListener("transitionend",n),setTimeout(n,e)}));return Array.isArray(t)?Promise.all(t.map(n)):n(t)},B=()=>new Promise((t=>requestAnimationFrame(t)));p("flex-left-nav-container.expand-show",{keyframes:[{transform:"translateX(var(--closed-floating-translation))"},{transform:"translateX(var(--open-floating-translation))"}],options:{duration:250,easing:"cubic-bezier(0.65, 0, 0.35, 1)"}}),p("flex-left-nav-container.expand-hide",{keyframes:[{transform:"translateX(var(--open-floating-translation))"},{transform:"translateX(var(--closed-floating-translation))"}],options:{duration:300,easing:"cubic-bezier(0.87, 0, 0.13, 1)"}}),p("flex-left-nav-container.hover-show",{keyframes:[{boxShadow:"var(--left-nav-box-shadow-none)",transform:"translateX(var(--closed-floating-translation))"},{boxShadow:"var(--left-nav-box-shadow-hover)",transform:"translateX(var(--open-floating-translation))"}],options:{duration:250,easing:"cubic-bezier(0.65, 0, 0.35, 1)"}}),p("flex-left-nav-container.hover-hide",{keyframes:[{boxShadow:"var(--left-nav-box-shadow-hover)",transform:"translateX(var(--open-floating-translation))"},{boxShadow:"var(--left-nav-box-shadow-none)",transform:"translateX(var(--closed-floating-translation))"}],options:{duration:300,easing:"cubic-bezier(0.87, 0, 0.13, 1)"}}),p("flex-left-nav-contents.show",{keyframes:[{opacity:0},{opacity:1}],options:{duration:250,easing:"linear"}}),p("flex-left-nav-contents.hide",{keyframes:[{opacity:1},{opacity:0}],options:{duration:300,easing:"linear"}});export{S as F};
