import{bt as i,_ as t,g as e,n as s,J as o,e as h,cs as l,P as n,a_ as a,T as r,t as d,aV as p,w as u,x as g,ct as c,j as b}from"./shell-2264602c.js";import{a as m,s as _,x,aE as f,I as w}from"./icon-82dd10b4.js";import{T as v}from"./TinyGesture-89d9957c.js";i(m`#shreddit-media-lightbox .media-lightbox-img{max-height:none}#shreddit-media-lightbox .zoomable-img-wrapper{display:block}#shreddit-media-lightbox::part(panel){max-width:100svw;max-height:100svh;width:100svw;height:100svh;border-radius:0}`);let C=class extends _{constructor(){super(...arguments),this._isConnected=!1,this._push=l,this._lightboxUrl=void 0,this.pubsub=new n(this),this._gesture=null,this._isPinchGesture=!1,this.templateRef=a(),this.contentRef=a(),this._hideCloseButtonOnIdle=!1,this.disableAnimations=!1,this.isIdle=!1,this.lightboxOpenHandler=({element:i,attributes:t={}})=>{const{permalink:e}=t;if(e)try{this._lightboxUrl=new URL(`${location.origin}${e}#lightbox`),this._push(this._lightboxUrl.href,{onForwardNav:()=>this.showModal({element:i,attributes:t}),onBackNav:()=>this.dialog?.hide()})}catch(i){}else this.showModal({element:i,attributes:t})},this.showModal=({element:i,attributes:t={}})=>{if(this.dialog?.open)return;const{hideCloseButtonOnIdle:e,onAfterClose:s}=t;this._hideCloseButtonOnIdle=e??!1,this._onAfterClose=s,this._originalParent=i,this._originalParentHeight=i.offsetHeight,this.dialog?.showModal(),this.pubsub.publish(r.LightboxOpened)},this.onAfterShow=()=>{const i=document.createElement("div");i.style.height=`${this._originalParentHeight}px`,this.contentRef?.value?.replaceChildren(...this._originalParent?.children||[]),this._originalParent?.appendChild(i),this._startIdleTimer(),this.isIdle=!1,this.templateRef?.value&&(this._gesture=new v(this.templateRef.value,{mouseSupport:!0}),this._gesture.on("swipeup",this._onSwipe),this._gesture.on("swipedown",this._onSwipe),this._gesture.on("pinch",(()=>{this._isPinchGesture=!0})),this._gesture.on("pinchend",(()=>{this._isPinchGesture=!1})))},this.lightboxCloseHandler=()=>{this.dialog?.open&&this.dialog?.hide()},this.onDialogHide=()=>{this.pubsub.publish(r.LightboxClosed),this.contentRef?.value?.children&&this._originalParent&&(this._originalParent.replaceChildren(...this.contentRef.value.children),this.contentRef.value.innerHTML=""),this._originalParent=void 0,this._hideCloseButtonOnIdle=!1,this._idleTimeout=void 0,this.isIdle=!1;const i=window.navigation?.currentEntry?.url!==this._lightboxUrl?.href;window.navigation?.canGoBack&&!i&&(this._lightboxUrl=void 0,window.navigation.back())},this.onAfterHide=()=>{this._onAfterClose&&(this._onAfterClose(),this._onAfterClose=void 0)},this._startIdleTimer=()=>{this._hideCloseButtonOnIdle&&(this._stopIdleTimer(),this._idleTimeout=window.setTimeout((()=>{this.isIdle=!0}),1500))},this._onSwipe=()=>{this._isPinchGesture||this.dialog?.hide()}}static get styles(){return[d]}connectedCallback(){super.connectedCallback();Array.from(document.getElementsByTagName("shreddit-media-lightbox")).some((i=>i._isConnected))||(this._isConnected=!0,this.pubsub.subscribe(r.LightboxOpen,this.lightboxOpenHandler,!1),this.pubsub.subscribe(r.LightboxClose,this.lightboxCloseHandler,!1))}firstUpdated(){this.dialog&&this.disableAnimations&&function(i){const t={keyframes:[],options:{duration:0}};["dialog.show","dialog.hide","dialog.denyClose","dialog.overlay.show","dialog.overlay.hide"].forEach((e=>{c(i,e,t)}))}(this.dialog)}disconnectedCallback(){super.disconnectedCallback(),this._isConnected&&(this.dialog?.open&&this.dialog?.hide(),this.pubsub.unsubscribe(r.LightboxOpen,this.lightboxOpenHandler),this.pubsub.unsubscribe(r.LightboxClose,this.lightboxCloseHandler),this._gesture?.destroy(),this._isConnected=!1)}_stopIdleTimer(){window.clearTimeout(this._idleTimeout),this._idleTimeout=void 0,this.isIdle=!1}render(){if(this._isConnected){const i=x`<div data-testid="lightbox-template" class="relative h-full w-full" @mousemove="${this._startIdleTimer}" @click="${this._startIdleTimer}" @keydown="${this._startIdleTimer}" ${p(this.templateRef)}> <div data-testid="lightbox-template-content" class="h-full w-full max-h-dvh" ${p(this.contentRef)}></div> ${u({size:g.Large,appearance:"media",shape:"pill",attributes:{"data-testid":"close-button",className:"absolute top-sm right-sm duration-300 "+(this.isIdle?"opacity-0 invisible":"opacity-100"),"aria-label":"Close lightbox",onclick:()=>{this.dialog?.hide()}},children:f({size:w.Medium})})} </div>`;return x` <rpl-dialog dialog-id="${"shreddit-media-lightbox"}" @rpl-dialog:after-show="${this.onAfterShow}" @rpl-dialog:hide="${this.onDialogHide}" @rpl-dialog:after-hide="${this.onAfterHide}" .litTemplateChildren="${i}"> </rpl-dialog> `}return""}};t([s({type:Boolean,attribute:"disable-animations"})],C.prototype,"disableAnimations",void 0),t([e()],C.prototype,"isIdle",void 0),t([o("rpl-dialog")],C.prototype,"dialog",void 0),C=t([h("shreddit-media-lightbox")],C);let y=class extends _{constructor(){super(...arguments),this.pubsub=new n(this),this.handleInteraction=i=>{b(i)&&this.openLightbox()},this.handleTrigger=({postId:i})=>{i===this.postId&&this.openLightbox()},this.openLightbox=()=>{this.pubsub.publish(r.LightboxOpen,{element:this,attributes:{permalink:this.permalink}})}}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(r.TriggerLightboxOpen,this.handleTrigger,!1)}disconnectedCallback(){this.pubsub.unsubscribe(r.TriggerLightboxOpen,this.handleTrigger),super.disconnectedCallback()}render(){return x`<slot @click="${this.handleInteraction}" @keypress="${this.handleInteraction}"></slot>`}};y.styles=[m`:host{cursor:pointer}`,d],t([s({type:String,attribute:"post-id"})],y.prototype,"postId",void 0),t([s({type:String,attribute:"permalink"})],y.prototype,"permalink",void 0),y=t([h("shreddit-media-lightbox-listener")],y);
