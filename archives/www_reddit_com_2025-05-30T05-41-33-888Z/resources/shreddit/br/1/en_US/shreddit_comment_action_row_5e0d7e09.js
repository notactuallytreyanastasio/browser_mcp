import{a as t,_ as o,g as e,n,e as r,dv as i,P as a,E as s,t as l,K as d,T as c,c as u,I as p,x as v}from"./shell-2264602c.js";import"./shop-gallery-data-fetcher-client-js-73ca6a07.js";import{s as b,x as m,A as h}from"./icon-82dd10b4.js";import{V as g,g as w,o as y,v as C,a as k,u as S,b as f,d as A,c as x}from"./index-95352f7c.js";import{c7 as I,bN as V,c1 as E,c8 as M,c9 as U,ca as T,b7 as B}from"./age-gate-standalone-client-js-5357b0cf.js";import{C as R}from"./comment-8177f9ce.js";import{P as j,j as P}from"./links-9b598b77.js";import{S as L}from"./postFlair-707ffbfa.js";import"./utils-19e4b642.js";import"./content-action-button-a25cd1f9.js";import"./award-controller-c1fa775d.js";import"./awardsTelemetryState-e939bf46.js";import"./header-action-item-chat-client-js-8d009dcd.js";import"./tooltip.base-7152f24f.js";import"./rpl-popper-2d8cefe0.js";import"./modActions-c13cf697.js";import"./mod-bulk-actions-285bd4b9.js";import"./distinguished-tags-ad178980.js";import"./awards-d066f3fe.js";const O=t(b);let _=window.location.search,D=class extends O{constructor(){super(...arguments),this.commentId="",this.score=void 0,this.isDesktopViewport=!1,this.disabled=!1,this.isUserLoggedIn=!1,this.isMod=!1,this.previousActionsFeature=!1,this.isCommentArchived=!1,this.isViewOnly=!1,this.isContestMode=!1,this.isScoreHidden=!1,this.permalink="",this.isUserBanned=!1,this.voteState=i.None,this.updateAnimation=void 0,this.isCommentComposerActive=!1,this.showModContentStateIndicators=!0,this.updateState=void 0,this.isVisible=!0,this.viewContext=j.CommentsPage,this.commentOverflowMenu=null,this.onItemEnterIntoView=()=>this.handlePotentialRealtimeAnimation(!0),this.onItemLeaveView=()=>this.handlePotentialRealtimeAnimation(!1),this.handlePotentialRealtimeAnimation=t=>{this.isVisible=t,t&&this.updateState&&this._modActionsController?.triggerRealtimeUpdateAnimation()},this.getScrollContainerSelector=()=>{const t=this.closest("shreddit-profile-comment");return t?(this.viewContext=t.viewContext,[j?.ModQueue,j?.ModQueueAll].includes(t.viewContext)?'[slot="mod-queue-feed"]':""):'[slot="pdp-panel"]'},this._modActionsController=null,this.pubsub=new a(this),this.subscribeToReplyMenuItemClick=()=>{this.commentOverflowMenu=this.getCommentOverflowMenu(),this.commentOverflowMenu?.addEventListener(I,this.handleReply)},this.unsubscribeToReplyMenuItemClick=()=>{this.commentOverflowMenu?.removeEventListener(I,this.handleReply)},this.getCommentOverflowMenu=()=>this.querySelector("shreddit-overflow-menu"),this._events=new s(this),this.hideCommentComposer=()=>{const t=this.querySelector('[slot="comment-composer"]');t&&t.remove(),this.isCommentComposerActive=!1},this.handleCommentUpdated=({commentId:t,action:o,value:e})=>{if(this.commentId===t)switch(o){case R.lock:this.isViewOnly=function({isLocked:t,isMod:o,isArchived:e,isUserBanned:n}){return t&&!o||e||n}({isLocked:Boolean(e),isMod:this.isMod,isArchived:this.isCommentArchived,isUserBanned:this.isUserBanned}),this.isViewOnly&&this.hideCommentComposer();break;case R.approve:case R.remove:case R.removeAsSpam:case R.confirmRemoval:case R.addRemovalReason:this.showModContentStateIndicators=!1,this._modActionsController?.loadVerdict();break;case R.approveOptimistic:case R.removeOptimistic:case R.removeAsSpamOptimistic:case R.confirmRemovalOptimistic:this.showModContentStateIndicators=!1;break;case R.ignoreReports:e&&(this.showModContentStateIndicators=!1,this._modActionsController?.loadVerdict())}},this.handleCancelDraftEvent=this._events.define(V,this.hideCommentComposer),this.handleCommentPostEvent=this._events.define(E,this.hideCommentComposer),this.focusOnCommentComposer=()=>{if(!this.querySelector('[slot="comment-composer"]')){const t=this.querySelector('[slot="comment-composer-template"]');if(!(t instanceof HTMLTemplateElement))return;const o=t.content.cloneNode(!0);this.appendChild(o)}this.isCommentComposerActive=!0,this.querySelector('[slot="comment-composer"]')?.focus()},this.handleReply=t=>{if(this.disabled)return;const o=this.getAttribute("reply-permalink");o?window.history.pushState({},"",o):(t.stopImmediatePropagation(),t.stopPropagation(),this.focusOnCommentComposer())},this.getCommentVoteTypeFromVoteState=()=>{switch(this.voteState){case i.Up:return g.Upvote;case i.Down:return g.Downvote;default:return}},this._getCommentScoreDelta=t=>w(this.commentVoteType,t),this._onUpdateCommentVoteType=async()=>await y(this.commentId,"comment",this.commentVoteType),this.getContestModeVoteCTA=()=>m`Vote`}static get styles(){return[l,d(".rpl-vote-button-group {\n  /* APPEARANCE AGNOSTIC STYLES */\n  /* PLAIN APPEARANCE */\n  /* SECONDARY APPEARANCE */\n  /* BORDERED APPEARANCE */\n  --vote-button-divider-color: var(--color-neutral-border-weak);\n  /* MEDIA APPEARANCE */\n}\n.rpl-vote-button-group:not([disabled]) .rpl-vote-button-group-label {\n  color: var(--vote-button-label-color);\n}\n.rpl-vote-button-group:not([disabled]):hover.rpl-vote-button-group-label {\n  color: var(--vote-button-label-color-hover);\n}\n.rpl-vote-button-group .rpl-vote-button-group-divider {\n  background-color: var(--vote-button-divider-color);\n}\n.rpl-vote-button-group[disabled] button[rpl]:disabled {\n  --button-color-background-disabled: transparent;\n}\n.rpl-vote-button-group.button-plain {\n  --vote-button-label-color: var(--color-secondary-plain);\n  --vote-button-label-color-hover: var(--color-secondary-plain);\n}\n.rpl-vote-button-group.button-plain button[rpl]:first-child {\n  --button-color-text-hover: var(--color-upvote-plain-weaker);\n}\n.rpl-vote-button-group.button-plain button[rpl]:last-child {\n  --button-color-text-hover: var(--color-downvote-plain-weaker);\n}\n.rpl-vote-button-group.button-plain.upvote {\n  --vote-button-label-color: var(--color-upvote-plain);\n}\n.rpl-vote-button-group.button-plain.upvote button[rpl]:first-child {\n  --button-color-text-default: var(--color-upvote-plain-weaker);\n  --button-color-text-hover: var(--color-upvote-plain-weaker);\n  --button-color-text-disabled: var(--color-upvote-plain-disabled);\n  --button-color-text-activated: var(--color-upvote-plain-weaker);\n}\n.rpl-vote-button-group.button-plain.downvote {\n  --vote-button-label-color: var(--color-downvote-plain);\n}\n.rpl-vote-button-group.button-plain.downvote button[rpl]:last-child {\n  --button-color-text-default: var(--color-downvote-plain-weaker);\n  --button-color-text-disabled: var(--color-downvote-plain-disabled);\n  --button-color-text-activated: var(--color-downvote-plain-weaker);\n}\n.rpl-vote-button-group.button-secondary {\n  --vote-button-label-color: var(--color-secondary-plain);\n  --vote-button-label-color-hover: var(--color-secondary-plain);\n  --vote-button-divider-color: var(--color-neutral-border);\n}\n.rpl-vote-button-group.button-secondary button[rpl]:first-child {\n  --button-color-text-hover: var(--color-upvote-plain-weaker);\n}\n.rpl-vote-button-group.button-secondary button[rpl]:last-child {\n  --button-color-text-hover: var(--color-downvote-plain-weaker);\n}\n.rpl-vote-button-group.button-secondary.upvote,\n.rpl-vote-button-group.button-secondary.upvote button[rpl] {\n  --button-color-text-default: var(--color-upvote-onBackground);\n  --button-color-text-hover: var(--color-upvote-onBackground);\n  --button-color-text-disabled: var(--color-upvote-disabled);\n  --button-color-text-activated: var(--color-upvote-onBackground);\n}\n.rpl-vote-button-group.button-secondary.upvote:not([disabled]),\n.rpl-vote-button-group.button-secondary.upvote button[rpl]:not([disabled]) {\n  --button-color-background-default: var(--color-upvote-background);\n  --button-color-background-hover: var(--color-upvote-background-hover);\n  --button-color-background-active: var(--color-upvote-background-hover);\n  --vote-button-divider-color: var(--color-upvote-onBackground);\n  --vote-button-label-color: var(--color-media-onBackground);\n}\n.rpl-vote-button-group.button-secondary.downvote,\n.rpl-vote-button-group.button-secondary.downvote button[rpl] {\n  --button-color-text-default: var(--color-downvote-onBackground);\n  --button-color-text-hover: var(--color-downvote-onBackground);\n  --button-color-text-disabled: var(--color-downvote-disabled);\n  --button-color-text-activated: var(--color-downvote-onBackground);\n}\n.rpl-vote-button-group.button-secondary.downvote:not([disabled]),\n.rpl-vote-button-group.button-secondary.downvote button[rpl]:not([disabled]) {\n  --button-color-background-default: var(--color-downvote-background);\n  --button-color-background-hover: var(--color-downvote-background-hover);\n  --button-color-background-active: var(--color-downvote-background-hover);\n  --vote-button-divider-color: var(--color-upvote-onBackground);\n  --vote-button-label-color: var(--color-media-onBackground);\n}\n.rpl-vote-button-group.button-bordered-cab {\n  --vote-button-label-color: var(--color-secondary-plain);\n  --vote-button-label-color-hover: var(--color-secondary-plain);\n}\n.rpl-vote-button-group.button-bordered-cab button[rpl]:first-child {\n  --button-color-text-hover: var(--color-upvote-plain-weaker);\n}\n.rpl-vote-button-group.button-bordered-cab button[rpl]:last-child {\n  --button-color-text-hover: var(--color-downvote-plain-weaker);\n}\n.rpl-vote-button-group.button-bordered-cab.upvote {\n  --vote-button-label-color: var(--color-upvote-plain);\n}\n.rpl-vote-button-group.button-bordered-cab.upvote button[rpl]:first-child {\n  --button-color-text-default: var(--color-upvote-plain-weaker);\n  --button-color-text-hover: var(--color-upvote-plain-weaker);\n  --button-color-text-disabled: var(--color-upvote-plain-disabled);\n  --button-color-text-activated: var(--color-upvote-plain-weaker);\n}\n.rpl-vote-button-group.button-bordered-cab.downvote {\n  --vote-button-label-color: var(--color-downvote-plain);\n}\n.rpl-vote-button-group.button-bordered-cab.downvote button[rpl]:last-child {\n  --button-color-text-default: var(--color-downvote-plain-weaker);\n  --button-color-text-hover: var(--color-downvote-plain-weaker);\n  --button-color-text-disabled: var(--color-downvote-plain-disabled);\n  --button-color-text-activated: var(--color-downvote-plain-weaker);\n}\n.rpl-vote-button-group.button-media-cab {\n  --vote-button-label-color: var(--color-media-onBackground);\n  --vote-button-label-color-hover: var(--color-media-onBackground);\n  --vote-button-divider-color: var(--color-media-border-weak);\n}\n.rpl-vote-button-group.button-media-cab button[rpl]:first-child {\n  --button-color-text-hover: var(--color-upvote-onStrongScrim-weaker);\n}\n.rpl-vote-button-group.button-media-cab button[rpl]:last-child {\n  --button-color-text-hover: var(--color-downvote-onStrongScrim-weaker);\n}\n.rpl-vote-button-group.button-media-cab.upvote {\n  --vote-button-label-color: var(--color-upvote-onStrongScrim);\n}\n.rpl-vote-button-group.button-media-cab.upvote button[rpl]:first-child {\n  --button-color-text-default: var(--color-upvote-onStrongScrim-weaker);\n  --button-color-text-activated: var(--color-upvote-onStrongScrim-weaker);\n  --button-color-text-disabled: var(--color-upvote-onStrongScrim-disabled);\n}\n.rpl-vote-button-group.button-media-cab.downvote {\n  --vote-button-label-color: var(--color-downvote-onStrongScrim);\n}\n.rpl-vote-button-group.button-media-cab.downvote button[rpl]:last-child {\n  --button-color-text-default: var(--color-downvote-onStrongScrim-weaker);\n  --button-color-text-activated: var(--color-downvote-onStrongScrim-weaker);\n  --button-color-text-disabled: var(--color-downvote-onStrongScrim-disabled);\n}\n")]}triggerParentAnimation(){const t=new CustomEvent("trigger-animation",{detail:{action:this.updateState?.action},bubbles:!0,composed:!0});this.dispatchEvent(t)}connectedCallback(){super.connectedCallback(),this.commentVoteType=this.getCommentVoteTypeFromVoteState(),this.isUserLoggedIn&&this.subscribeToReplyMenuItemClick(),P(this.viewContext)&&(this.addEventListener("faceplate-enter",this.onItemEnterIntoView),this.addEventListener("faceplate-leave",this.onItemLeaveView)),this.pubsub.subscribe(c.CommentUpdated,this.handleCommentUpdated),"enabled"===window.CLIENT_EXPERIMENTS?.shreddit_pdp_no_mod_js_lo?this.isUserLoggedIn&&this.initModActionsController():this.initModActionsController()}async initModActionsController(){const{ModActionsController:t}=await import("./mod-actions-controller-7ff911c0.js").then((function(t){return t.m}));this._modActionsController=new t(this,{getThingIdFn:()=>this.commentId,getUserIdFn:()=>this.userId||"",scrollContainerSelectorFn:this.getScrollContainerSelector})}disconnectedCallback(){super.disconnectedCallback(),this.isUserLoggedIn&&this.unsubscribeToReplyMenuItemClick(),P(this.viewContext)&&(this.removeEventListener("faceplate-enter",this.onItemEnterIntoView),this.removeEventListener("faceplate-leave",this.onItemLeaveView)),this.pubsub.unsubscribe(c.CommentUpdated,this.handleCommentUpdated)}firstUpdated(...t){super.firstUpdated(...t);new URLSearchParams(_).get("reply")===this.commentId&&this.focusOnCommentComposer()}handleInteraction(){document.querySelector(L)?.setAttribute("pageindex","1")}async handleDownvote(){this.isUserLoggedIn?(this.handleInteraction(),await this.handleUpdateCommentVote(g.Downvote)):this.disabled||(this.trackEvent(M(this.telemetrySource)),this.pubsub.publish(c.CommentDownvoted))}async handleUpvote(){this.isUserLoggedIn?(this.handleInteraction(),await this.handleUpdateCommentVote(g.Upvote)):this.disabled||(this.trackEvent(U(this.telemetrySource)),this.pubsub.publish(c.CommentUpvoted))}async handleUpdateCommentVote(t){const o=this.score,e=this.commentVoteType;if(void 0!==this.score){const o=this._getCommentScoreDelta(t);this.score=this.score+o}const n=t===this.commentVoteType;this.commentVoteType=n?undefined:t;try{await this._onUpdateCommentVoteType(),n?this.trackEvent(T(this.telemetrySource)):t===g.Upvote?(this.trackEvent(U(this.telemetrySource)),this.pubsub.publish(c.CommentUpvoted)):(this.trackEvent(M(this.telemetrySource)),this.pubsub.publish(c.CommentDownvoted))}catch(t){this.score=o,this.commentVoteType=e,this.dispatchEvent(u("faceplate-alert",{level:p.warning,message:t.message}))}}renderVoteButtons(){const t=B(),o=t?C:k,e=t?S:f,n=t?A:x,r=this.isContestMode||this.isScoreHidden?void 0:this.score,i=this.isContestMode||this.isScoreHidden?this.getContestModeVoteCTA():void 0,a={voteType:this.commentVoteType||null,attributes:{disabled:this.disabled||this.isCommentArchived},size:v.Small,appearance:"plain-weak"},s=e({...a,voteCount:r,initialStateText:i,screenReaderContent:"Upvote",onClick:this.handleUpvote}),l=n({...a,screenReaderContent:"Downvote",onClick:this.handleDownvote});return o({appearance:"plain-weak",voteCount:r,voteType:this.commentVoteType||void 0,size:a.size,upvoteButton:s,downvoteButton:l,initialStateText:i,attributes:{slot:"vote-button",disabled:this.disabled}})}render(){return this.isVisible&&this.updateState&&this._modActionsController?.triggerRealtimeUpdateAnimation(),m`<div class="flex flex-col w-100"> ${this.showModContentStateIndicators?this._modActionsController?.renderModContentStateIndicatorsClientSide({})??h:h} <div class="flex items-center max-h-2xl"> <div class="flex items-center max-h-2xl shrink"> ${this.renderVoteButtons()} ${this.isViewOnly?h:m`<slot name="comment-reply" @click="${this.handleReply}"></slot>`} <slot name="comment-share-as-post-topline"></slot> <slot name="comment-award"></slot> <slot name="comment-share"></slot> <slot name="comment-insight"></slot> <slot name="overflow"></slot> </div> ${this._modActionsController?.renderModPart("flex items-center ml-auto min-w-0 shrink-0")??h} </div> ${this.isCommentComposerActive&&!this.isViewOnly?m` <div class="py-md"> <slot name="comment-composer"></slot> </div> `:m``} </div>`}};o([n({type:String,attribute:"comment-id"})],D.prototype,"commentId",void 0),o([n({type:String,attribute:"user-id"})],D.prototype,"userId",void 0),o([n({type:Number})],D.prototype,"score",void 0),o([n({type:Boolean,attribute:"is-desktop-viewport"})],D.prototype,"isDesktopViewport",void 0),o([n({type:Boolean})],D.prototype,"disabled",void 0),o([n({type:Boolean,attribute:"is-user-logged-in"})],D.prototype,"isUserLoggedIn",void 0),o([n({type:Boolean,attribute:"mod"})],D.prototype,"isMod",void 0),o([n({type:String,attribute:"moderation-verdict"})],D.prototype,"moderationVerdict",void 0),o([n({type:Boolean,attribute:"previous-actions-feature"})],D.prototype,"previousActionsFeature",void 0),o([n({type:Boolean,attribute:"comment-archived"})],D.prototype,"isCommentArchived",void 0),o([n({type:Boolean,attribute:"view-only"})],D.prototype,"isViewOnly",void 0),o([n({type:Boolean,attribute:"is-contest-mode"})],D.prototype,"isContestMode",void 0),o([n({type:Boolean,attribute:"is-score-hidden"})],D.prototype,"isScoreHidden",void 0),o([n({type:String})],D.prototype,"permalink",void 0),o([n({type:Boolean,attribute:"banned"})],D.prototype,"isUserBanned",void 0),o([n({type:String,attribute:"vote-state"})],D.prototype,"voteState",void 0),o([e()],D.prototype,"commentVoteType",void 0),o([n({type:String,attribute:"telemetry-source"})],D.prototype,"telemetrySource",void 0),o([n({type:String,reflect:!0})],D.prototype,"updateAnimation",void 0),o([e()],D.prototype,"isCommentComposerActive",void 0),o([e()],D.prototype,"showModContentStateIndicators",void 0),o([e()],D.prototype,"updateState",void 0),D=o([r("shreddit-comment-action-row")],D);export{D as ShredditCommentActionRow};
