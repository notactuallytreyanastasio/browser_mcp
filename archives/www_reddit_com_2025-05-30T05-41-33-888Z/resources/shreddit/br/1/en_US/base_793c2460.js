import{aj as e,L as t,H as r,fu as a,Q as s,aF as i,a2 as n,aQ as o,bw as c,r as h,fv as d,fw as l,aJ as p,fx as u,u as m,t as y,K as S,T as f,bp as b,fy as g,fz as w,fA as v,a7 as E,w as D,x as R,fB as x,_ as k,g as I,fC as C,n as $,J as T}from"./shell-2264602c.js";import{I as U,x as q,a5 as _,r as Q,bR as A,a9 as N,aM as B,Q as P,A as L,bS as F,C as O,s as j}from"./icon-82dd10b4.js";import{p as M,e as z,bt as Y,aP as G,bu as V,bv as J,a0 as K,ae as H}from"./age-gate-standalone-client-js-5357b0cf.js";import"./faceplate-search-input-ad8da225.js";import"./search-results-dropdown-modifier-client-js-3f7d3b85.js";import"./search-typeahead-expandable-section-df6cd1cc.js";import{s as W,S as X,a as Z}from"./search-params-9b432517.js";import{S as ee,a as te,b as re}from"./search-dynamic-id-fd96acc2.js";import{l as ae,L as se}from"./expandable-section-header-edd4c2b3.js";import{l as ie}from"./text-input-7536667a.js";import"./ad-event-tracker-f9b59b5a.js";import"./shreddit-dynamic-ad-link-548337a6.js";import"./suggested-search-queries-client-js-e9a5ef2a.js";import"./faceplate-expandable-section-helper-d16b871c.js";import"./faceplate-auto-height-animator-eba3f9a9.js";import{c as ne,g as oe,C as ce}from"./content-tags-a35f6e45.js";import{g as he}from"./password-recovery-11761f51.js";var de;!function(e){e.COLLAPSED_SECTIONS="collapsedSections",e.QUERY="query"}(de||(de={}));let le;const pe=new Uint8Array(16);function ue(){if(!le&&(le="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!le))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return le(pe)}var me=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const ye=[];for(let e=0;e<256;++e)ye.push((e+256).toString(16).slice(1));function Se(e,t=0){return(ye[e[t+0]]+ye[e[t+1]]+ye[e[t+2]]+ye[e[t+3]]+"-"+ye[e[t+4]]+ye[e[t+5]]+"-"+ye[e[t+6]]+ye[e[t+7]]+"-"+ye[e[t+8]]+ye[e[t+9]]+"-"+ye[e[t+10]]+ye[e[t+11]]+ye[e[t+12]]+ye[e[t+13]]+ye[e[t+14]]+ye[e[t+15]]).toLowerCase()}function fe(e){if(!function(e){return"string"==typeof e&&me.test(e)}(e))throw TypeError("Invalid UUID");let t;const r=new Uint8Array(16);return r[0]=(t=parseInt(e.slice(0,8),16))>>>24,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r[4]=(t=parseInt(e.slice(9,13),16))>>>8,r[5]=255&t,r[6]=(t=parseInt(e.slice(14,18),16))>>>8,r[7]=255&t,r[8]=(t=parseInt(e.slice(19,23),16))>>>8,r[9]=255&t,r[10]=(t=parseInt(e.slice(24,36),16))/1099511627776&255,r[11]=t/4294967296&255,r[12]=t>>>24&255,r[13]=t>>>16&255,r[14]=t>>>8&255,r[15]=255&t,r}function be(e,t,r){function a(e,a,s,i){var n;if("string"==typeof e&&(e=function(e){e=unescape(encodeURIComponent(e));const t=[];for(let r=0;r<e.length;++r)t.push(e.charCodeAt(r));return t}(e)),"string"==typeof a&&(a=fe(a)),16!==(null===(n=a)||void 0===n?void 0:n.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let o=new Uint8Array(16+e.length);if(o.set(a),o.set(e,a.length),o=r(o),o[6]=15&o[6]|t,o[8]=63&o[8]|128,s){i=i||0;for(let e=0;e<16;++e)s[i+e]=o[e];return s}return Se(o)}try{a.name=e}catch(e){}return a.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",a.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",a}function ge(e){return 14+(e+64>>>9<<4)+1}function we(e,t){const r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function ve(e,t,r,a,s,i){return we((n=we(we(t,e),we(a,i)))<<(o=s)|n>>>32-o,r);var n,o}function Ee(e,t,r,a,s,i,n){return ve(t&r|~t&a,e,t,s,i,n)}function De(e,t,r,a,s,i,n){return ve(t&a|r&~a,e,t,s,i,n)}function Re(e,t,r,a,s,i,n){return ve(t^r^a,e,t,s,i,n)}function xe(e,t,r,a,s,i,n){return ve(r^(t|~a),e,t,s,i,n)}be("v3",48,(function(e){if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=new Uint8Array(t.length);for(let r=0;r<t.length;++r)e[r]=t.charCodeAt(r)}return function(e){const t=[],r=32*e.length,a="0123456789abcdef";for(let s=0;s<r;s+=8){const r=e[s>>5]>>>s%32&255,i=parseInt(a.charAt(r>>>4&15)+a.charAt(15&r),16);t.push(i)}return t}(function(e,t){e[t>>5]|=128<<t%32,e[ge(t)-1]=t;let r=1732584193,a=-271733879,s=-1732584194,i=271733878;for(let t=0;t<e.length;t+=16){const n=r,o=a,c=s,h=i;r=Ee(r,a,s,i,e[t],7,-680876936),i=Ee(i,r,a,s,e[t+1],12,-389564586),s=Ee(s,i,r,a,e[t+2],17,606105819),a=Ee(a,s,i,r,e[t+3],22,-1044525330),r=Ee(r,a,s,i,e[t+4],7,-176418897),i=Ee(i,r,a,s,e[t+5],12,1200080426),s=Ee(s,i,r,a,e[t+6],17,-1473231341),a=Ee(a,s,i,r,e[t+7],22,-45705983),r=Ee(r,a,s,i,e[t+8],7,1770035416),i=Ee(i,r,a,s,e[t+9],12,-1958414417),s=Ee(s,i,r,a,e[t+10],17,-42063),a=Ee(a,s,i,r,e[t+11],22,-1990404162),r=Ee(r,a,s,i,e[t+12],7,1804603682),i=Ee(i,r,a,s,e[t+13],12,-40341101),s=Ee(s,i,r,a,e[t+14],17,-1502002290),a=Ee(a,s,i,r,e[t+15],22,1236535329),r=De(r,a,s,i,e[t+1],5,-165796510),i=De(i,r,a,s,e[t+6],9,-1069501632),s=De(s,i,r,a,e[t+11],14,643717713),a=De(a,s,i,r,e[t],20,-373897302),r=De(r,a,s,i,e[t+5],5,-701558691),i=De(i,r,a,s,e[t+10],9,38016083),s=De(s,i,r,a,e[t+15],14,-660478335),a=De(a,s,i,r,e[t+4],20,-405537848),r=De(r,a,s,i,e[t+9],5,568446438),i=De(i,r,a,s,e[t+14],9,-1019803690),s=De(s,i,r,a,e[t+3],14,-187363961),a=De(a,s,i,r,e[t+8],20,1163531501),r=De(r,a,s,i,e[t+13],5,-1444681467),i=De(i,r,a,s,e[t+2],9,-51403784),s=De(s,i,r,a,e[t+7],14,1735328473),a=De(a,s,i,r,e[t+12],20,-1926607734),r=Re(r,a,s,i,e[t+5],4,-378558),i=Re(i,r,a,s,e[t+8],11,-2022574463),s=Re(s,i,r,a,e[t+11],16,1839030562),a=Re(a,s,i,r,e[t+14],23,-35309556),r=Re(r,a,s,i,e[t+1],4,-1530992060),i=Re(i,r,a,s,e[t+4],11,1272893353),s=Re(s,i,r,a,e[t+7],16,-155497632),a=Re(a,s,i,r,e[t+10],23,-1094730640),r=Re(r,a,s,i,e[t+13],4,681279174),i=Re(i,r,a,s,e[t],11,-358537222),s=Re(s,i,r,a,e[t+3],16,-722521979),a=Re(a,s,i,r,e[t+6],23,76029189),r=Re(r,a,s,i,e[t+9],4,-640364487),i=Re(i,r,a,s,e[t+12],11,-421815835),s=Re(s,i,r,a,e[t+15],16,530742520),a=Re(a,s,i,r,e[t+2],23,-995338651),r=xe(r,a,s,i,e[t],6,-198630844),i=xe(i,r,a,s,e[t+7],10,1126891415),s=xe(s,i,r,a,e[t+14],15,-1416354905),a=xe(a,s,i,r,e[t+5],21,-57434055),r=xe(r,a,s,i,e[t+12],6,1700485571),i=xe(i,r,a,s,e[t+3],10,-1894986606),s=xe(s,i,r,a,e[t+10],15,-1051523),a=xe(a,s,i,r,e[t+1],21,-2054922799),r=xe(r,a,s,i,e[t+8],6,1873313359),i=xe(i,r,a,s,e[t+15],10,-30611744),s=xe(s,i,r,a,e[t+6],15,-1560198380),a=xe(a,s,i,r,e[t+13],21,1309151649),r=xe(r,a,s,i,e[t+4],6,-145523070),i=xe(i,r,a,s,e[t+11],10,-1120210379),s=xe(s,i,r,a,e[t+2],15,718787259),a=xe(a,s,i,r,e[t+9],21,-343485551),r=we(r,n),a=we(a,o),s=we(s,c),i=we(i,h)}return[r,a,s,i]}(function(e){if(0===e.length)return[];const t=8*e.length,r=new Uint32Array(ge(t));for(let a=0;a<t;a+=8)r[a>>5]|=(255&e[a/8])<<a%32;return r}(e),8*e.length))}));var ke,Ie={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function Ce(e,t,r){if(Ie.randomUUID&&!e)return Ie.randomUUID();const a=(e=e||{}).random||(e.rng||ue)();return a[6]=15&a[6]|64,a[8]=63&a[8]|128,Se(a)}function $e(e,t,r,a){switch(e){case 0:return t&r^~t&a;case 1:case 3:return t^r^a;case 2:return t&r^t&a^r&a}}function Te(e,t){return e<<t|e>>>32-t}be("v5",80,(function(e){const t=[1518500249,1859775393,2400959708,3395469782],r=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof e){const t=unescape(encodeURIComponent(e));e=[];for(let r=0;r<t.length;++r)e.push(t.charCodeAt(r))}else Array.isArray(e)||(e=Array.prototype.slice.call(e));e.push(128);const a=e.length/4+2,s=Math.ceil(a/16),i=new Array(s);for(let t=0;t<s;++t){const r=new Uint32Array(16);for(let a=0;a<16;++a)r[a]=e[64*t+4*a]<<24|e[64*t+4*a+1]<<16|e[64*t+4*a+2]<<8|e[64*t+4*a+3];i[t]=r}i[s-1][14]=8*(e.length-1)/Math.pow(2,32),i[s-1][14]=Math.floor(i[s-1][14]),i[s-1][15]=8*(e.length-1)&4294967295;for(let e=0;e<s;++e){const a=new Uint32Array(80);for(let t=0;t<16;++t)a[t]=i[e][t];for(let e=16;e<80;++e)a[e]=Te(a[e-3]^a[e-8]^a[e-14]^a[e-16],1);let s=r[0],n=r[1],o=r[2],c=r[3],h=r[4];for(let e=0;e<80;++e){const r=Math.floor(e/20),i=Te(s,5)+$e(r,n,o,c)+h+t[r]+a[e]>>>0;h=c,c=o,o=Te(n,30)>>>0,n=s,s=i}r[0]=r[0]+s>>>0,r[1]=r[1]+n>>>0,r[2]=r[2]+o>>>0,r[3]=r[3]+c>>>0,r[4]=r[4]+h>>>0}return[r[0]>>24&255,r[0]>>16&255,r[0]>>8&255,255&r[0],r[1]>>24&255,r[1]>>16&255,r[1]>>8&255,255&r[1],r[2]>>24&255,r[2]>>16&255,r[2]>>8&255,255&r[2],r[3]>>24&255,r[3]>>16&255,r[3]>>8&255,255&r[3],r[4]>>24&255,r[4]>>16&255,r[4]>>8&255,255&r[4]]})),function(e){e.QUERY="query",e.TRENDING="trending",e.TYPEAHEAD="typeahead"}(ke||(ke={}));const Ue=/^m\/([\w+-]+)\/?/,qe=/^r\/([\w+-]+)\/?/;var _e;!function(e){e.QUERY="query",e.SUBREDDIT="subreddit",e.MULTIREDDIT="multireddit",e.PROFILE="profile"}(_e||(_e={}));const Qe=()=>M(t.RecentSearches)||[],Ae=e=>{z(t.RecentSearches,e)};function Ne(e){return!!e&&[r.SearchResults,r.SearchResultsTrending].includes(e)}const Be=/^(\/?[r|u]\/)/,Pe="reddit-recent-searches-partial-container",Le="reddit-suggested-search-queries-container",Fe="search-input",Oe="search-input-remove-filter",je="search-dropdown-results-container",Me="reddit-trending-searches-partial-container",ze="reddit-typeahead-results-partial-container",Ye={size:U.Small,attributes:{"aria-hidden":"true",className:"flex items-center justify-center h-100 ml-px"}};var Ge,Ve,Je;!function(e){e.Backspace="pill-backspace",e.Click="pill-click"}(Ge||(Ge={})),function(e){e.SearchDropdown="search_dropdown"}(Ve||(Ve={})),function(e){e.ListingBelow="listing-below",e.PostQuerySearch="post-query-search"}(Je||(Je={}));class Ke extends(s(j)){constructor(){super(...arguments),this.scope=a,this.mobileExpandSearchBar=!1,this.isPdpSeekerM2=!1,this.suggestedSearchQueries=[],this.query="",this.isSearchScopeEnabled=!1,this.trendingSearches=null,this.isFocused=!1,this.typeaheadResults=null,this.recentSearches=Qe(),this.showDropdown=!1,this.loadingSearchResults=!1,this.hasFiredDynamicTypeaheadQuerySuggestionsExposeEvent=!1,this.debouncedSearch=i(this.fetchTypeaheadResults,300),this.getPageType=n,this.partialRequest=new o(this),this.exposeClientExperiment=c,this.activateFeature=h,this.searchScrollBlockingController=null,this.handleRecentSearchDataUpdate=(t,r)=>{const{query:s,profile:i,subreddit:n,multireddit:o}=this,c=r?.target?.closest('[role="menuitem"]'),h=((t,r,s)=>{const{query:i,profile:n,scope:o,subreddit:c,multireddit:h,isSearchScopeEnabled:d}=r;switch(t){case ke.TRENDING:if(s){const e=s.href,t=s?.querySelectorAll('[data-type="search-dropdown-item-label-text"]')?.[0]?.textContent,r=JSON.parse(s?.closest('[data-type="search-dropdown-item"]')?.getAttribute("data-faceplate-tracking-context")||"{}");if(t&&e)return{type:_e.QUERY,name:t,path:e,trackingContext:r,rawQuery:i,uuid:Ce()}}break;case ke.TYPEAHEAD:if(s){const e=s.href,t=s?.querySelectorAll('[data-type="search-dropdown-item-label-text"]')?.[0]?.textContent,r=JSON.parse(s?.closest('[data-type="search-dropdown-item"]')?.getAttribute("data-faceplate-tracking-context")||"{}"),a=s?.querySelector("faceplate-img,img")?.src,n=!!s.getElementsByClassName("text-alert-caution").length,o=!!s.getElementsByClassName("text-category-nsfw").length;let c=_e.QUERY;if(t&&qe.test(t)?c=_e.SUBREDDIT:t&&Ue.test(t)&&(c=_e.MULTIREDDIT),t&&e)return{type:c,name:t,path:e,isNsfw:o,isQuarantined:n,icon:a,trackingContext:r,rawQuery:i,uuid:Ce()}}break;case ke.QUERY:if(i){const t=d?o:a,r=Y(t),s={[e.GLOBAL]:"",[e.COMMUNITY]:c?.communityIcon,[e.CUSTOM_FEED]:h?.icon,[e.PROFILE]:n?.icon}[t.type];let l=i.trim();d&&t.type!==e.GLOBAL&&(l=`${r} ${l}`);const p=W({cursor:{},query:i.trim(),scope:t});return{type:_e.QUERY,name:l,path:p,icon:s,rawQuery:i,uuid:Ce()}}}return null})(t,{query:s,scope:this.scope,profile:i,subreddit:n,multireddit:o,isSearchScopeEnabled:this.isSearchScopeEnabled},c);if(h){const e=Qe()?.filter((e=>e?.name!==h.name));e.length>=d&&e.pop(),e.unshift(h),Ae(e)}},this.handlePageDataReceived=e=>{const{profile:t,search:a,subreddit:s,multireddit:i}=e;a?.query&&this.pageType===r.SearchResults&&(this.query=a.query),this.subreddit=s||void 0,this.profile=t||void 0,this.multireddit=i||void 0},this.handleEmptyTypeahead=()=>{this.typeaheadResults=null,this.isFocused&&!this.trendingSearches&&this.fetchTrendingSearches()},this.handleSearchInput=e=>{this.handleQueryChange(e.target.value)},this.handleQueryChange=e=>{this.query!==e&&(e||this.handleEmptyTypeahead(),ee.update(l.Qf),this.query=e,this.query&&this.debouncedSearch())},this.handleSubmit=(e,t=this.activeSearchScope)=>{e.preventDefault(),this.handleRecentSearchDataUpdate(ke.QUERY),this.redirect(this.getSearchUrl(t))},this.redirect=e=>{window.location.href=e},this.handleClear=()=>{this.handleQueryChange(""),this.input&&this.input.checkVisibility()&&(this.input.value="",this.input.focus())},this.focusSearchInput=()=>{this.input?.focus()},this.handleRemoveFilter=e=>{this.isSearchScopeEnabled&&this.searchScopePillDismissButton&&(p(this.searchScopePillDismissButton,{source:"search",action:"click",noun:"disable_scope",action_info:{type:e}}),this.typeaheadResults=null,this.isSearchScopeEnabled=!1,this.focusSearchInput(),this.maybeFetchDropdownItems())},this.handleFilterClick=e=>{e.preventDefault()},this.resetIsSearchScopeEnabled=()=>{this.isSearchScopeEnabled=this.isSearchScopeInitiallyEnabled},this.handleFocus=()=>{this.isFocused||(this.isFocused=!0,p(this.input,{source:"search",action:"click",noun:"search_bar"}),this.mobileExpandSearchBar&&p(this.input,{source:"nav",action:"click",noun:"search_opened"}),window.addEventListener("click",this.handleClickAway),this.searchScrollBlockingController?.blockPageScrollingForSearch(),this.maybeFetchDropdownItems())},this.handleClickAway=e=>{e.target===this||this.shadowRoot.contains(e.target)||this.handleBlur()},this.handleBlur=()=>{this.input?.blur(),this.isFocused=!1,window.removeEventListener("click",this.handleClickAway),this.searchScrollBlockingController?.unblockPageScrollingForSearch(),ee.update(l.Qf),te.set(l.Qf)},this.maybeUpdateDropdownState=()=>{const e=Boolean(this.isFocused&&(this.query&&(!this.isQueryPromptDisabled||this.typeaheadResults)||!this.query&&this.trendingSearches));this.showDropdown!==e&&(!this.showDropdown&&e?(this.showDropdown=!0,this.handleDropdownShown()):this.showDropdown=!1)},this.handleDropdownShown=()=>{p(this.searchDropdownResultsContainer,{source:"global",action:"view",noun:"screen",action_info:{page_type:r.SearchDropdown}}),this.dispatchEvent(new Event(G))},this.handleDropdownKeyDown=()=>{},this.renderSeekerSearchQueries=(e,t)=>q` <ul role="menu" id="${Le}" @keydown="${this.handleDropdownKeyDown}" class="m-0 p-0 list-none"> ${e.map((e=>ae({attributes:{className:"suggested-search-item",role:"menuitem",tabindex:"-1"},onClick:()=>{t&&(this.activateFeature({name:u,queryParams:{context:Je.PostQuerySearch,q:e},renderMode:m.Contents}),this.query=e,this.handleBlur())},label:q`<div class="text-neutral-content">${e}</div>`,size:se.Small})))} </ul> `}static get styles(){return[y,S(".search-input {\n  -webkit-appearance: none;\n}\n.search-input::-webkit-search-cancel-button {\n  display: none;\n}\n@media screen and (max-width: 768px) {\n  faceplate-search-input {\n    --font-14-20-regular: var(--font-16-20-regular);\n  }\n}\n.last-dropdown-item [role='menuitem'],\n.last-dropdown-item:hover [role='menuitem'],\n.last-dropdown-item:active [role='menuitem'],\n.last-dropdown-item:focus [role='menuitem'] {\n  border-bottom-left-radius: 1.25rem;\n  border-bottom-right-radius: 1.25rem;\n}\n.last-dropdown-section:not([open]) summary,\n.last-dropdown-section:not([open]):hover summary,\n.last-dropdown-section:not([open]):active summary,\n.last-dropdown-section:not([open]):focus summary,\n.last-dropdown-section:not([open]) summary [tabindex='-1'],\n.last-dropdown-section:not([open]):hover summary [tabindex='-1'],\n.last-dropdown-section:not([open]):active summary [tabindex='-1'],\n.last-dropdown-section:not([open]):focus summary [tabindex='-1'] {\n  border-bottom-left-radius: 1.25rem;\n  border-bottom-right-radius: 1.25rem;\n}\n")]}get isQueryPromptDisabled(){return"enabled"===this.dynamicTypeaheadQuerySuggestionsExperimentVariant}connectedCallback(){super.connectedCallback(),this.pageType=this.getPageType(),this.isSearchScopeEnabled=this.isSearchScopeInitiallyEnabled,this.query=this.initialQuery??"",this.subscribe(f.PageDataLoaded,this.handlePageDataReceived),this.omitDynamicId&&(te.shouldOverrideId=!0,ee.shouldOverrideId=!0,re.shouldOverrideId=!0)}disconnectedCallback(){super.disconnectedCallback(),this.unsubscribe(f.PageDataLoaded,this.handlePageDataReceived),this.handleBlur()}updated(e){this.loadingSearchResults&&(e.has("typeaheadResults")||e.has("trendingSearches"))&&(this.loadingSearchResults=!1)}normalizeQuery(e){if(!e)return"";return e.toLowerCase().trim().replace(Be,"")}getAdParam(){return new URL(window.location.href).searchParams.get(X.Ad)}handleDeleteRecentSearchItem(e){const t=this.recentSearches.filter((t=>t?.uuid!==e));this.recentSearches=t,Ae(t)}async fetchTrendingSearches(){if(this.isSearchScopeEnabled)return;this.loadingSearchResults=!0;const e=this.getAdParam(),t=new URLSearchParams({[X.ConversationId]:te.get(l.Qf),...e?{[X.Ad]:e}:{}}),r=await this.partialRequest.request(`/svc/shreddit/trending-searches?${t.toString()}`),a=await(r?.text());if(a&&this.trendingSearchesContainer){const e=b(a),t=e.find((e=>e.attributes.getNamedItem(g.IsPromoted)));t&&t.querySelector("[role=menuitem]")?.addEventListener("keydown",(function(e){"Enter"===e.key&&e.target?.dispatchEvent(new MouseEvent("click",{bubbles:!0}))})),this.trendingSearches=e}}async fetchTypeaheadResults(){if(this.dynamicTypeaheadQuerySuggestionsExperimentVariant&&!this.hasFiredDynamicTypeaheadQuerySuggestionsExposeEvent&&this.exposeClientExperiment({experimentName:V,variant:this.dynamicTypeaheadQuerySuggestionsExperimentVariant}).then((()=>{this.hasFiredDynamicTypeaheadQuerySuggestionsExposeEvent=!0})).catch((()=>{})),this.isSearchScopeEnabled&&!this.isQueryPromptDisabled)return;this.loadingSearchResults=!0;const e={[de.QUERY]:this.normalizeQuery(this.query)},r=Object.entries(M(t.SearchTypeaheadExpanded)??{}).reduce(((e,[t,r])=>(r||e.push(t),e)),[]).join(",");r&&(e[de.COLLAPSED_SECTIONS]=r);const s=new URLSearchParams(e),i=await this.partialRequest.request(`/svc/shreddit${this.isSearchScopeEnabled?this.scope.path:a.path}search-typeahead?${s.toString()}`),n=await(i?.text());n&&this.typeaheadResultsContainer?this.typeaheadResults=b(n):this.handleEmptyTypeahead()}get isSearchScopeInitiallyEnabled(){return this.scope.type!==e.GLOBAL&&!document.querySelector("#shreddit-forbidden")}get activeSearchScope(){return this.isSearchScopeEnabled?this.scope:a}maybeFetchDropdownItems(){this.query||this.recentSearches||(this.recentSearches=Qe()),this.query||this.trendingSearches?this.query&&!this.typeaheadResults&&this.fetchTypeaheadResults():this.fetchTrendingSearches()}getSearchUrl(e){return W({conversationId:te.get(l.Qf),cursor:{},impressionId:ee.getUUID(),query:this.query,scope:e})}get searchTelemetryData(){const t={action_info:{pane_name:Ve.SearchDropdown},search:{conversation_id:te.get(l.Qf),impression_id:ee.get(l.Qf),origin_element:"search_bar",origin_page_type:this.pageType??"",query:this.query,query_id:re.get({query:this.query,scope:a},l.Qf),range:w.ALL,sort:v,typeahead_active:this.isFocused}};if(this.isSearchScopeEnabled||this.isSearchScopeTelemetryExperimentEnabled){const{type:r,path:s}=this.isSearchScopeEnabled?this.scope:a;t.search=((t,r,{subreddit_id:a,subreddit_name:s,custom_feed_id:i,scope_type:n,scope_id:o,scope_name:c,scope_path:h}={},d)=>{if(d){const e={...c?{scope_name:c}:{},...o?{scope_id:o}:{}};return{...t,...e,scope_type:n,scope_path:h}}return{[e.COMMUNITY]:{...t,subreddit_id:a,subreddit_name:s},[e.CUSTOM_FEED]:{...t,custom_feed_id:i},[e.PROFILE]:t,[e.GLOBAL]:t,[e.PDP]:t}[r]})(t.search,r,{scope_id:this.isSearchScopeEnabled?this.subreddit?.id:"",scope_name:this.isSearchScopeEnabled?this.subreddit?.name:"",scope_type:r,scope_path:s,subreddit_id:this.subreddit?.id,subreddit_name:this.subreddit?.name,custom_feed_id:this.multireddit?.path},this.isSearchScopeTelemetryExperimentEnabled)}return t}handleTypeaheadResultsClick(e,t=ke.TYPEAHEAD){const a=document.querySelector("shreddit-good-visit-tracker");a&&(a.pageType=r.SearchDropdown,a.setScreenViewData({...this.searchTelemetryData,action_info:{...this.searchTelemetryData.action_info,page_type:r.SearchDropdown}})),this.handleRecentSearchDataUpdate(t,e)}willUpdate(){this.maybeUpdateDropdownState()}handleKeyDown(t){if("Backspace"!==t.key||this.query||this.scope.type===e.GLOBAL){if("Enter"===t.key&&this.query&&t.target.id===Fe){const{activeSearchScope:e}=this;p(this.input,{source:"search",action:"click",noun:"full_search_button"}),this.handleSubmit(t,e)}}else this.isScopedSearchPillHidden||this.handleRemoveFilter(Ge.Backspace)}renderSearchInput(e=!1){const t=J(this.activeSearchScope,this.mobileExpandSearchBar),r={action_info:{type:`input-${this.activeSearchScope.type}`}};return q` <faceplate-search-input @focus="${this.handleFocus}" @input="${this.handleSearchInput}" @keydown="${this.handleKeyDown}" class="search-input m-0 flex-1 w-full outline-none p-0 font-sans placeholder:text-neutral-content-weak ${E({"mr-md":!e&&!this.mobileExpandSearchBar,"mr-sm":!e&&this.mobileExpandSearchBar&&(!he()||Ne(this.pageType)||this.isFocused),"ml-sm":!e&&this.mobileExpandSearchBar&&!Ne(this.pageType)&&!this.isFocused,"bg-secondary-background":this.mobileExpandSearchBar,"focus:bg-transparent":this.mobileExpandSearchBar,"rounded-full":this.mobileExpandSearchBar})}" data-faceplate-tracking-context="${JSON.stringify(r)}" autocomplete="off" enterkeyhint="search" id="${Fe}" inputmode="" maxlength="${128}" name="q" novalidate placeholder="${e||!this.isSearchScopeEnabled||this.mobileExpandSearchBar&&!this.isFocused&&!this.showDropdown?t:""}" role="search" type="search" value="${ie(this.query)}">${this.renderScopedSearchPill()} ${D({attributes:{className:this.mobileExpandSearchBar&&!this.isFocused?"hidden":"",id:"search-input-clear-button",slot:"clearIcon",type:"button",onclick:this.handleClear},appearance:"plain",size:R.Small,screenReaderContent:"Clear search",leadingIcon:_({size:U.Small})})} </faceplate-search-input>`}renderRecentSearchItem(e){const{icon:t,path:r,name:a,type:s,isNsfw:i,rawQuery:n,isQuarantined:o,trackingContext:c}=e,h={...c||{},search:{query:n}};let d;if(t||i){const e=i?"Recent search not safe for work icon":`${a} icon`,r=i?`${window?.CLIENT_CONFIG?.STATIC_BASE_URL}assets/avatar_over18.png`:t;d=q`<faceplate-img class="rounded-full h-lg w-lg flex items-center justify-center static" loading="lazy" src="${r}" width="16" height="16" alt="${e}"></faceplate-img>`}else d=s===_e.SUBREDDIT?q`${Q({size:U.Small,attributes:{"aria-hidden":"true",className:"flex items-center justify-center h-100 ml-px"}})}`:s===_e.MULTIREDDIT?q`${A({size:U.Small,attributes:{"aria-hidden":"true",className:"flex items-center justify-center h-100 ml-px"}})} `:N({size:U.Small});const l=D({appearance:"plain",leadingIcon:_({size:U.Small}),shape:"pill",screenReaderContent:`Delete ${a} from recent searches`,size:R.Small,attributes:{tabindex:"-1",className:"recent-search-item-delete-button",onclick:t=>{t?.stopPropagation(),t?.preventDefault(),this.handleDeleteRecentSearchItem(e.uuid)}}}),p=o?q`<span class="text-alert-caution inline-block"> ${ne(oe()[ce.QUARANTINED])} </span>`:q``;return q` <faceplate-tracker source="search" action="click" noun="recent_search" data-type="search-dropdown-item" data-faceplate-tracking-context="${JSON.stringify(h)}"> <faceplate-tracker source="search" action="view" noun="recent_search" loading-modifier="${x.Always}" role="none"> ${ae({anchorAttributes:{"aria-label":`Recent search for ${a}`},attributes:{className:"recent-search-item",role:"menuitem",tabindex:"-1"},href:r,onClick:()=>{const t=this.recentSearches.filter((t=>t.uuid!==e.uuid));t.unshift(e),Ae(t)},leadingAvatar:d,label:q` <div class="flex items-center px-4 py-2 gap-2xs align-baseline"> <div class="text-neutral-content flex-grow">${a}</div> </div>`,trailingSlot:l,description:p,size:se.Small})} </faceplate-tracker> </faceplate-tracker> `}renderRecentSearches(){const e=q`${this.recentSearches.reduce(((e,t)=>{const r=this.renderRecentSearchItem(t);return r&&e.push(r),e}),[])}`;return q` <div class="w-full border-solid border-b-sm border-t-0 border-r-0 border-l-0 border-neutral-border ${E({hidden:this.query})}"> <ul class="p-0 m-0 border-none" id="${Pe}" @keydown="${this.handleDropdownKeyDown}"> ${e} </ul> </div>`}renderTrendingSearches(){const e=this.query||!this.trendingSearches;return q` <div class="ml-md mt-sm mb-2xs text-neutral-content-weak flex items-center ${E({hidden:e})}"> ${B({attributes:{"aria-hidden":"true",className:"mr-2xs"},size:U.Small})} TRENDING TODAY </div> <ul class="list-none mt-0 mb-0 p-0 search-results-list ${E({hidden:e})}" id="${Me}" @keydown="${this.handleDropdownKeyDown}" @click="${e=>this.handleRecentSearchDataUpdate(ke.TRENDING,e)}" role="menu" aria-busy="${this.loadingSearchResults}"> ${this.trendingSearches} </ul> `}renderTypeaheadResults(e=!1){const t=this.isQueryPromptDisabled?"":this.renderQueryPrompt();return q`<ul id="${ze}" class="list-none mt-0 mb-0 p-0 search-results-list min-w-0 ${E({"px-md":e,"-mx-md":e,hidden:!this.query})}" @click="${this.handleTypeaheadResultsClick}" @keydown="${this.handleDropdownKeyDown}" role="menu" aria-busy="${this.loadingSearchResults}"> ${this.typeaheadResults??""}${t} </ul>`}getQueryPromptLabel(t){return this.isSearchScopeEnabled&&t.type!==e.GLOBAL?`Search for "${this.query}" in ${Y(t)}`:`Search for "${this.query}"`}renderQueryPrompt(){const e={action_info:{type:`prompt-${this.activeSearchScope.type.toLowerCase()}`}};let t=C;return this.typeaheadResults&&(t+=" border-solid border-neutral-border-weak border-0 border-t-sm"),K(this.query,q`<faceplate-tracker source="search" action="view" noun="query_prompt" loading-modifier="${x.Always}" data-faceplate-tracking-context="${JSON.stringify(e)}" data-type="search-dropdown-item"><faceplate-tracker source="search" action="click" noun="full_search_button">${ae({attributes:{className:t,id:`search-query-prompt-${this.activeSearchScope.type.toLowerCase()}`,tabindex:"-1",role:"menuitem"},href:this.getSearchUrl(this.activeSearchScope),label:q`<span class="text-neutral-content line-clamp-1 break-all">${this.getQueryPromptLabel(this.activeSearchScope)}</span>`,leadingIcon:P({attributes:{"aria-hidden":"true",className:"pr-2xs"},size:U.Small}),onClick:e=>this.handleSubmit(e,this.activeSearchScope)})}</faceplate-tracker></faceplate-tracker>`)}renderScopedSearchPill(){if(this.isScopedSearchPillHidden&&!this.showDropdown&&!this.isFocused||this.scope.type===e.GLOBAL||!this.isSearchScopeEnabled)return L;const t=Y({type:this.scope.type,path:this.scope.path}),r={search:{origin_element:Z.SearchBarPill},...this.subreddit?{subreddit:{id:this.subreddit.id,quarantined:this.subreddit.isQuarantined,nsfw:this.subreddit.isNsfw,name:this.subreddit.name}}:{}};return H({attributes:{id:"search-input-chip",onclick:this.handleFilterClick,slot:"chips",className:this.mobileExpandSearchBar?"max-w-[8rem]":""},deleteButtonConfig:{screenReaderContent:`Remove ${t} filter and expand search to all of Reddit`,attributes:{"data-faceplate-tracking-context":JSON.stringify(r),id:Oe,onclick:()=>this.handleRemoveFilter(Ge.Click),type:"button"}},screenReaderContent:`Current search is within ${t}`,selected:!0,leadingIcon:this.getChipIcon(),children:q`<span aria-hidden="true">${t}</span>`})}getChipIcon(){if(this.scope.type===e.GLOBAL)return q``;const{defaultIcon:t,iconUrl:r,isScopeNsfw:a}={[e.COMMUNITY]:{defaultIcon:Q,iconUrl:this.subreddit?.communityIcon,isScopeNsfw:this.subreddit?.isNsfw},[e.CUSTOM_FEED]:{defaultIcon:A,iconUrl:this.multireddit?.icon,isScopeNsfw:this.multireddit?.isNsfw},[e.PROFILE]:{defaultIcon:F,iconUrl:this.profile?.icon,isScopeNsfw:this.profile?.isNsfw}}[this.scope.type];return a&&!this.isNsfwEnabled?q`${O(Ye)}`:r?q`<div class="w-full h-full flex justify-center items-center"> <img height="16" width="16" class="rounded-full overflow-hidden" src="${r}" role="presentation"> </div>`:q`${t(Ye)}`}renderDropdownContent(e){const t=[],r=!this.query;return this.isPdpSeekerM2&&this.suggestedSearchQueries.length>0&&t.push(this.renderSeekerSearchQueries(this.suggestedSearchQueries,e)),r&&this.recentSearches.length&&t.push(this.renderRecentSearches()),[...t,this.renderTrendingSearches(),this.renderTypeaheadResults(e)]}}k([$({attribute:"initial-query",type:String})],Ke.prototype,"initialQuery",void 0),k([$({attribute:"scope",type:Object})],Ke.prototype,"scope",void 0),k([$({attribute:"omit-dynamic-id",type:Boolean})],Ke.prototype,"omitDynamicId",void 0),k([$({attribute:"is-nsfw-enabled",type:Boolean})],Ke.prototype,"isNsfwEnabled",void 0),k([$({attribute:"dynamic-typeahead-query-suggestions-variant",type:String})],Ke.prototype,"dynamicTypeaheadQuerySuggestionsExperimentVariant",void 0),k([$({attribute:"is-search-scope-telemetry-experiment-enabled",type:Boolean})],Ke.prototype,"isSearchScopeTelemetryExperimentEnabled",void 0),k([$({attribute:"is-scoped-search-pill-hidden",type:Boolean})],Ke.prototype,"isScopedSearchPillHidden",void 0),k([$({type:Boolean,attribute:"mobile-expand-search-bar"})],Ke.prototype,"mobileExpandSearchBar",void 0),k([$({type:Boolean,attribute:"is-pdp-seeker-m2"})],Ke.prototype,"isPdpSeekerM2",void 0),k([$({type:Array,attribute:"suggested-search-queries"})],Ke.prototype,"suggestedSearchQueries",void 0),k([T(".search-input",!0)],Ke.prototype,"input",void 0),k([T(`#${ze}`)],Ke.prototype,"typeaheadResultsContainer",void 0),k([T("#typeahead-results-nsfw-section")],Ke.prototype,"typeaheadResultsNsfwSection",void 0),k([T(`#${Me}`)],Ke.prototype,"trendingSearchesContainer",void 0),k([T(`#${Pe}`)],Ke.prototype,"recentSearchesContainer",void 0),k([T(`#${Oe}`)],Ke.prototype,"searchScopePillDismissButton",void 0),k([T(`#${je}`)],Ke.prototype,"searchDropdownResultsContainer",void 0),k([T(`#${Le}`)],Ke.prototype,"suggestedSearchResultsContainer",void 0),k([I()],Ke.prototype,"query",void 0),k([I()],Ke.prototype,"subreddit",void 0),k([I()],Ke.prototype,"profile",void 0),k([I()],Ke.prototype,"multireddit",void 0),k([I()],Ke.prototype,"pageType",void 0),k([I()],Ke.prototype,"isSearchScopeEnabled",void 0),k([I()],Ke.prototype,"trendingSearches",void 0),k([I()],Ke.prototype,"isFocused",void 0),k([I()],Ke.prototype,"typeaheadResults",void 0),k([I()],Ke.prototype,"recentSearches",void 0),k([I()],Ke.prototype,"showDropdown",void 0),k([I()],Ke.prototype,"loadingSearchResults",void 0),k([I()],Ke.prototype,"hasFiredDynamicTypeaheadQuerySuggestionsExposeEvent",void 0);export{Ke as R,je as S,Pe as a,Ne as p};
