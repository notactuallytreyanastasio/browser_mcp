import"./auth-flow-sso-buttons-9d6bd65e.js";import{b as t,a9 as e,aa as s,ab as i,bb as o,b3 as n,a as r,W as a,t as l,_ as h,n as d,df as c,E as u,P as p,aF as m,dg as b,T as v,a2 as y,H as w,am as g,e as S}from"./shell-2264602c.js";import{W as f}from"./with-recaptcha-32f8e610.js";import{O,H as k}from"./age-gate-standalone-client-js-5357b0cf.js";import{a as C,s as x,x as A}from"./icon-82dd10b4.js";import"./shreddit-slotter-254a5056.js";import"./auth-flow-link-577688ed.js";import{C as E}from"./cbau-81b2f8bd.js";import"./faceplate-tabpanel-a0eacfa8.js";import"./email-verification-error-client-js-ed45b005.js";import"./auth-text-input-a0f508fc.js";import"./auth-flow-controller-ebc6bc41.js";import"./password-recovery-11761f51.js";import"./helpers-e162eb2b.js";import"./google-api-3da8618d.js";import"./promote-post-actions-controller-f5bf291f.js";import"./utils-19e4b642.js";import"./validate-image-b0892d29.js";import"./text-input-7536667a.js";import"./filterNullish-60f7e90f.js";import"./constants-d65b7b38.js";const _=e=>t({source:"onboarding",action:"view",noun:"upsell_unit"},{action_info:{page_type:e}}),I=()=>t({source:"onboarding",action:"click",noun:"upsell_unit"},{action_info:{type:"not_now"}}),B=()=>async function(t,s){await e(t,s)}(i.Dismiss,s.BypassableXpromo);const j=new Set(o.map((t=>n({source:O,action:k,noun:t})))),L=r(a(f(x)));let T=class extends L{get shredditSlotterElm(){return this.shadowRoot?.querySelector("shreddit-slotter")}get bottomSheet(){return this.shredditSlotterElm?.shadowRoot?.querySelector("#inline-auth-upsell-bottom-sheet-modal")}get isInlineRendered(){return this.shredditSlotterElm?.getAttribute("slot-name")===c.InlineAuthLandingExperienceXpromo}constructor(){super(),this.isOverlay=!1,this.events=new u(this),this._authFlowModalOpen=!1,this._cachedYScrollPosition=0,this.mounted=!1,this.pubSubController=new p(this),this.cacheCurrentScrollPosition=()=>{this.isInlineRendered&&(this._cachedYScrollPosition=window.scrollY||window.pageYOffset)},this.debouncedCacheCurrentScrollPosition=m(this.cacheCurrentScrollPosition,300),this._handleDismissButtonClick=()=>{this.trackEvent(I()),this.bottomSheet?.close(),this._unmount()},this.onShredditSlotterNameChanged=this.events.define("shreddit-slotter-slot-name-changed",(t=>{this.onSlotterRouteChange(t.detail.slotName)})),this._onAuthFlowModalOpen=this.events.define(b.Open,(()=>{this._authFlowModalOpen=!0,this.setIsOverlayAttr()})),this.onFaceplateTrack=this.events.define("faceplate-track",(t=>{t.SAN&&j.has(t.SAN)&&(this._authFlowModalOpen=!1,this.setIsOverlayAttr(),this.switchToInlineXpromo())})),this.pubSubController.subscribe(v.TriggerCommentBlockingAuth,(t=>this.openBottomSheet(t)),!1)}connectedCallback(){super.connectedCallback(),this.isObserved||this.enableObserver({threshold:.8}),document.addEventListener("scroll",this.debouncedCacheCurrentScrollPosition,{passive:!0})}disconnectedCallback(){super.disconnectedCallback(),this.isObserved&&this.disableObserver(),document.removeEventListener("scroll",this.debouncedCacheCurrentScrollPosition)}bindDismissButtonListener(){const t=this.shredditSlotterElm?.shadowRoot?.querySelector("#inline-auth-upsell-bottom-sheet-modal-close");t?.addEventListener("click",this._handleDismissButtonClick)}updated(t){super.updated(t);!0===t.get("isOverlay")&&this.onReturnFromOverlay()}onReturnFromOverlay(){setTimeout((()=>{window.scrollTo(0,this._cachedYScrollPosition)}),0)}_unmount(){this.remove()}switchToInlineXpromo(){this.shredditSlotterElm?.setAttribute("slot-name",c.InlineAuthLandingExperienceXpromo)}openBottomSheet({source:t}){this.triggerType===t&&this.bottomSheet?.show()}observerIsIntersectingCallback(){if(this.disableObserver(),this.mounted)return;this.mounted=!0,B();const t=y()??w.Unknown;this.trackEvent(_(t))}setIsOverlayAttr(){const t=this.shredditSlotterElm?.getAttribute("slot-name");this.isOverlay=this._authFlowModalOpen||t!==c.InlineAuthLandingExperienceXpromo}onSlotterRouteChange(t){t===c.InlineAuthLandingExperienceXpromo&&this.bindDismissButtonListener(),this.setIsOverlayAttr()}renderAuthFlowTemplate(){const t=this.querySelector('template[slot="auth-flow"');return t instanceof HTMLTemplateElement?g(t):""}render(){return A` <div class="${"relative block -mt-3xl z-10 bg-neutral-background shadow-[0px_-40px_21px_var(--color-neutral-background)]"}">${super.render()} ${this.renderAuthFlowTemplate()}</div> `}};T.styles=[C`:host([is-overlay]){display:block;position:relative;z-index:100}`,l],h([d({type:Boolean,attribute:"is-overlay",reflect:!0})],T.prototype,"isOverlay",void 0),h([d({type:String,attribute:"trigger-type"})],T.prototype,"triggerType",void 0),T=h([S("inline-auth-landing-experience-xpromo-shell")],T);const F=new Set(o.map((t=>n({source:O,action:k,noun:t})))),R=r(a(x));let X=class extends R{constructor(){super(...arguments),this.isOverlay=!1,this.events=new u(this),this.isSlim=!1,this.delay=0,this.isVisible=!1,this.canBeShown=!1,this._authFlowModalOpen=!1,this.mounted=!1,this.pubSubController=new p(this),this._handleDismissButtonClick=()=>{this.trackEvent(I()),this._unmount()},this.onShredditSlotterNameChanged=this.events.define("shreddit-slotter-slot-name-changed",(t=>{this.onSlotterRouteChange(t.detail.slotName)})),this._onAuthFlowModalOpen=this.events.define(b.Open,(()=>{this._authFlowModalOpen=!0,this.setIsOverlayAttr()})),this.onFaceplateTrack=this.events.define("faceplate-track",(t=>{t.SAN&&F.has(t.SAN)&&(this._authFlowModalOpen=!1,this.setIsOverlayAttr(),this.switchToInlineXpromo())})),this.hideOrShow=({source:t})=>{t===E.Scroll?this.isVisible=!0:t===E.Close&&(this.isVisible=!1)}}get shredditSlotterElm(){return this.shadowRoot?.querySelector("shreddit-slotter")}get wrapper(){return this.shadowRoot?.querySelector(".wrapper")}get isInlineRendered(){return this.shredditSlotterElm?.getAttribute("slot-name")===c.InlineAuthLandingExperienceXpromo}connectedCallback(){super.connectedCallback(),this.delay?setTimeout((()=>{this.canBeShown=!0}),this.delay):this.canBeShown=!0,this.pubSubController.subscribe(v.TriggerCommentBlockingAuth,this.hideOrShow,!1),this.isObserved||this.enableObserver({threshold:.8})}disconnectedCallback(){super.disconnectedCallback(),this.isObserved&&this.disableObserver(),this.pubSubController.unsubscribe(v.TriggerCommentBlockingAuth,this.hideOrShow)}bindButtonListener(){const t=this.shredditSlotterElm?.shadowRoot?.querySelector("#desktop-cbau-close-button");t?.addEventListener("click",this._handleDismissButtonClick)}updated(t){super.updated(t);if(!0===t.get("isOverlay")||t.has("isVisible")||t.has("canBeShown")){const t=this.shadowRoot.querySelector(".content");this.isVisible&&this.canBeShown?(t.classList.remove("fade-out","hidden"),t.classList.add("fade-in")):(t.classList.remove("fade-in"),t.classList.add("fade-out"))}}_unmount(){this.remove()}switchToInlineXpromo(){this.shredditSlotterElm?.setAttribute("slot-name",c.InlineAuthLandingExperienceXpromo)}observerIsIntersectingCallback(){if(this.disableObserver(),this.mounted)return;this.mounted=!0,B();const t=y()??w.Unknown;this.trackEvent(_(t))}setIsOverlayAttr(){const t=this.shredditSlotterElm?.getAttribute("slot-name");this.isOverlay=this._authFlowModalOpen||t!==c.InlineAuthLandingExperienceXpromo}onSlotterRouteChange(t){t===c.InlineAuthLandingExperienceXpromo&&this.bindButtonListener(),this.setIsOverlayAttr()}renderAuthFlowTemplate(){const t=this.querySelector('template[slot="auth-flow"');return t instanceof HTMLTemplateElement?g(t):""}onAnimationEnd(){this.isVisible||this.shadowRoot?.querySelector(".content")?.classList.add("hidden")}render(){return A` <div class="content ${this.isOverlay?"":"wrapper sticky -ml-md -mr-xs mt-[-65vh] bottom-0 z-[100] hidden"}" @animationend="${this.onAnimationEnd}"> <div class="${this.isOverlay?"":"container p-2xl pb-lg h-[auto] min-h-[65vh] justify-items-end relative flex items-end box-border"}"> <div class="w-100 h-100 absolute z-0 left-0 bottom-0 ${this.isOverlay?"hidden":"overlay"}"></div> <div class="relative z-10 max-w-100 bg-neutral-background-strong ${this.isSlim?"rounded-[12px] border-[1px] border-neutral-border border-solid":"rounded-[16px]"} shadow-md mx-auto pointer-events-auto box-border"> ${this.renderAuthFlowTemplate()} </div> </div> </div>`}};X.styles=[C`:host{pointer-events:none}:host([is-overlay]){display:block;position:relative;z-index:100;pointer-events:all}@keyframes fadeInSlideUp{0%{display:none;opacity:0;transform:translateY(50px)}1%{display:block;opacity:0;transform:translateY(50px)}100%{display:block;opacity:1;transform:translateY(0)}}@keyframes fadeOutSlideDown{0%{display:block;opacity:1;transform:translateY(0)}99%{display:block;opacity:0;transform:translateY(50px)}100%{display:none;opacity:0;transform:translateY(50px)}}.fade-in{animation:fadeInSlideUp .8s ease forwards}.fade-out{animation:fadeOutSlideDown .8s ease forwards}.hidden{display:none}.wrapper{margin-top:-65vh}.container{min-height:65vh}.overlay{background:linear-gradient(0deg,var(--color-neutral-background) 10%,rgba(0,0,0,0) 100%)}`,l],h([d({type:Boolean,attribute:"is-overlay",reflect:!0})],X.prototype,"isOverlay",void 0),h([d({type:Boolean,attribute:"slim"})],X.prototype,"isSlim",void 0),h([d({type:Number,attribute:"delay"})],X.prototype,"delay",void 0),h([d({type:Boolean})],X.prototype,"isVisible",void 0),h([d({type:Boolean})],X.prototype,"canBeShown",void 0),X=h([S("auth-landing-experience-xpromo-cbau-wrapper")],X);
