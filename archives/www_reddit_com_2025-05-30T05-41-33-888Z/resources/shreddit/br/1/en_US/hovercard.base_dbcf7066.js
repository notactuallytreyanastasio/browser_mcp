import{an as e,_ as t,cP as o,n as a,b9 as i,a_ as s,cQ as n,dq as r,cR as h,cS as l,cT as d,cU as p,a7 as c,aV as u}from"./shell-2264602c.js";import{x as f}from"./icon-82dd10b4.js";import{ax as v,ay as m}from"./age-gate-standalone-client-js-5357b0cf.js";import{P as y}from"./rpl-popper-2d8cefe0.js";const g=new WeakSet;class b extends i{constructor(){super(...arguments),this.contentSlotRef=s(),this.defaultSlotRef=s(),this.hovercardBodyRef=s(),this.popperRef=s(),this.anchorElement=null,this.interactionController=new v(this,{isInteractedWith:e=>e.open,hoverDelayStart:e=>n(getComputedStyle(e).getPropertyValue("--show-delay")),hoverDelayEnd:e=>n(getComputedStyle(e).getPropertyValue("--hide-delay")),delayOpenOnFocus:!0}),this.placement=y.Top,this.disabled=!1,this.distance=4,this.open=!1,this.skidding=0,this.trigger="hover focus",this.hoist=!1,this.noAnimate=!1,this.arrow=!1,this.eventUsedMap=new WeakMap,this.handleDocumentKeyDown=e=>{"Escape"===e.key&&(e.stopPropagation(),this.hide(),this.defaultSlotRef.value&&this.focusFirstTabbableElement(this.defaultSlotRef.value))},this.handleDocumentClick=e=>{if(!(e.target instanceof HTMLElement)||this.hidden)return;this.eventUsedMap.has(e)||m(this,e.target)||this.hide()}}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("keydown",this.handleDocumentKeyDown),document.removeEventListener("click",this.handleDocumentClick)}willUpdate(e){e.has("open")&&this.hasUpdated&&this.handleOpenChange(),e.has("disabled")&&this.handleDisabledChange(),(e.has("content")||e.has("distance")||e.has("hoist")||e.has("placement")||e.has("skidding"))&&this.handleOptionsChange()}firstUpdated(){this.hovercardBodyRef.value&&(this.hovercardBodyRef.value.hidden=!0),this.open&&this.popperRef.value&&this.handleOpenChange()}startInteraction(e,t){this.eventUsedMap.has(e)||(this.interactionController.interactionTrigger=t,this.eventUsedMap.set(e,!0),this.show())}finishInteraction(e){this.eventUsedMap.set(e,!0),this.hide()}focusFirstTabbableElement(e){const t=r(e)[0];t&&"focus"in t&&"function"==typeof t.focus&&(t.addEventListener("focusin",(e=>{this.eventUsedMap.set(e,!0)}),{once:!0,capture:!0}),t.focus({preventScroll:!0}))}focusFirstTabbableBodyElement(e){return this.focusFirstTabbableElement(e)}async handleOpenChange(){if(!this.disabled&&this.contentSlotRef.value&&this.hovercardBodyRef.value&&this.popperRef.value)if(this.open){this.emitter.dispatch("show");const t=(async(t,o="faceplate-partial")=>{const a=o.toLowerCase(),i=e((e=>e.tagName.toLowerCase()===a&&(e=>"loading"in e&&"load"in e&&"function"==typeof e?.load)(e)),t);return(await Promise.all(i.map((async e=>!e||g.has(e)||"programmatic"!==e.loading?Promise.resolve(!1):(g.add(e),e.load().then((()=>!0))))))).filter(Boolean).length>0})(this.contentSlotRef.value);document.addEventListener("keydown",this.handleDocumentKeyDown),document.addEventListener("click",this.handleDocumentClick),await h(this.hovercardBodyRef.value),this.hovercardBodyRef.value.hidden=!1,this.popperRef.value.active=!0,this.updateAnchorElementAria();const{keyframes:o,options:a}=l(this,"hovercard.show");await d(this.popperRef.value.popup,o,a),this.popperRef.value.reposition(),await t,"focus"===this.interactionController.interactionTrigger&&this.focusFirstTabbableBodyElement(this.hovercardBodyRef.value),this.emitter.dispatch("after-show")}else{this.emitter.dispatch("hide"),document.removeEventListener("keydown",this.handleDocumentKeyDown),document.removeEventListener("click",this.handleDocumentClick),await h(this.hovercardBodyRef.value);const{keyframes:e,options:t}=l(this,"hovercard.hide");await d(this.popperRef.value.popup,e,t),this.popperRef.value.active=!1,this.hovercardBodyRef.value.hidden=!0,this.updateAnchorElementAria(),this.emitter.dispatch("after-hide")}}async handleOptionsChange(){this.hasUpdated&&this.popperRef.value&&(await this.updateComplete,this.popperRef.value.reposition())}handleAnchorSlotChange(){this.defaultSlotRef.value&&(this.anchorElement=e((e=>e instanceof HTMLButtonElement||e instanceof HTMLAnchorElement||["button","link","menuitem","tab","checkbox","combobox","gridcell","application","treeitem"].includes(e?.getAttribute("role")??"")),this.defaultSlotRef.value)[0]??null,this.updateAnchorElementAria())}updateAnchorElementAria(){this.anchorElement?.setAttribute("aria-haspopup","dialog"),this.anchorElement?.setAttribute("aria-expanded",this.open?"true":"false")}handleDisabledChange(){this.disabled&&this.open&&this.hide()}async show(){if(!this.open)return this.open=!0,p(this,this.emitter.eventId("after-show"))}async hide(){if(this.open)return this.open=!1,p(this,this.emitter.eventId("after-hide"))}render(){return f` <rpl-popper part="popper" exportparts="
          popup:popper--popup,
          arrow:popper--arrow
        " class="${c({hovercard:!0,"hovercard--open":this.open})}" placement="${this.placement}" distance="${this.distance}" skidding="${this.skidding}" strategy="${this.hoist?"fixed":"absolute"}" flip shift safe-area ?arrow="${this.arrow}" @mouseenter="${this.interactionController.handleMouseEnter}" @mouseleave="${this.interactionController.handleMouseLeave}" @mousedown="${this.interactionController.handleMouseDown}" @mouseup="${this.interactionController.handleMouseUp}" @focusin="${this.interactionController.handleFocus}" @focusout="${this.interactionController.handleBlur}" @click="${e=>this.eventUsedMap.set(e,!0)}" ${u(this.popperRef)}> <slot slot="anchor" aria-describedby="hovercard" @click="${this.interactionController.handleClick}" ${u(this.defaultSlotRef)} @slotchange="${this.handleAnchorSlotChange}"></slot> <div part="body" id="hovercard" class="hovercard-body" role="dialog" aria-live="${this.open?"polite":"off"}" ${u(this.hovercardBodyRef)}> <slot name="content" ${u(this.contentSlotRef)}></slot> </div> </rpl-popper> `}}t([a()],b.prototype,"placement",void 0),t([a({type:Boolean,reflect:!0})],b.prototype,"disabled",void 0),t([a({type:Number})],b.prototype,"distance",void 0),t([a({type:Boolean,reflect:!0})],b.prototype,"open",void 0),t([a({type:Number})],b.prototype,"skidding",void 0),t([a()],b.prototype,"trigger",void 0),t([a({type:Boolean})],b.prototype,"hoist",void 0),t([a({type:Boolean,attribute:"no-animate"})],b.prototype,"noAnimate",void 0),t([a({type:Boolean})],b.prototype,"arrow",void 0),o("hovercard.show",{keyframes:[{opacity:0,scale:.8},{opacity:1,scale:1}],options:{duration:150,easing:"ease"}}),o("hovercard.hide",{keyframes:[{opacity:1,scale:1},{opacity:0,scale:.8}],options:{duration:150,easing:"ease"}});export{b as H};
