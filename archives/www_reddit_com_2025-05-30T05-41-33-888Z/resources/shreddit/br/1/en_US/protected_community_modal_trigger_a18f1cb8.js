import{b as e,a as t,M as i,O as s,c as o,I as a,w as n,x as r,i as d,t as l,_ as p,n as u,g as c,J as h,e as g}from"./shell-2264602c.js";import{a as m}from"./faceplate-textarea-input-97dc2a34.js";import{x as b,r as y,I as v,c as f,A as q,s as k,l as T}from"./icon-82dd10b4.js";const _=t=>e({source:"content_gate",action:"click",noun:"go_to_community_button"},{action_info:{setting_value:t}}),R=t=>e({source:"content_gate",action:"click",noun:"message_mods_button"},{action_info:{setting_value:t}}),w=e=>{if(!e)return!1;return e.getTime()+864e5>Date.now()},x=e=>{const t=new Date(e);return isNaN(t?.getTime?.())?null:t};let S=class extends(t(k)){constructor(){super(...arguments),this.subredditId="",this.prefixedSubredditName="",this.banner="",this.icon="",this.iconColor="",this.subredditDescription="",this.allowJoinRequests=!1,this.subredditType="restricted",this.isCommentingRestricted=!1,this.isPostingRestricted=!1,this.isShredditPMComposeMigrationEnabled=!1,this.modMessageBody="",this.preventDefault=e=>{e.preventDefault()},this.hasPendingRequest=()=>w(this.lastJoinRequest),this.getStatusText=()=>{switch(!0){case"restricted"===this.subredditType&&this.isCommentingRestricted&&this.isPostingRestricted:return"This is a restricted community. Only approved members can contribute.";case"restricted"===this.subredditType&&this.isPostingRestricted:return"This is a restricted community. Only approved users can post, but you can still comment.";case"restricted"===this.subredditType&&this.isCommentingRestricted:return"This is a restricted community. Only approved users can comment, but you can still post.";case"private"===this.subredditType:default:return"This is a private community. Only approved members can view and contribute."}},this.handleTextChange=e=>{this.modMessageBody=e.target.value},this.hide=()=>this.dialog?.hide(),this.showModal=()=>{var t;this.dialog?.showModal(),this.trackEvent((t=this.subredditType,e({source:"content_gate",action:"view",noun:"modal"},{action_info:{setting_value:t}})))},this.requestClientGQL=i,this.requestToJoin=async()=>{if(!this.modMessageBody)return;var t;this.trackEvent((t=this.subredditType,e({source:"content_gate",action:"click",noun:"request_to_join"},{action_info:{setting_value:t}})));let i=!1;if(this.isShredditPMComposeMigrationEnabled){const{data:e,errors:t}=await this.requestClientGQL({operation:s.SendMessageToSubreddit,variables:{input:{body:this.modMessageBody,subject:"[join] Request to join",subredditId:this.subredditId}}});i=e.sendMessageToSubreddit.ok&&!t.length}else{const{data:e,errors:t}=await this.requestClientGQL({operation:s.ComposeMessage,variables:{input:{body:this.modMessageBody,recipient:this.prefixedSubredditName,subject:"[join] Request to join"}}});i=!!e.composeMessage?.ok&&!t.length}i?(this.allowJoinRequests=!1,await this.requestClientGQL({operation:s.UpdateContributorRequestTimestamp,variables:{input:{subredditId:this.subredditId,requestDatetime:(new Date).toUTCString()}}}),this.dispatchEvent(o("faceplate-alert",{level:a.success,message:"Request to join has been sent"}))):this.dispatchEvent(o("faceplate-alert",{level:a.error,cause:"uncategorized",message:"Request to join failed to send"}))},this.renderTemplate=()=>{return b`<div class="relative max-w-lg w-100 rounded-md overflow-hidden"> <faceplate-img class="h-[88px] w-full object-cover bg-secondary-background" src="${this.banner}"></faceplate-img> <div class="relative flex items-end gap-sm pl-lg -top-[35px] -mb-[35px]"> ${this.icon?b`<img loading="lazy" src="${this.icon}" alt="" class="border-solid border-ui-modalbackground border-md w-[80px] aspect-square rounded-full overflow-hidden">`:y({size:v.ExtraLarge,attributes:{style:this.iconColor?`color: ${this.iconColor}`:void 0,className:"rounded-full w-[80px] h-[80px] border-neutral-background border-lg border-solid"}})} <h4 class="title text-18 font-bold mb-md bg-cover bg-no-repeat"> ${this.prefixedSubredditName} </h4> </div> ${this.open?q:n({appearance:"media",attributes:{className:"absolute top-md right-md ",onclick:this.hide},size:r.Small,leadingIcon:f({size:v.Small})})} <div class="flex flex-col justify-center px-md"> ${this.isPrivate&&this.subredditDescription?b`<p class="description text-14 mt-sm mb-0">${this.subredditDescription}</p>`:q} <p class="status-text text-14 mt-sm font-bold">${this.getStatusText()}</p> ${this.allowJoinRequests?b`<faceplate-textarea-input size="expanded" appearance="${m.SECONDARY}" class="mb-sm" name="textarea" faceplate-focusable required .value="${this.modMessageBody}" @input="${this.handleTextChange}"> <span slot="label">Request to join</span> </faceplate-textarea-input>`:q} </div> <div class="flex justify-end gap-md p-md pt-0"> ${this.isPrivate?n({appearance:"secondary",attributes:{onclick:this.trackEvent.bind(this,(t=this.subredditType,e({source:"content_gate",action:"click",noun:"go_to_homepage_button"},{action_info:{setting_value:t}}))),href:"/"},children:"Go To Homepage"}):n({appearance:"secondary",attributes:{onclick:this.trackEvent.bind(this,_(this.subredditType)),href:`/${this.prefixedSubredditName}`},children:"Go To Community"})} ${this.allowJoinRequests?n({appearance:"primary",attributes:{onclick:this.requestToJoin,disabled:!this.modMessageBody},size:r.Medium,children:"Send Request"}):n({appearance:"primary",attributes:{onclick:this.trackEvent.bind(this,R(this.subredditType)),href:`/message/compose?to=${encodeURIComponent(this.prefixedSubredditName)}`},size:r.Medium,children:"Message Mods"})} </div> </div>`;var t}}get isPrivate(){return"private"===this.subredditType}getBgImagePath(){const e=this.isLoggedIn?"home":"popular",t=d()?"dark":void 0,i=this.isDesktop?void 0:"mobile";return`${CLIENT_CONFIG.STATIC_BASE_URL}assets/feeds/${[e,t,i].filter(Boolean).join("-")}.jpg`}connectedCallback(){super.connectedCallback(),this.allowJoinRequests&&this.hasPendingRequest()&&(this.allowJoinRequests=!1),"private"===this.subredditType&&this.updateComplete.then((()=>{this?.dialog?.addEventListener("rpl-dialog:request-close",this.preventDefault),this?.dialog?.showModal()}))}disconnectedCallback(){super.disconnectedCallback(),"private"===this.subredditType&&this?.dialog?.removeEventListener("rpl-dialog:request-close",this.preventDefault),this?.dialog?.hide()}render(){return b`<rpl-dialog dialog-id="protected-community-modal" overlay-blur ?open="${this.open}" .litTemplateChildren="${this.renderTemplate()}"> </rpl-dialog>${"private"===this.subredditType&&this.open?b` <div class="blurred-bg h-screen-without-header w-100 bg-no-repeat bg-cover" style="background-image:url('${this.getBgImagePath()}')"> <div class="shade h-full w-full"></div> </div>`:q}`}};S.styles=[l],p([u({type:String,attribute:"subreddit-id"})],S.prototype,"subredditId",void 0),p([u({type:String,attribute:"prefixed-name"})],S.prototype,"prefixedSubredditName",void 0),p([u({type:String,attribute:"banner"})],S.prototype,"banner",void 0),p([u({type:String,attribute:"icon"})],S.prototype,"icon",void 0),p([u({type:String,attribute:"icon-color"})],S.prototype,"iconColor",void 0),p([u({type:String,attribute:"subreddit-description"})],S.prototype,"subredditDescription",void 0),p([u({type:Boolean,attribute:"allow-join-requests",reflect:!0})],S.prototype,"allowJoinRequests",void 0),p([u({type:String,attribute:"last-join-request",converter:{fromAttribute:x}})],S.prototype,"lastJoinRequest",void 0),p([u({type:String,attribute:"subreddit-type"})],S.prototype,"subredditType",void 0),p([u({type:Boolean,attribute:"is-commenting-restricted"})],S.prototype,"isCommentingRestricted",void 0),p([u({type:Boolean,attribute:"is-posting-restricted"})],S.prototype,"isPostingRestricted",void 0),p([u({type:Boolean})],S.prototype,"open",void 0),p([u({type:Boolean})],S.prototype,"isLoggedIn",void 0),p([u({type:Boolean})],S.prototype,"isDesktop",void 0),p([u({type:Boolean,attribute:"is-pm-compose-migration-enabled"})],S.prototype,"isShredditPMComposeMigrationEnabled",void 0),p([c()],S.prototype,"modMessageBody",void 0),p([h("rpl-dialog")],S.prototype,"dialog",void 0),S=p([g("protected-community-modal")],S);let C=class extends(t(k)){constructor(){super(...arguments),this.appearance="primary",this.size=r.Medium,this.unstyled=!1,this.hasPendingRequest=()=>w(this.lastJoinRequest),this.handleOpenModal=t=>{var i;this.hasPendingRequest()&&this.pendingLink||!this._modal||(t.preventDefault(),t.stopPropagation(),this._modal.showModal(),this.trackEvent((i=this._modal.subredditType,e({source:"content_gate",action:"click",noun:"request_approval_button"},{action_info:{setting_value:i}}))))},this.handleKeydown=e=>{"Enter"!==e.key&&"Space"!==e.key||this.handleOpenModal(e)}}get _modal(){return document.querySelector("protected-community-modal")}render(){return this.unstyled?b`<slot @click="${this.handleOpenModal}" @keydown="${this.handleKeydown}" name="${T(this.hasPendingRequest()?"pending-request":void 0)}"></slot>`:n({appearance:this.appearance,size:this.size,attributes:{href:this.hasPendingRequest()&&this.pendingLink?this.pendingLink:void 0,disabled:this.disabledWhenPending&&this.hasPendingRequest(),onclick:this.handleOpenModal},children:b`<slot name="${T(this.hasPendingRequest()?"pending-request":void 0)}"></slot>`})}};C.styles=[l],p([u({type:String})],C.prototype,"appearance",void 0),p([u({type:String})],C.prototype,"size",void 0),p([u({type:Boolean})],C.prototype,"unstyled",void 0),p([u({type:Boolean,attribute:"disabled-when-pending"})],C.prototype,"disabledWhenPending",void 0),p([u({type:String,attribute:"pending-link"})],C.prototype,"pendingLink",void 0),p([u({type:String,attribute:"last-join-request",converter:{fromAttribute:x}})],C.prototype,"lastJoinRequest",void 0),C=p([g("protected-community-modal-trigger")],C);
