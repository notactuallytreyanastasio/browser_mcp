import{A as t,b6 as e,gr as s,e$ as i,fQ as r,_ as o,n,e as a,au as d,P as l,dJ as h,ap as p,c,K as m,T as u,I as y,bG as b,cG as g,gs as v,gt as k,av as j}from"./shell-2264602c.js";import{x as I,H as f,bf as A}from"./icon-82dd10b4.js";import{s as E,a as S}from"./activate-lead-gen-dialog-d08e1e7d.js";import"./click-location-tracker-1589a523.js";import{g as C,a as x,s as w,b as L}from"./shreddit-dynamic-ad-link-548337a6.js";import"./shop-gallery-data-fetcher-client-js-73ca6a07.js";import{W as T,e as U}from"./with-ad-observer-3dfd9c4c.js";import{c as B,I as O}from"./content-action-button-a25cd1f9.js";import{L as G,bI as D,au as R}from"./age-gate-standalone-client-js-5357b0cf.js";import{S as _}from"./partial-feed-post-client-js-9aa6d44b.js";import{E as P}from"./links-9b598b77.js";import{h as z}from"./gallery-4693e59b.js";import"./utils-19e4b642.js";import"./errors-8d0111b7.js";import"./overflow-menu-actions-97fa1cfc.js";import"./distinguished-tags-ad178980.js";import"./mod-log-takedown-preview-client-js-14bc18f8.js";import"./custom-event-7a897666.js";import"./index-95352f7c.js";import"./award-controller-c1fa775d.js";import"./awardsTelemetryState-e939bf46.js";import"./header-action-item-chat-client-js-8d009dcd.js";import"./tooltip.base-7152f24f.js";import"./rpl-popper-2d8cefe0.js";import"./modActions-c13cf697.js";import"./mod-bulk-actions-285bd4b9.js";import"./awards-d066f3fe.js";import"./expandable-section-header-edd4c2b3.js";import"./rpl-coachmark-f5614db3.js";import"./rpl-coachmark-card-3cbe7edc.js";import"./mod-post-list-client-js-bec4e5a5.js";import"./content-tags-a35f6e45.js";import"./shreddit-post-share-button-1df6e2be.js";import"./with-share-1ad32a0e.js";import"./promote-post-actions-controller-f5bf291f.js";import"./index-7436fa38.js";import"./profile-creation-1d60123b.js";import"./select-controller-e11d5e4c.js";import"./user-flair-afad799f.js";import"./expandable-mod-reports-base-769d69d1.js";import"./postFlair-707ffbfa.js";import"./promote-post-button-9b9319e1.js";import"./translation-intervention-modal-337135d6.js";import"./translations-8a80e526.js";import"./chat-mobile-xpromo-client-js-c803f3b0.js";import"./app-selector-client-js-3a92da0e.js";import"./TinyGesture-89d9957c.js";import"./v2-events-b6c86ff7.js";import"./mod-verdict-47cd849f.js";import"./index-7edea759.js";import"./password-recovery-11761f51.js";import"./qr-code-modal-upsell-client-js-7b7451da.js";import"./comment-client-js-815cfbd9.js";import"./comment-link-post-client-js-3910d5c4.js";import"./cbau-81b2f8bd.js";import"./community-club-highlights-client-js-a6b43ba7.js";import"./subreddit-posting-eligibility-8f99a053.js";const N=[t.BACKGROUND,t.PROMOTED_LABEL,t.CREDIT_BAR_WHITESPACE,t.TITLE,t.TEXT_BODY,t.ACTION_BAR_WHITESPACE];class F{constructor(t){this._currGalleryIndex=0,this.handleGalleryNavEvent=t=>{const{detail:{details:e}}=t,{noun:s,action:i,source:r,post:o}=e;if(o?.id!==this.host.postId||"gallery"!==r||"click"!==i)return;"forward"===s&&this._currGalleryIndex+1<this.host.galleryItems.length&&this._currGalleryIndex++,"backward"===s&&this._currGalleryIndex-1>=0&&this._currGalleryIndex--;const n=this.host.galleryItems[this._currGalleryIndex].outboundUrl;this.host.querySelectorAll("call-to-action-gallery-links").forEach((t=>t.handleGalleryNavEvent(this._currGalleryIndex))),this.host.querySelectorAll("shreddit-dynamic-ad-link").forEach((t=>{N.includes(t.clickLocation)&&(t.postOutboundLink=n,t.galleryIndex=this._currGalleryIndex)}))},(this.host=t).addController(this)}hostConnected(){this.host.galleryItems?.length&&this.host.addEventListener("track-event",this.handleGalleryNavEvent)}hostDisconnected(){this.host.removeEventListener("track-event",this.handleGalleryNavEvent)}}class q{constructor(t){(this.host=t).addController(this)}hostConnected(){this.host.impressionId||this.host.hasAdEvents||(this.hydrateAdEventsFromStorage(),this.hydrateAdUserTargetingFromStorage(),this.host.hasAdEvents&&(this.updateDynamicLinkUrls(),this.updateCallToActionGalleryLinkUrls(),this.host.setupAdObserver()))}updateDynamicLinkUrls(){const t=e(G);this.host.querySelectorAll("shreddit-dynamic-ad-link").forEach((e=>{if(t){const t="/"===e.outboundLinkOverride?.charAt(0),i=!!this.host.galleryItems;if(t||!i&&e.outboundLinkOverride===s)return;return void(e.outboundLinkOverride=this.host.galleryItems?this.host.galleryItems[e.galleryIndex??0]?.outboundUrl:this.host.outboundLinkUrl)}const i="/"===e.postOutboundLink.charAt(0),r=!!this.host.galleryItems;i||!r&&e.postOutboundLink===s||(e.postOutboundLink=this.host.galleryItems&&this.host.galleryItems[e.galleryIndex??0]?.outboundUrl||this.host.outboundLinkUrl)}))}updateCallToActionGalleryLinkUrls(){e(G)||this.host.querySelectorAll("call-to-action-gallery-links").forEach((t=>{if(!this.host.galleryItems)return;const e=this.host.galleryItems.map((t=>t.outboundUrl));t.galleryOutboundLinks=e}))}hydrateAdEventsFromStorage(){const t=new URL(i.href).searchParams.get(r);this.host.impressionId=t||"";const e=C(this.host.impressionId);e&&(this.host.adEvents=e.adEvents,this.host.outboundLinkUrl=e.clickRedirectUrl,this.host.galleryItems&&e.galleryAdData&&(this.host.galleryItems=e.galleryAdData?.map(((t,e)=>({...(this.host.galleryItems||[])[e],adEvents:t.adEvents,outboundUrl:t.clickRedirectUrl})))))}hydrateAdUserTargetingFromStorage(){const t=x();t&&(this.host.adUserTargeting=t)}}const H=T(_);let $=class extends H{constructor(){super(...arguments),this.impressionId="0",this.isBlank=!1,this.isCommentingDisabled=!1,this.isSharingDisabled=!1,this.isSurveyAd=!1,this.placement=d.FEED,this.isPixelFiringRefactorExperimentEnabled=!1,this.AdPostHydrationController=new q(this),this.AdPostGalleryLinksController=new F(this),this.pubSub=new l(this),this._trackAdClick=this._events.define("observe-ad-click",(async e=>{const s=this.postType===h.Image,i=this.postType===h.Video,r=i&&this.viewType!==p.CompactView&&e.detail.clickLocation!==t.MEDIA,o=i&&this.viewType===p.CompactView;(s||o||r)&&(await this._activateLeadGenDialog(),E({leadGenInfo:this.leadGenInfo,postId:this.id,impressionId:this.impressionId,onSuccess:()=>this.dispatchEvent(c(D))}))})),this.onAdUpdateAction=({action:t,impressionId:e})=>{"hide"===t&&e===this.impressionId&&(this.hidden=!0)},this.checkTextBodySize=t=>{t[0].target.clientHeight>0&&(this.hideTextPostContentOverflow(),this.textResizeObserver.disconnect())}}static get styles(){return[...super.styles,m(":host {\n  position: relative;\n}\n.ad-link-bar {\n  grid-column: 1 / 13;\n  height: 40px;\n  border-top: transparent;\n}\n.meta-row {\n  grid-column: 1 / 4;\n}\n.grid-template-col-inherit {\n  grid-template-columns: inherit;\n}\n")]}_activateLeadGenDialog(){return S({leadGenInfo:this.leadGenInfo})}get hasAdEvents(){return this.adEvents?.length>0}handleCarouselArrowClick(t){t.preventDefault();z(this,t,this.impressionId)}connectedCallback(){super.connectedCallback(),this.pubSub.subscribe(u.AdUpdated,this.onAdUpdateAction),this.setupAdObserver();const t=this.querySelector(`#${this.id}-post-rtjson-content`);t&&(this.textResizeObserver=new ResizeObserver(this.checkTextBodySize),this.textResizeObserver.observe(t))}setupAdObserver(){!this.isAdObserved&&this.hasAdEvents&&this.enableAdObserver({postElement:this,events:U(this.adEvents),postId:this.id,impressionId:this.impressionId,adType:this.adType,dimensions:this.dimensions,galleryItems:this.galleryItems?.map((t=>({...t,adEvents:U(t.adEvents||[])})))})}disconnectedCallback(){this.pubSub.unsubscribe(u.AdUpdated,this.onAdUpdateAction),this.textResizeObserver?.disconnect(),super.disconnectedCallback()}updated(t){if(t.has("outboundLinkUrl")&&!this.galleryItems){if(this.outboundLinkUrl)return;this.querySelector(".ad-link-bar")?.remove()}}handleView(t,e){super.handleView(t,e,this.galleryItems?.length)}handleShareClick(){if(this.isSharingDisabled){const t=c("faceplate-alert",{level:y.notice,message:"Sharing has been disabled for this post"});this.dispatchEvent(t)}else this.handleShareButtonInteraction()}handleClickCommentsButton(t){if(this.isSurveyAd)super.handleClickCommentsButton(t);else if(this.isCommentingDisabled){const t=c("faceplate-alert",{level:y.notice,message:"Comments have been disabled for this post"});this.dispatchEvent(t)}else this.isFeed?(w({impressionId:this.impressionId,adEvents:this.adEvents,clickRedirectUrl:this.outboundLinkUrl,galleryAdData:this.galleryItems?.map((t=>({adEvents:t.adEvents,clickRedirectUrl:t.outboundUrl})))}),L(this.adUserTargeting),this.trackEvent(P(this))):super.handleClickCommentsButton(t)}renderCommentsButton(){if(this.isCommentingDisabled)return I`${B({size:this.defaultActionButtonSize,appearance:R()?"bordered":"secondary",attributes:{type:"button",className:this.defaultActionButtonClassnames,onclick:this.handleClickCommentsButton,name:"comments-action-button","data-post-click-location":b.COMMENTS_BUTTON},leadingIcon:f({attributes:{className:"icon-comment","aria-hidden":"true"},size:O[this.defaultActionButtonSize]}),screenReaderContent:"comments",children:I`<faceplate-number number="${this.commentCount}" pretty></faceplate-number>`})}`;{const t=new URL(this.permalink,window.location.origin);return t.searchParams.set(g,"1"),t.searchParams.set(r,this.impressionId),this.leadGenInfo?.campaignId&&t.searchParams.set(v,this.leadGenInfo.campaignId),this.videoAdLoopingExperiment&&t.searchParams.set(k,this.videoAdLoopingExperiment),this.permalink=t.pathname+t.search,super.renderCommentsButton()}}renderShareButton(){if(this.isSharingDisabled){const t="Share";return I`${B({size:this.defaultActionButtonSize,appearance:R()?"bordered":"secondary",attributes:{type:"button",onclick:this.handleShareClick,onkeydown:this.handleShareClick,className:this.defaultActionButtonClassnames},leadingIcon:A({attributes:{className:"icon-share","aria-hidden":"true"},size:O[this.defaultActionButtonSize]}),screenReaderContent:t,children:t})}`}return super.renderShareButton()}renderHiddenPost(){return I` <div class="hidden-post h-3xl flex items-center justify-between px-md"> <div> <p class="m-0 font-semibold text-neutral-content-strong text-14"> Ad hidden </p> </div> </div> `}renderActionRow(){return this.isSurveyAd?I``:super.renderActionRow()}render(){return this.hidden?this.renderHiddenPost():I` <shreddit-with-observer-wrapper id="in-feed-ad" .config="${{threshold:j}}"> ${this.isBlank?null:super.render()} </shreddit-with-observer-wrapper>`}};o([n({type:String,attribute:"post-id"})],$.prototype,"postId",void 0),o([n({type:Array,attribute:"ad-events",reflect:!0})],$.prototype,"adEvents",void 0),o([n({type:Array,attribute:"gallery-items",reflect:!0})],$.prototype,"galleryItems",void 0),o([n({type:Object,attribute:!0})],$.prototype,"dimensions",void 0),o([n({type:String,attribute:"ad-type"})],$.prototype,"adType",void 0),o([n({type:String,attribute:"outbound-link-url",reflect:!0})],$.prototype,"outboundLinkUrl",void 0),o([n({type:String,attribute:"impression-id"})],$.prototype,"impressionId",void 0),o([n({type:Object,attribute:"ad-user-targeting",reflect:!0})],$.prototype,"adUserTargeting",void 0),o([n({type:String,attribute:"video-ad-looping-experiment",reflect:!0})],$.prototype,"videoAdLoopingExperiment",void 0),o([n({type:Boolean,attribute:"is-blank"})],$.prototype,"isBlank",void 0),o([n({type:Boolean,attribute:"is-commenting-disabled"})],$.prototype,"isCommentingDisabled",void 0),o([n({type:Boolean,attribute:"is-sharing-disabled"})],$.prototype,"isSharingDisabled",void 0),o([n({type:Boolean,attribute:"is-survey-ad"})],$.prototype,"isSurveyAd",void 0),o([n({type:String,attribute:"country-code"})],$.prototype,"countryCode",void 0),o([n({type:String,attribute:"placement"})],$.prototype,"placement",void 0),o([n({type:Object,attribute:"lead-gen-info"})],$.prototype,"leadGenInfo",void 0),o([n({type:String,attribute:"campaign-id"})],$.prototype,"campaignId",void 0),o([n({type:String,attribute:"encrypted-tracking-payload"})],$.prototype,"encryptedTrackingPayload",void 0),o([n({type:Array,attribute:"additional-event-metadata"})],$.prototype,"additionalEventMetadata",void 0),o([n({type:Boolean,attribute:"pixel-firing-refactor-experiment-enabled"})],$.prototype,"isPixelFiringRefactorExperimentEnabled",void 0),o([n({type:String,attribute:"ads-correlation-id"})],$.prototype,"adsCorrelationId",void 0),$=o([a("shreddit-ad-post")],$);
