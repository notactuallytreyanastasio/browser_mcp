import{_ as e,e as s,$ as t,aJ as n,aP as o,aX as i,aY as a,aZ as r}from"./shell-2264602c.js";import{a as l}from"./links-9b598b77.js";import{s as h,x as c}from"./icon-82dd10b4.js";class m{constructor(e,s){this.hasPageUnloaded=!1,this.handleIntersectionObserverEnter=()=>{this.isPostInViewport||(this.isPostInViewport=!0,this.becameVisibleOnScreenTimestamp=Date.now())},this.handleIntersectionObserverLeave=()=>{const e=this.isPostInViewport;this.isPostInViewport=!1,e&&this.handleConsume()},this.handleDocumentVisibilityChange=e=>{this.isPostInViewport&&(e?(this.hasPageUnloaded=!1,this.becameVisibleOnScreenTimestamp=Date.now()):e||this.hasPageUnloaded||this.handleConsume())},this.onBeforeUnloadCallback=()=>{this.hasPageUnloaded=!0,this.isPostInViewport&&this.handleConsume()},this.elementToTrack=e,this.SAN=s}handleConsume(){this.becameVisibleOnScreenTimestamp&&Date.now()-this.becameVisibleOnScreenTimestamp>l&&n(this.elementToTrack,this.SAN)}}class d{constructor(e){this.host=e,this.postConsumeTrackingController=new m(e,{source:"post",action:"consume",noun:"post"}),this.host.addController(this)}hostConnected(){new o(this.host,this.host,{rootMargin:"0px"}),this.host.addEventListener("faceplate-enter",this.postConsumeTrackingController.handleIntersectionObserverEnter),this.host.addEventListener("faceplate-leave",this.postConsumeTrackingController.handleIntersectionObserverLeave),i.subscribe(this.postConsumeTrackingController.onBeforeUnloadCallback,{shouldBeCalledFirst:!0}),a(this.postConsumeTrackingController.handleDocumentVisibilityChange,{immediate:!0})}hostDisconnected(){this.host.removeEventListener("faceplate-enter",this.postConsumeTrackingController.handleIntersectionObserverEnter),this.host.removeEventListener("faceplate-leave",this.postConsumeTrackingController.handleIntersectionObserverLeave),i.unsubscribe(this.postConsumeTrackingController.onBeforeUnloadCallback),r(this.postConsumeTrackingController.handleDocumentVisibilityChange)}}let C=class extends h{connectedCallback(){super.connectedCallback(),this.postConsumeTrackingController=new d(this)}disconnectedCallback(){super.disconnectedCallback(),this.postConsumeTrackingController&&t(this,this.postConsumeTrackingController)}render(){return c`<slot></slot>`}};C=e([s("post-consume-tracker")],C);export{m as C};
