import{t as e,_ as t,n as i,g as n,j as o,aF as s,w as a,x as d,e as r}from"./shell-2264602c.js";import{B as l,s as c,a as u,x as p,c as m,I as h,u as b,b0 as M}from"./icon-82dd10b4.js";import{c as I}from"./content-action-button-a25cd1f9.js";import{l as g,L as A}from"./expandable-section-header-edd4c2b3.js";import"./select-controller-e11d5e4c.js";import"./app-selector-client-js-3a92da0e.js";import"./faceplate-bottom-sheet-header-63783c3a.js";import"./community-picker-9f84d972.js";import{W as k,p as f}from"./with-post-actions-73ed9e7e.js";import{b7 as w}from"./age-gate-standalone-client-js-5357b0cf.js";import{b as y,c as S,E as v}from"./with-share-1ad32a0e.js";import"./user-flair-afad799f.js";import"./TinyGesture-89d9957c.js";import"./header-action-item-chat-client-js-8d009dcd.js";import"./tooltip.base-7152f24f.js";import"./rpl-popper-2d8cefe0.js";import"./profile-creation-1d60123b.js";import"./award-controller-c1fa775d.js";import"./awardsTelemetryState-e939bf46.js";import"./promote-post-button-9b9319e1.js";import"./utils-19e4b642.js";import"./promote-post-actions-controller-f5bf291f.js";import"./start-end-ama-actions-controller-aa6cb3b4.js";import"./links-9b598b77.js";import"./overflow-menu-actions-97fa1cfc.js";import"./distinguished-tags-ad178980.js";import"./modActions-c13cf697.js";import"./translations-8a80e526.js";import"./feeds-4612b45d.js";import"./community-highlights-4f4bb401.js";import"./mod-verdict-47cd849f.js";import"./postFlair-707ffbfa.js";import"./shop-gallery-data-fetcher-client-js-73ca6a07.js";import"./index-7436fa38.js";import"./rpl-coachmark-f5614db3.js";import"./rpl-coachmark-card-3cbe7edc.js";function R(e){const t=document.createElement("div");return l(e,t),Array.from(t.children)}class j extends c{constructor(){super(...arguments),this.isDesktopViewport=!1,this.isMobileViewport=!1,this.unpackedItems=new Set,this.resizeObserver=null,this.toggleMenuOpenState=e=>{this.getBottomSheet(e)?.open||this.getDropdownMenu(e)&&!this.getDropdownMenu(e)?.hidden?this.closeMenu(e):this.openMenu(e)},this.openMenu=async e=>{const t=this.getBottomSheet(e);t&&(await t.updateComplete,!1===t.open&&t.showModal());const i=this.getDropdownMenu(e);i&&(await i.updateComplete,i.hidden&&i.show())},this.closeMenu=async e=>{const t=this.getBottomSheet(e);t&&(await t.updateComplete,t.open&&t.close());const i=this.getDropdownMenu(e);i&&(await i.updateComplete,!1===i.hidden&&i.close())},this.unpackVisibleActions=async()=>{const e=new Set,t=this.shadowRoot?.getElementById("unpacked-actions");if(!t)return;t.innerHTML="";const i=new Map(this.getUnpackableMenuItems().map((e=>[e.id,e])));for(const e of i.values()){R(e.unpackedRender()).forEach((i=>{i.setAttribute("data-item-id",e.id),t.appendChild(i)}))}const n=Array.from(t.children).map((e=>e instanceof c?e.updateComplete:Promise.resolve()));await Promise.all(n);const o=t.clientWidth,s=t.getBoundingClientRect().left,a=Math.ceil(s+o),d=Array.from(t.querySelectorAll("[data-item-id]")),r=[];for(let e=d.length-1;e>=0;e--){const t=d[e],n=t.getAttribute("data-item-id"),o=i.get(n);if(!(Math.floor(this.getItemBoundingClientRect(o,t).right)>a))break;r.push(n)}d.forEach((t=>{const i=t.getAttribute("data-item-id");r.includes(i)?t.remove():e.add(i)})),function(e,t){if(e.size!==t.size)return!1;for(const i of e)if(!t.has(i))return!1;return!0}(this.unpackedItems,e)||(this.unpackedItems=e)},this.getCloseHandler=e=>t=>{o(t)&&this.closeMenu(e)}}getMenus(){return[]}getMenuItems(){return[]}updateMenuBar(){this.unpackVisibleActions()}connectedCallback(){super.connectedCallback(),this.unpackVisibleActions(),this.resizeObserver=this.resizeObserver??new ResizeObserver(s(this.unpackVisibleActions,100,{leading:!1,trailing:!0})),this.resizeObserver.observe(this,{box:"border-box"})}disconnectedCallback(){super.disconnectedCallback(),this.resizeObserver?.disconnect()}getDropdownMenu(e){return this.shadowRoot?.querySelector(`faceplate-dropdown-menu#${e}`)}getBottomSheet(e){return this.shadowRoot?.querySelector(`faceplate-bottom-sheet#${e}`)}shouldRenderMenu(e){const t=this.getMenuPackedItems(e),i=this.getMenus().find((t=>t.id===e))?.extraItemsSlotName,n=!!i&&this.slotHasAssignedNodes(i);return t.length>0||n}getUnpackableMenuItems(){return this.getMenuItems().filter((e=>e.shouldRender()&&!e.alwaysRenderPacked))}getMenuPackedItems(e){return this.getMenuItems().filter((t=>t.menuId===e&&t.shouldRender()&&!this.unpackedItems.has(t.id)))}getDropdownButtonHandler(e){return t=>{o(t)&&this.getBottomSheet(e)&&this.toggleMenuOpenState(e)}}slotHasAssignedNodes(e){const t=this.shadowRoot?.querySelector(`slot[name=${e}]`);return(t?.assignedNodes().length||0)>0}render(){return p` <div class="flex flex-row overflow-hidden whitespace-nowrap gap-2xs justify-between"> <div id="unpacked-actions" class="flex flex-row overflow-hidden whitespace-nowrap gap-2xs"></div> ${this.renderMenus()} <slot name="whitespace"></slot> </div> ${this.renderMenuExtraItemsSlots()} `}renderMenus(){const e=this.getMenus().filter((e=>this.shouldRenderMenu(e.id)));return p`${e.map((e=>this.isDesktopViewport?this.renderDropdownMenu(e):this.renderBottomSheetMenu(e)))}`}renderBottomSheetMenu(e){const t=this.getCloseHandler(e.id),i=this.getMenuPackedItems(e.id).map((e=>e.packedRender()));return p` ${this.renderDropdownMenuButton(e)} <faceplate-bottom-sheet id="${e.id}" data-ignore-click-interception> <faceplate-bottom-sheet-header slot="header" has-divider> ${e.bottomSheetHeaderLabel} <span slot="trailing"> ${a({appearance:"secondary",attributes:{onclick:t,"aria-label":"Close actions menu",className:"close-btn"},leadingIcon:m({size:h.Small}),size:d.Small})} </span> </faceplate-bottom-sheet-header> <div class="w-full max-h-[19rem] overflow-y-auto pb-md"> <faceplate-menu @click="${t}" @keyup="${t}"> ${i} ${e.extraItemsSlotName?p`<slot name="${e.extraItemsSlotName}"></slot>`:""} </faceplate-menu> </div> </faceplate-bottom-sheet> `}renderDropdownMenu(e){const t=this.getMenuPackedItems(e.id).map((e=>e.packedRender()));return p` <faceplate-dropdown-menu id="${e.id}" position="bottom-end"> ${this.renderDropdownMenuButton(e)} <faceplate-menu slot="menu" class="whitespace-nowrap max-h-[25.5rem] overflow-y-auto nd:hidden" hidden> ${t} ${e.extraItemsSlotName?p`<slot name="${e.extraItemsSlotName}"></slot>`:""} </faceplate-menu> </faceplate-dropdown-menu> `}renderDropdownMenuButton(e){const t=this.getDropdownButtonHandler(e.id),i=I({appearance:"plain-weak",attributes:{onclick:t,className:"relative","aria-label":e.dropdownButtonLabel},leadingIcon:e.dropdownButtonIcon,size:d.Small});if(e.trackingAttributes){const{source:t,action:n,noun:o}=e.trackingAttributes;return p` <faceplate-tracker source="${t}" action="${n}" noun="${o}"> ${i} </faceplate-tracker> `}return i}renderMenuExtraItemsSlots(){const e=this.getMenus().filter((e=>!!e.extraItemsSlotName)).filter((e=>!this.shouldRenderMenu(e.id)));return p`${e.map((e=>p`<slot name="${e.extraItemsSlotName}" class="hidden"></slot>`))}`}getItemBoundingClientRect(e,t){if(e?.boundingClientRectSelector){const i=t.querySelector(e?.boundingClientRectSelector);if(i)return i.getBoundingClientRect()}return t.getBoundingClientRect()}}j.styles=[e,u`:host{display:block;overflow:hidden;width:100%}`],t([i({type:Boolean,attribute:"is-desktop-viewport"})],j.prototype,"isDesktopViewport",void 0),t([i({type:Boolean,attribute:"is-mobile-viewport"})],j.prototype,"isMobileViewport",void 0),t([n()],j.prototype,"unpackedItems",void 0);let B=class extends(k(j)){constructor(){super(...arguments),this.shouldIncludeModActions=!1,this.modMode=!1,this.primaryButtonAppearance="bordered"}updated(){this.updateMenuBar()}useIconsAndShortLabels(){return w()&&this.isMobileViewport}get defaultActionsMenu(){return{id:"defaultActions",dropdownButtonIcon:b({size:h.Small}),dropdownButtonLabel:"Open user actions",bottomSheetHeaderLabel:"Options",trackingAttributes:{source:"post",action:"click",noun:"overflow-menu"},extraItemsSlotName:"post-actions-extra-items"}}get modMenu(){return{id:"modActions",dropdownButtonIcon:M({size:h.Small}),dropdownButtonLabel:"Moderator actions",bottomSheetHeaderLabel:"Moderator actions",trackingAttributes:{source:"moderator",action:"click",noun:"mod_shield_menu"},extraItemsSlotName:"mod-actions-extra-items"}}getMenus(){return[this.modMenu,this.defaultActionsMenu]}getMenuItems(){const e=this.getDefaultActions(),t=this.getModActions(),i=this.shouldIncludeModActions&&this.modMode;return[this.buildGenericMenuItem({postAction:t.addRemovalReason,menuId:this.modMenu.id,partialButtonProps:{appearance:this.primaryButtonAppearance},additionalEligibility:()=>this.shouldIncludeModActions}),this.buildGenericMenuItem({postAction:t.approve,menuId:this.modMenu.id,partialButtonProps:{appearance:this.primaryButtonAppearance},additionalEligibility:()=>this.shouldIncludeModActions}),this.buildGenericMenuItem({postAction:t.remove,menuId:this.modMenu.id,partialButtonProps:{appearance:this.primaryButtonAppearance},additionalEligibility:()=>this.shouldIncludeModActions}),this.buildGenericMenuItem({postAction:e.comments,menuId:this.defaultActionsMenu.id}),this.buildGenericMenuItem({postAction:e.award,menuId:this.defaultActionsMenu.id}),this.buildShareMenuItem({shareAction:e.share,copyLinkAction:e.copyLink,crosspostAction:e.crosspost,embedAction:e.embed,menuId:this.defaultActionsMenu.id}),this.buildGenericMenuItem({postAction:e.edit,menuId:this.defaultActionsMenu.id}),this.buildGenericMenuItem({postAction:t.removeAsSpam,menuId:this.modMenu.id,alwaysRenderPacked:!this.modMode,additionalEligibility:()=>this.shouldIncludeModActions}),this.buildGenericMenuItem({postAction:t.editPostFlairMod,menuId:this.modMenu.id,alwaysRenderPacked:!this.modMode,additionalEligibility:()=>this.shouldIncludeModActions}),this.buildGenericMenuItem({postAction:t.lock,menuId:this.modMenu.id,alwaysRenderPacked:!this.modMode,additionalEligibility:()=>this.shouldIncludeModActions}),this.buildGenericMenuItem({postAction:t.sticky,menuId:this.modMenu.id,alwaysRenderPacked:!this.modMode,additionalEligibility:()=>this.shouldIncludeModActions}),this.buildGenericMenuItem({postAction:t.highlight,menuId:this.modMenu.id,alwaysRenderPacked:!this.modMode,additionalEligibility:()=>this.shouldIncludeModActions}),this.buildGenericMenuItem({postAction:t.nsfwTagMod,menuId:this.modMenu.id,alwaysRenderPacked:!this.modMode,additionalEligibility:()=>this.shouldIncludeModActions}),this.buildGenericMenuItem({postAction:t.spoilerTagMod,menuId:this.modMenu.id,alwaysRenderPacked:!this.modMode,additionalEligibility:()=>this.shouldIncludeModActions}),this.buildGenericMenuItem({postAction:t.distinguishAsMod,menuId:this.modMenu.id,alwaysRenderPacked:!this.modMode,additionalEligibility:()=>this.shouldIncludeModActions}),this.buildGenericMenuItem({postAction:t.crowdControl,menuId:this.modMenu.id,alwaysRenderPacked:!this.modMode,additionalEligibility:()=>this.shouldIncludeModActions}),this.buildGenericMenuItem({postAction:e.editPostFlair,menuId:this.defaultActionsMenu.id,additionalEligibility:()=>!i}),this.buildGenericMenuItem({postAction:e.promotePost,menuId:this.defaultActionsMenu.id,alwaysRenderPacked:!0,partialButtonProps:{children:p``}}),this.buildGenericMenuItem({postAction:e.save,menuId:this.defaultActionsMenu.id}),this.pinToProfileMenuItem(e),this.buildGenericMenuItem({postAction:e.hide,menuId:this.defaultActionsMenu.id}),this.buildGenericMenuItem({postAction:e.report,menuId:this.defaultActionsMenu.id}),this.buildGenericMenuItem({postAction:e.delete,menuId:this.defaultActionsMenu.id}),this.buildGenericMenuItem({postAction:e.adminDistinguish,menuId:this.defaultActionsMenu.id}),this.buildGenericMenuItem({postAction:e.spoilerTag,menuId:this.defaultActionsMenu.id,additionalEligibility:()=>!i}),this.buildGenericMenuItem({postAction:e.nsfwTag,menuId:this.defaultActionsMenu.id,additionalEligibility:()=>!i}),this.buildGenericMenuItem({postAction:e.brandAffiliate,menuId:this.defaultActionsMenu.id}),this.buildGenericMenuItem({postAction:e.replyNotifs,menuId:this.defaultActionsMenu.id}),this.buildGenericMenuItem({postAction:e.aboutThisAd,menuId:this.defaultActionsMenu.id,alwaysRenderPacked:!0})]}renderDropdownMenu(e){const t=super.renderDropdownMenu(e);return"defaultActions"===e.id&&this.showProfilePinPostCoachmark&&!this.unpackedItems.has("pinToProfile")?f({target:t,placement:"top"}):t}buildGenericMenuItem({postAction:e,menuId:t,alwaysRenderPacked:i,additionalEligibility:n,partialListItemProps:o,partialButtonProps:s}){const{id:a,label:r,shortLabel:l,disabled:c,href:u,target:m,onClick:b,leadingIconRenderer:M,trackingAttributes:k,isUserEligible:f}=e;return{id:a,menuId:t,packedRender:()=>$(g({label:p`${r}`,leadingIcon:M({}),size:A.Small,href:u||void 0,onClick:b,disabled:!!c,...o,attributes:{"data-testid":a}}),k),unpackedRender:()=>$(I({appearance:"plain-weak",attributes:{onclick:b,className:"relative shrink-0",href:u||void 0,target:m,disabled:!!c,"data-testid":a},size:d.Small,leadingIcon:this.useIconsAndShortLabels()?M({size:h.Small}):void 0,children:this.useIconsAndShortLabels()?null==l?void 0:p`${l}`:p`${r}`,...s}),k),shouldRender:()=>f()&&(!n||n()),alwaysRenderPacked:i}}buildShareMenuItem({shareAction:e,copyLinkAction:t,crosspostAction:i,embedAction:n,menuId:o}){return{id:e.id,menuId:o,unpackedRender:()=>$(this.isDesktopViewport?this.renderShareDropdown({handleShareClick:e.onClick,size:d.Small,appearance:"plain-weak"}):I({appearance:"plain-weak",attributes:{onclick:e.onClick,className:"relative shrink-0","data-testid":e.id},size:d.Small,leadingIcon:this.useIconsAndShortLabels()?e.leadingIconRenderer({size:h.Small}):void 0,children:this.useIconsAndShortLabels()?void 0:p`${e.label}`}),e.trackingAttributes),packedRender:()=>this.isDesktopViewport?p` ${$(g({attributes:{className:y,"data-testid":t.id},leadingIcon:t.leadingIconRenderer({}),label:p`${t.label}`,onClick:t.onClick}),t.trackingAttributes)} ${this.isCrosspostable&&i.isUserEligible()&&this.isDesktopViewport?$(g({attributes:{className:S,"data-testid":i.id},leadingIcon:i.leadingIconRenderer({}),label:p`${i.label}`,onClick:i.onClick}),i.trackingAttributes):""} ${this.isEmbeddable&&n.isUserEligible()&&this.isDesktopViewport?$(g({attributes:{className:v,tabindex:"0","data-testid":n.id},leadingIcon:n.leadingIconRenderer({}),label:p`${n.label}`,onClick:n.onClick}),n.trackingAttributes):""} `:$(g({leadingIcon:e.leadingIconRenderer({}),label:`${e.label}`,onClick:e.onClick,attributes:{"data-testid":e.id}}),e.trackingAttributes),shouldRender:e.isUserEligible}}pinToProfileMenuItem(e){const t=this.buildGenericMenuItem({postAction:e.pinToProfile,menuId:this.defaultActionsMenu.id});return this.showProfilePinPostCoachmark?{...t,unpackedRender:()=>f({target:t.unpackedRender(),placement:"top"}),boundingClientRectSelector:":first-child"}:t}};function $(e,t){return t?p` <faceplate-tracker class="nd:visible contents" source="${t.source}" action="${t.action}" noun="${t.noun}"> ${e} </faceplate-tracker> `:e}t([i({type:Boolean,attribute:"should-include-mod-actions"})],B.prototype,"shouldIncludeModActions",void 0),t([i({type:Boolean,attribute:"mod-mode"})],B.prototype,"modMode",void 0),t([i({type:String,attribute:"primary-button-appearance"})],B.prototype,"primaryButtonAppearance",void 0),B=t([r("unpacking-overflow-menu")],B);export{B as UnpackingOverflowMenu};
