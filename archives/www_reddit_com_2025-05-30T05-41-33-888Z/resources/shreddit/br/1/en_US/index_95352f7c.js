import{_ as t,n as e,E as o,P as a,ab as r,$ as n,aP as s,T as i,aJ as p,b as d,a2 as l,a9 as c,e as u,a as h,x as m,eM as v,o as b,t as w,K as y,g as f,aE as g,dv as x,M as $,O as I}from"./shell-2264602c.js";import"./shop-gallery-data-fetcher-client-js-73ca6a07.js";import{x as C,l as S,o as k,A as P,bA as U,bB as E,s as T,I as D,g as A,bC as z,bD as V,bE as N,b9 as B}from"./icon-82dd10b4.js";import{I as j,c as M,A as _,B as O,g as R}from"./content-action-button-a25cd1f9.js";import{A as X}from"./award-controller-c1fa775d.js";import{R as G}from"./header-action-item-chat-client-js-8d009dcd.js";import{a as L}from"./awardsTelemetryState-e939bf46.js";import{N as Y,t as q}from"./modActions-c13cf697.js";import{a as F}from"./mod-bulk-actions-285bd4b9.js";import{P as K}from"./rpl-popper-2d8cefe0.js";import{a as J}from"./tooltip.base-7152f24f.js";import{u as H,o as Q}from"./age-gate-standalone-client-js-5357b0cf.js";import{a as W}from"./awards-d066f3fe.js";var Z;let tt=Z=class extends G{get awardButton(){return this.querySelector("button")}get isFreeAwardPromo(){return this.awardsPromoType===F.LimitedEditionAward}get isUpvoteUpsellPromo(){return this.awardsPromoType===F.UpvoteUpsellTooltip}get closeOnDocumentInteraction(){return!this.isFreeAwardPromo}get showOnEnter(){return this.isFreeAwardPromo}get showOnUpvote(){return this.isUpvoteUpsellPromo}constructor(){super(),this.placement=K.Bottom,this.appearance=J.Inverted,this.buttonEventsController=new o(this,(()=>this.awardButton)),this.eventsController=new o(this),this.pubSubController=new a(this),this.onUpvote=({postId:t})=>{this.thingId&&this.thingId===t&&this._show()};const t=this.handleDocumentKeyDown;this.handleDocumentKeyDown=e=>{this.closeOnDocumentInteraction&&t.call(this,e)};const e=this.handleDocumentClick;this.handleDocumentClick=t=>{this.closeOnDocumentInteraction&&e.call(this,t)},this.show=()=>Promise.resolve()}connectedCallback(){super.connectedCallback(),this.buttonEventsController.define("faceplate-enter",this._show.bind(this)),this.eventsController.define(this.emitter.eventId("show"),this.logAction.bind(this,r.View)),this.eventsController.define(this.emitter.eventId("hide"),this.logAction.bind(this,r.Dismiss))}disconnectedCallback(){super.disconnectedCallback(),this.observerController&&(this.observerController=n(this,this.observerController))}updated(t){if(t.has("awardsPromoType")&&(this.content=function(t){switch(t){case F.LimitedEditionAward:return"New, limited-edition award available!";case F.UpvoteUpsellTooltip:return"Love this post? Award it!";default:return""}}(this.awardsPromoType)),this.showOnEnter&&!this.observerController){const{awardButton:t}=this;this.observerController=t?new s(this,t):void 0}!this.showOnEnter&&this.observerController&&(this.observerController=n(this,this.observerController)),this.showOnUpvote?this.pubSubController.subscribe(i.PostUpvoted,this.onUpvote,!1):this.pubSubController.unsubscribe(i.PostUpvoted,this.onUpvote),super.updated(t)}logAction(t){return this.awardsPromoVariantID&&Z.viewedPromos.add(this.awardsPromoVariantID),p(this,d({source:Y,action:t.toLowerCase(),noun:"tooltip"},{action_info:{page_type:l()},correlation_id:L.getCorrelationId(),new_award:{uxts_experience:this.awardsPromoExperience,uxts_variant:this.awardsPromoVariantID},...this.postId&&{post:{id:this.postId}}})),this.awardsPromoExperience&&c(t,this.awardsPromoExperience,{variantId:this.awardsPromoVariantID})}_show(){if(this.content&&this.awardsPromoVariantID&&!Z.viewedPromos.has(this.awardsPromoVariantID))return super.show()}};tt.viewedPromos=new Set,t([e({type:String,attribute:"thing-id"})],tt.prototype,"thingId",void 0),t([e({type:String,attribute:"awards-promo-experience"})],tt.prototype,"awardsPromoExperience",void 0),t([e({type:String,attribute:"awards-promo-type"})],tt.prototype,"awardsPromoType",void 0),t([e({type:String,attribute:"awards-promo-variant-id"})],tt.prototype,"awardsPromoVariantID",void 0),t([e({type:String,attribute:"post-id"})],tt.prototype,"postId",void 0),t([e()],tt.prototype,"placement",void 0),t([e({type:String,reflect:!0})],tt.prototype,"appearance",void 0),tt=Z=t([u("award-promo-coachmark")],tt),W.Limited,W.Community,W.Free;let et=class extends(h(T)){constructor(){super(...arguments),this.size=m.Medium,this.disabled=!1,this.count=0,this.hasEnteredViewport=!1,this.awardController=new X(this,{getThingId:()=>this.thingId,getAwardPromoConfig:()=>({experience:this.awardPromoExperience,id:this.awardPromoId,type:this.awardPromoType}),onAward:t=>{this.count++,this.isAwardedByUser=!0,t&&(this.awardId=t.id,this.iconUrl=t.staticIcon.url,this.hasIconicAward||(this.hasIconicAward=function(t){return function(t,e){return t.tags?.includes(e)}(t,W.Iconic)}(t)))}}),this.handleEnterViewport=()=>{this.hasEnteredViewport=!0,this.observerController&&(this.observerController=n(this,this.observerController))},this.handleClick=()=>{const t=L.setCorrelationId(),e=L.setPostType(this.postType);this.trackEvent(q({awardId:this.awardId,thingId:this.thingId,subredditId:this.subredditId,postId:this.postId,topAwardIconUrl:this.iconUrl,animatedAwardIconUrls:this.iconUrls,correlationId:t,position:this.feedIndex,postType:e,postScore:this.postScore,score:this.score,numberComments:this.commentCount})),this.awardController.activateDialog()}}connectedCallback(){super.connectedCallback(),this.observerController=v(this,this,this.handleEnterViewport,{rootMargin:"0px"})}disconnectedCallback(){super.disconnectedCallback(),this.observerController&&(this.observerController=n(this,this.observerController))}renderGlow(){return C`<span class="glow" style="${S(this.isAwardedByUser?"--fade-out: none":void 0)}"> ${Array.from({length:8}).map(((t,e)=>C`<span class="sunbeam" style="${k({"--n":e})}"></span>`))} </span>`}renderStream(){if(H())return P;const{iconUrls:t}=this;if(!t)return P;const e=[1,-1,0,-1],o=Number(t[0]===this.iconUrl);return C`<span class="stream"> ${Array.from({length:16}).map(((a,r)=>C`<img style="${k({"--n":r,"--offset":e[r%e.length]})}" src="${t[(r+o)%t.length]}" width="16" height="16" alt="">`))} </span>`}render(){if(!this.thingId)return P;const t=j[this.size],e=M({appearance:this.appearance,attributes:{type:"button",className:Q("overflow-visible",this.hasIconicAward&&!this.noIconicTreatment&&"border-sm border-global-gold",this.buttonClass),disabled:this.disabled,onclick:this.handleClick,"aria-label":0===this.count?"Give award":b({count:this.count,one:`Give award, ${this.count} award given`,few:`Give award, ${this.count} awards given`,many:`Give award, ${this.count} awards given`,other:`Give award, ${this.count} awards given`})},size:this.size,leadingIcon:this.iconUrl?C`<span class="${Q("flex relative",this.disabled&&"opacity-25")}" aria-hidden="true"> ${this.hasEnteredViewport?this.renderGlow():P} ${this.hasEnteredViewport?this.renderStream():P} <img src="${this.iconUrl}" alt="" class="relative" width="${U[t]}" height="${U[t]}"> </span>`:E({attributes:{"aria-hidden":"true"},size:t}),children:this.count?C`<faceplate-number number="${this.count}" pretty aria-hidden="true"></faceplate-number>`:this.withInitialStateText?C`<span aria-hidden="true">Award</span>`:void 0});return this.awardPromoExperience&&this.awardPromoId&&this.awardPromoType&&(this.awardPromoType!==F.LimitedEditionAward||1===this.feedIndex)?C`<award-promo-coachmark thing-id="${this.thingId}" post-id="${S(this.postId)}" awards-promo-experience="${this.awardPromoExperience}" awards-promo-variant-id="${this.awardPromoId}" awards-promo-type="${this.awardPromoType}"> ${e} </award-promo-coachmark>`:e}};var ot;et.styles=[w,y("@keyframes fade-in {\n  0% {\n    opacity: 0;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n@keyframes rotate-clockwise {\n  0% {\n    transform: rotate(45deg);\n  }\n  100% {\n    transform: rotate(135deg);\n  }\n}\n@keyframes sunbeam-even {\n  0% {\n    transform: scaleX(1) scaleY(1);\n  }\n  50% {\n    transform: scaleX(1.2) scaleY(1.3);\n  }\n  100% {\n    transform: scaleX(1) scaleY(1);\n  }\n}\n@keyframes sunbeam-odd {\n  0% {\n    transform: scaleX(1.2) scaleY(1.3);\n  }\n  50% {\n    transform: scaleX(1) scaleY(1);\n  }\n  100% {\n    transform: scaleX(1.2) scaleY(1.3);\n  }\n}\n.glow {\n  display: block;\n  position: absolute;\n  left: 50%;\n  top: 50%;\n  width: 0;\n  height: 0;\n  perspective: 5em;\n  animation: 3s ease-out 1.5s both rotate-clockwise, 0.5s ease-in 1.5s backwards fade-in, var(--fade-out, 0.5s ease-out 5s reverse forwards fade-in);\n}\n.glow::before {\n  content: '';\n  display: block;\n  position: absolute;\n  left: -1em;\n  top: -1em;\n  background: radial-gradient(rgba(245, 214, 87, 0.9), rgba(245, 214, 87, 0) 50%);\n  width: 2em;\n  height: 2em;\n}\n.glow > .sunbeam {\n  display: block;\n  transform: rotate(calc(var(--n) * 45deg)) rotateX(-45deg);\n}\n.glow > .sunbeam::before {\n  content: '';\n  display: block;\n  background: no-repeat linear-gradient(rgba(245, 214, 87, 0.9), rgba(245, 214, 87, 0));\n  height: 1em;\n  width: 0.3em;\n  position: absolute;\n  transform: rotate(180deg) translateX(50%);\n  transform-origin: 50% 0px;\n  animation: 1.5s linear 1.5s 2 both sunbeam-even;\n  animation-composition: add;\n}\n.glow > .sunbeam:nth-child(odd)::before {\n  animation-name: sunbeam-odd;\n}\n"),y("@keyframes stream {\n  0% {\n    transform: scale(0);\n  }\n  20% {\n    transform: scale(1);\n    opacity: 1;\n  }\n  100% {\n    offset-distance: 100%;\n    opacity: 0;\n  }\n}\n.stream {\n  pointer-events: none;\n  position: absolute;\n  bottom: calc(100px + 50%);\n  left: 50%;\n}\n.stream > img {\n  animation: 2s ease-in both stream;\n  animation-delay: calc(var(--n) * 0.2s);\n  offset-path: path('M2.5,100 q-5,-10,0,-20 t 0-20 0-20 0-20 0-20');\n  offset-rotate: 0deg;\n  position: absolute;\n  translate: calc(var(--offset) * 8px);\n}\n")],t([e({type:String})],et.prototype,"appearance",void 0),t([e({type:String})],et.prototype,"size",void 0),t([e({type:String,attribute:"button-class"})],et.prototype,"buttonClass",void 0),t([e({type:Boolean,reflect:!0})],et.prototype,"disabled",void 0),t([e({type:Boolean,attribute:"no-iconic-treatment"})],et.prototype,"noIconicTreatment",void 0),t([e({type:Boolean,attribute:"with-initial-state-text"})],et.prototype,"withInitialStateText",void 0),t([e({type:Boolean,attribute:"is-logged-in"})],et.prototype,"isLoggedIn",void 0),t([e({type:Boolean,reflect:!0,attribute:"is-awarded-by-user"})],et.prototype,"isAwardedByUser",void 0),t([e({type:String,attribute:"thing-id"})],et.prototype,"thingId",void 0),t([e({type:Number,attribute:"feed-index"})],et.prototype,"feedIndex",void 0),t([e({type:String,attribute:"subreddit-id"})],et.prototype,"subredditId",void 0),t([e({type:String,attribute:"post-id"})],et.prototype,"postId",void 0),t([e({type:String,attribute:"post-type"})],et.prototype,"postType",void 0),t([e({type:Number,attribute:"post-score"})],et.prototype,"postScore",void 0),t([e({type:Number})],et.prototype,"score",void 0),t([e({type:Number,attribute:"comment-count"})],et.prototype,"commentCount",void 0),t([e({type:Number,reflect:!0})],et.prototype,"count",void 0),t([e({type:String,reflect:!0,attribute:"award-id"})],et.prototype,"awardId",void 0),t([e({type:String,reflect:!0,attribute:"icon-url"})],et.prototype,"iconUrl",void 0),t([e({type:Array,attribute:"icon-urls"})],et.prototype,"iconUrls",void 0),t([e({type:Boolean,reflect:!0,attribute:"has-iconic-award"})],et.prototype,"hasIconicAward",void 0),t([e({type:String,attribute:"award-promo-experience"})],et.prototype,"awardPromoExperience",void 0),t([e({type:String,attribute:"award-promo-id"})],et.prototype,"awardPromoId",void 0),t([e({type:String,attribute:"award-promo-type"})],et.prototype,"awardPromoType",void 0),t([f()],et.prototype,"hasEnteredViewport",void 0),et=t([u("award-button")],et),function(t){t.Upvote="upvote",t.Downvote="downvote"}(ot||(ot={}));const at=({appearance:t,active:e})=>`group button flex justify-center aspect-square p-0 border-0 ${_[t]} ${!e&&"disabled:text-interactive-content-disabled"} ${e&&"secondary"===t?"":"button-plain"}  inline-flex items-center`,rt=({size:t})=>({size:t===m.Small||t===m.ExtraSmall?D.Small:D.Medium}),nt=({size:t})=>`flex mx-xs ${g[t]}`,st=t=>{let e="bg-transparent text-global-white hover:text-global-white";switch(t){case ot.Downvote:e+=" hover:bg-downvote-background-hover";break;case ot.Upvote:e+=" hover:bg-upvote-background-hover"}return e},it=({attributes:t,size:e=m.Medium,appearance:o="plain",screenReaderContent:a,voteType:r,onClick:n})=>{const{html:s,createElement:i}=A(),p=null!=r,d=r===ot.Downvote,l=at({appearance:o,active:p});return i("button",{rpl:!0,downvote:!0,...t,onclick:n,className:`${t?.className||""} ${l} ${{plain:d?"text-action-downvote":"hover:text-action-downvote focus-visible:text-action-downvote",secondary:p?st(r):"hover:text-action-downvote focus-visible:text-action-downvote",bordered:d?"text-action-downvote":"hover:text-action-downvote focus-visible:text-action-downvote","plain-weak":d?"text-action-downvote":"hover:text-action-downvote focus-visible:text-action-downvote"}[o]}`,style:`height: ${O[e]};`,"aria-pressed":d},s`<span class="${nt({size:e})}"> ${(d?z:V)(rt({size:e}))} </span> ${a&&s`<faceplate-screen-reader-content> ${a||"Downvote"} </faceplate-screen-reader-content>`}`)};var pt;!function(t){t.Upvote="upvote",t.Downvote="downvote"}(pt||(pt={}));const dt=t=>`group button flex justify-center p-0 border-0 ${_[t]} inline-flex items-center`,lt=({size:t})=>({attributes:{classname:"rpl-vote-button-icon"},size:t===m.Small||t===m.ExtraSmall?D.Small:D.Medium}),ct=({size:t})=>`flex mx-xs ${g[t]}`,ut=t=>{const{html:e,createElement:o}=A(),{appearance:a="plain",attributes:r,size:n=m.Medium,screenReaderContent:s,voteType:i,onClick:p}=t,d=n===m.Small,l=i===pt.Downvote,c=r?.href;return o(null!=c?"a":"button",{rpl:!0,downvote:!0,...r,onclick:p,className:`\n        ${r?.className||""} \n        rounded-none\n        ${d?"rounded-l-[8px]":"rounded-l-[12px]"}\n        ${dt(a)} \n      `,style:`height: ${O[n]};`,"aria-pressed":l},e`<span class="${d?"mr-sm":"mr-md"} ${"plain"===a?"ml-[3px]":"ml-xs"} ${ct({size:n})}"> ${(l?z:V)(lt({size:n}))} </span> ${s&&e`<faceplate-screen-reader-content> ${s||"Downvote"} </faceplate-screen-reader-content>`}`)},ht=({attributes:t,size:e=m.Medium,appearance:o="plain",screenReaderContent:a,voteType:r,onClick:n})=>{const{html:s,createElement:i}=A(),p=null!=r,d=r===ot.Upvote,l=at({appearance:o,active:p});return i("button",{rpl:!0,upvote:!0,onclick:n,...t,className:`${t?.className||""} ${l} ${{plain:d?"text-action-upvote":"hover:text-action-upvote focus-visible:text-action-upvote",secondary:p?st(r):"hover:text-action-upvote focus-visible:text-action-upvote",bordered:d?"text-action-upvote":"hover:text-action-upvote focus-visible:text-action-upvote","plain-weak":d?"text-action-upvote":"hover:text-action-upvote focus-visible:text-action-upvote"}[o]}`,style:`height: ${O[e]};`,"aria-pressed":d},s`<span class="${nt({size:e})}"> ${(d?N:B)(rt({size:e}))} </span> ${a&&s`<faceplate-screen-reader-content> ${a||"Upvote"} </faceplate-screen-reader-content>`}`)},mt=t=>{const{html:e,createElement:o}=A(),{appearance:a="plain",attributes:r,initialStateText:n,onClick:s,screenReaderContent:i,size:p=m.Medium,voteCount:d,voteType:l}=t,c=p===m.Small,u=l===pt.Upvote,h=r?.href;return o(null!=h?"a":"button",{rpl:!0,upvote:!0,onclick:s,...r,className:`\n        ${r?.className||""} \n        rounded-none \n        ${c?"rounded-r-[8px]":"rounded-r-[12px]"}\n        ${dt(a)}\n      `,style:`height: ${O[p]};`,"aria-pressed":u},e` <span class="${c?"ml-sm":"ml-md"} mr-[6px] ${ct({size:p})}"> ${(u?N:B)(lt({size:p}))} </span> ${i&&e`<faceplate-screen-reader-content> ${i||"Upvote"} </faceplate-screen-reader-content>`} ${null==d?n?e`<span class="rpl-vote-button-group-label ${"plain"===a?"pr-[3px]":"pr-[10px]"}">${n}</span>`:"":e`<span class="rpl-vote-button-group-label ${"plain"===a?"pr-[3px]":"pr-[10px]"}"> <faceplate-number number="${d}" pretty></faceplate-number> </span>`} `)},vt=(t,e)=>"secondary"===e?{upvote:"bg-action-upvote text-global-white border-action-upvote ",downvote:"bg-action-downvote text-global-white border-action-downvote "}[t]:"",bt={secondary:"bg-interactive-background-disabled text-[color:var(--color-button-secondary-text-disabled)] border-transparent",plain:"bg-[color:var(--color-button-plain-background-disabled)] text-[color:var(--color-button-plain-text-disabled)] border-transparent",bordered:"","plain-weak":"text-interactive-content-disabled"},wt=({voteType:t,appearance:e})=>null==t?bt[e]:"opacity-40 text-global-white",yt=({attributes:t,voteCount:e,voteType:o,upvoteButton:a,downvoteButton:r,size:n=m.Medium,appearance:s="plain",initialStateText:i})=>{const{html:p,createElement:d}=A(),l=p`${a} ${null==e?i:p`<span> <faceplate-number number="${e}" pretty></faceplate-number> </span>`} ${r}`;return d("span",{...t,className:`${t?.className||""} ${o?vt(o,s):""}\n      p-0 ${R({size:n,appearance:s,selected:!0})} button-shell overflow-visible font-semibold flex items-center cursor-auto ${t?.disabled?wt({voteType:o,appearance:s}):""}`,rpl:!0},l)},ft=({attributes:t,voteType:e,upvoteButton:o,downvoteButton:a,size:r=m.Medium,appearance:n="plain"})=>{const{html:s,createElement:i}=A(),p=s`${o} ${(()=>{if("plain"===n)return"";const t=r===m.Small?"h-md":"h-[20px]";return s`<span class="rpl-vote-button-group-divider rounded-sm ml-[-2px] translate-x-px w-px ${t}"></span>`})()} ${a}`;return i("span",{...t,className:`\n      rpl-vote-button-group p-0 button-shell overflow-hidden font-semibold flex items-center cursor-auto\n      ${t?.className||""} \n      ${e??""}\n      ${R({size:r,appearance:n})}`,rpl:!0},p)};function gt(t,e){return!t&&e===ot.Upvote||t===ot.Downvote&&e===ot.Downvote?1:!t&&e===ot.Downvote||t===ot.Upvote&&e===ot.Upvote?-1:t===ot.Downvote&&e===ot.Upvote?2:t===ot.Upvote&&e===ot.Downvote?-2:0}async function xt(t,e,o){let a=x.None;o&&(a=o===ot.Upvote?x.Up:x.Down);const r=await $(It(t,e,a)),{ok:n,errors:s,voteStateResult:i}=$t(r,e);if(n){const t=i;if(t===x.None)return;return t===x.Up?ot.Upvote:ot.Downvote}if(s?.[0]){const t=s[0]?.message??"Something went wrong";throw new Error(t)}return o}const $t=(t,e)=>{if("post"===e){const e=t;return{ok:e.data?.updatePostVoteState?.ok,errors:e.data?.updatePostVoteState?.errors,voteStateResult:e.data?.updatePostVoteState?.voteState}}const o=t;return{ok:o.data?.updateCommentVoteState?.ok,errors:o.data?.updateCommentVoteState?.errors,voteStateResult:o.data?.updateCommentVoteState?.voteState}},It=(t,e,o)=>"post"===e?{operation:I.UpdatePostVoteState,variables:{input:{postId:t,voteState:o}}}:{operation:I.UpdateCommentVoteState,variables:{input:{commentId:t,voteState:o}}};export{ot as V,yt as a,ht as b,it as c,ut as d,gt as g,xt as o,mt as u,ft as v};
