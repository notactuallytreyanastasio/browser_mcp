import{O as e,aa as t,w as s,x as o,ab as a,b as r,e9 as i,a as n,_ as c,n as l,a$ as h,r as p,bx as u,c as d,I as m,bC as k}from"./shell-2264602c.js";import{x as g,l as y,c as b,I as S,bf as w,A as f,V as v}from"./icon-82dd10b4.js";import{a as C}from"./promote-post-actions-controller-f5bf291f.js";import{c as $,I as _}from"./content-action-button-a25cd1f9.js";import{l as E,L as x}from"./expandable-section-header-edd4c2b3.js";import{S as M,s as I}from"./index-7436fa38.js";import"./header-action-item-chat-client-js-8d009dcd.js";import{S as P}from"./profile-creation-1d60123b.js";import"./rpl-coachmark-f5614db3.js";import"./rpl-coachmark-card-3cbe7edc.js";import{P as N}from"./rpl-popper-2d8cefe0.js";import"./tooltip.base-7152f24f.js";import"./select-controller-e11d5e4c.js";const L="share-menu-template",D="comment-share-menu-template",B="share-menu-copy-link-option",T="share-menu-crosspost-option",A="share-menu-embed-option",j="share-dropdown-menu",q=e=>({target:t,placement:s})=>U({...e,target:t,placement:s??e.placement}),z=({content:e,experienceName:t,source:r})=>g`<rpl-coachmark-card auto-close appearance="inverted" slot="content" class="${"whitespace-nowrap"}"> ${(({experienceName:e,source:t})=>{const r='closest([slot="close-button"])';return g` ${s({attributes:{type:"button","aria-label":"Close",slot:"close-button"},appearance:"plainInverted",leadingIcon:b({size:S.Small}),size:o.Small})} <ac-track san="${t}|click|close_button" trigger-elem="${r}"> </ac-track> ${O({action:a.Dismiss,experienceName:e,triggerElem:r})} `})({experienceName:t,source:r})} <span slot="title" class="font-[500]">${e}</span> <ac-track trigger="view" san="${r}|view|card"></ac-track> ${O({action:a.View,experienceName:t,trigger:"view"})} </rpl-coachmark-card> `,O=({action:s,experienceName:o,trigger:a,triggerElem:r})=>g` <ac-gql-mutate operation="${e.StoreUxtargetingAction}" trigger="${y(a)}" trigger-elem="${y(r)}" variables="${JSON.stringify({input:{action:s,eligibleExperience:{experienceName:o,experience:t.StringIdExperience}}})}"> </ac-gql-mutate> `,U=({content:e,experienceName:t,placement:s,source:o,target:r})=>g` <rpl-coachmark open no-animate trigger="manual" appearance="inverted" placement="${y(s)}" id="reddit-pro-coachmark" label="${e}"> ${(({experienceName:e,target:t,source:s})=>g` <span> ${t} <ac-call target="closest(#reddit-pro-coachmark)" method="hide()"> </ac-call> <ac-track san="${s}|click|target"></ac-track> ${O({action:a.Click,experienceName:e})} </span> `)({experienceName:t,source:o,target:r})} ${z({content:e,experienceName:t,source:o})} </rpl-coachmark> `,Q=q({experienceName:P,content:"Share your favorite content to your profile",source:"reddit_pro_share_menu_coachmark",placement:N.Top}),V=({source:e,noun:t})=>r({source:e||"share",action:"click",noun:t}),F=({source:e}={})=>V({source:e,noun:"share_crosspost"}),H=({source:e}={})=>V({source:e,noun:"share_profile_crosspost"}),K=Symbol("mixins/with-share");function R(e){if(i(e,K))return e;const t=n(e);class s extends t{constructor(){super(...arguments),this.permalink="",this.sourceId="",this.source=void 0,this.isCrosspostable=!1,this.isEmbeddable=!1,this.disabled=!1,this.isDesktopViewport=!1,this.hideButtonText=!1,this.hideButtonIcon=!1,this.shouldAllowPropagation=!1,this.shareMenuFeatureName=h,this.shareMenuTemplateId=L,this.translationLanguage="",this.showShareMenuProfileCoachmark=!1,this.isShareMenuInitiated=!1,this.isShareDropdownOpened=!1,this.activateShareMenuFeature=()=>{const e={};return this.isCrosspostable&&(e.isCrosspostable=!0),this.isEmbeddable&&(e.isEmbeddable=!0),p({name:this.shareMenuFeatureName,queryParams:e})},this.isAllowedEvent=e=>!e||(e instanceof PointerEvent||e instanceof MouseEvent||["Enter"," "].includes(e.key)),this.handleMobileShareClick=async e=>{this.isAllowedEvent(e)&&await this._copyLink()},this.handleDesktopShareClick=async e=>{if(!this.isAllowedEvent(e))return;if(this.isShareMenuInitiated)return;let t=!1;try{t=Boolean(await this.activateShareMenuFeature())}catch(t){return void this.handleCopyLinkClick(e)}const s=document.querySelector(`#${this.shareMenuTemplateId}`)?.content;if(!s)return void this.handleCopyLinkClick(e);const o=this.getShareDropdownMenus();o?.length&&(o.forEach((e=>{if(e.querySelector("faceplate-menu"))return;const o=s.cloneNode(!0);e.appendChild(o),J(e,B,this.handleCopyLinkClick),J(e,T,this.handleCrosspostClick),J(e,A,this.handleEmbedClick),J(e,"klp-copy-link",this.handleKlpCopyLinkClick),J(e,"share-menu-profile-crosspost-option",this.handleProfileCrosspostClick),t&&e.show?.()})),t&&this.handleShareDropdownOpen(),this.isShareMenuInitiated=!0)},this.handleShareDropdownOpen=()=>{this.isShareDropdownOpened||(this.isShareDropdownOpened=!0,this.trackEvent((({source:e}={})=>r({source:e||"share",action:"view",noun:"custom_share_sheet"}))({source:this.source})))},this.handleShareDropdownClose=()=>{this.isShareDropdownOpened=!1,this.trackEvent((({source:e}={})=>r({source:e||"share",action:"dismiss",noun:"custom_share_sheet"}))({source:this.source}))},this.getShareDropdownMenus=()=>{const e=this.shadowRoot?.querySelectorAll(`.${j}`);if(e?.length)return e;const t=this.querySelectorAll(`faceplate-dropdown-menu.${j}`);if(t?.length)return t;const s=this.querySelectorAll("slot");for(const e of s){const t=e.assignedElements?.();if(t?.length){const e=Array.from(t).find((e=>e.classList?.contains(j)||e.querySelector(`.${j}`)));if(e)return[e.classList?.contains(j)?e:e.querySelector(`.${j}`)]}}},this.closeShareMenu=()=>{this.getShareDropdownMenus()?.forEach((e=>e.close?.()))},this.handleCopyLinkClick=async e=>{this.shouldAllowPropagation||e?.stopPropagation(),this.isAllowedEvent(e)&&(this.trackEvent((({source:e}={})=>V({source:e,noun:"copy_link"}))({source:this.source})),this.closeShareMenu(),await this._copyLink())},this.handleKlpCopyLinkClick=async e=>{this.isAllowedEvent(e)&&(this.closeShareMenu(),await this._copyLink())},this.handleKlpNotUsefulClick=e=>{this.isAllowedEvent(e)&&this._notUseful()},this.handleKlpUsefulClick=e=>{this.isAllowedEvent(e)&&this._useful()},this.handleCrosspostClick=e=>{this._handlePostComposerClick(e,`${u.CrosspostSourceId}=${this.sourceId}`,F)},this.handleProfileCrosspostClick=e=>{this._handlePostComposerClick(e,`${u.CrosspostSourceId}=${this.sourceId}&${u.CrosspostTarget}=profile`,H)},this.handleEmbedClick=e=>{e.stopPropagation(),this.isAllowedEvent(e)&&(this.trackEvent((({source:e}={})=>V({source:e,noun:"embed"}))({source:this.source})),this.closeShareMenu(),window.open(`https://publish.reddit.com/embed?url=https://www.reddit.com${this.permalink}`,"RedditEmbed"))},this._handlePostComposerClick=(e,t,s)=>{e.stopPropagation(),this.isAllowedEvent(e)&&(this.trackEvent(s({source:this.source})),this.closeShareMenu(),window.open(`/submit?${t}`,"_blank"))},this._copyLink=async()=>{if(!this.permalink||!location.origin)return;const e={url:this._buildShareUrl(location.origin,this.permalink)};if(M.Clipboard===await I(e,this.isDesktopViewport)){const e=d("faceplate-alert",{level:m.success,message:"Link copied"});this.dispatchEvent(e)}},this._notUseful=()=>{const e=d("faceplate-alert",{level:m.notice,message:"Thanks for letting us know"});this.dispatchEvent(e)},this._useful=()=>{const e=d("faceplate-alert",{level:m.notice,message:"Thanks for letting us know"});this.dispatchEvent(e)},this._buildShareUrl=(e,t)=>{const s=t.includes("?"),o=t.includes("tl=");return e+t+this._getShareQueryParams({source:this.source,term:"1",permalinkHasQuery:s,permalinkHasTlQuery:o})},this._getShareQueryParams=({permalinkHasQuery:e=!1,permalinkHasTlQuery:t=!1,source:s="share",term:o})=>{const a=this._getShareUTMParams({source:s,term:o}),r=t?"":this._getShareTranslationLanguageQueryParams();return e?`&${a}${r}`:`?${a}${r}`},this._getShareTranslationLanguageQueryParams=()=>this.translationLanguage?`&share_tl=${this.translationLanguage}`:"",this._getShareUTMParams=({source:e="share",term:t})=>{const s=k();return`utm_source=${e}&utm_medium=${s}&utm_name=${s}css&utm_term=${t}&utm_content=share_button`},this.renderShareDropdown=({handleShareClick:e,size:t=o.Small,appearance:s="plain",attributes:a={},shareButtonText:r})=>{const i=r||"Share",n="link"===s,c=g` <faceplate-dropdown-menu class="${j} relative ${n?"inline":""}" position="bottom-start" .onopen="${this.isDesktopViewport?this.handleShareDropdownOpen:void 0}" .onclose="${this.isDesktopViewport?this.handleShareDropdownClose:void 0}"> ${n?C({attributes:{onclick:e,onkeydown:e,...a},children:this.hideButtonText?void 0:i,suppressVisitedStyle:!0}):$({size:t,appearance:s,attributes:{type:"button",onclick:e,onkeydown:e,...a},leadingIcon:this.hideButtonIcon?void 0:w({size:_[t],attributes:{className:"icon-share","aria-hidden":"true"}}),screenReaderContent:i,children:this.hideButtonText?void 0:i})} </faceplate-dropdown-menu>`;return this.showShareMenuProfileCoachmark?Q({target:c}):c},this.renderOnlyShareButton=({handleShareClick:e,size:t=o.Small,appearance:s="plain",attributes:a={},showFullButtons:r=!1})=>{const i="Copy link";return g` ${"link"===s?f:$({size:t,appearance:s,attributes:{type:"button",onclick:e,onkeydown:e,...a,className:`${a.className} relative`},screenReaderContent:i,children:g` <span class="justify-center ${r?"flex s:hidden":"flex"}">${v({size:S.Small})}</span> <span class="${r?"hidden s:flex":"hidden"}"> ${i} </span> `})}`},this.renderOnlyShareMenuItem=({handleShareClick:e,menuSize:t=x.Medium})=>E({leadingIcon:v(),label:"Copy link",size:t,onClick:e})}}return s[K]=!0,c([l({type:String})],s.prototype,"permalink",void 0),c([l({type:String,attribute:"source-id"})],s.prototype,"sourceId",void 0),c([l({type:String,attribute:"source"})],s.prototype,"source",void 0),c([l({type:Boolean,attribute:"is-crosspostable"})],s.prototype,"isCrosspostable",void 0),c([l({type:Boolean,attribute:"is-embeddable"})],s.prototype,"isEmbeddable",void 0),c([l({type:Boolean})],s.prototype,"disabled",void 0),c([l({type:Boolean,attribute:"is-desktop-viewport"})],s.prototype,"isDesktopViewport",void 0),c([l({type:Boolean,attribute:"hide-button-text"})],s.prototype,"hideButtonText",void 0),c([l({type:Boolean,attribute:"hide-button-icon"})],s.prototype,"hideButtonIcon",void 0),c([l({type:Boolean,attribute:"should-allow-propagation"})],s.prototype,"shouldAllowPropagation",void 0),c([l({type:String,attribute:"share-menu-feature-name"})],s.prototype,"shareMenuFeatureName",void 0),c([l({type:String,attribute:"share-menu-template-id"})],s.prototype,"shareMenuTemplateId",void 0),c([l({type:String,attribute:"translation-language"})],s.prototype,"translationLanguage",void 0),c([l({type:Boolean,attribute:"show-share-menu-profile-coachmark"})],s.prototype,"showShareMenuProfileCoachmark",void 0),s}const J=(e,t,s)=>{const o=["click","keydown"],a=e.querySelector(`.${t}`);for(const e of o)a?.addEventListener(e,s)};export{D as C,A as E,L as S,R as W,j as a,B as b,T as c,q as d};
