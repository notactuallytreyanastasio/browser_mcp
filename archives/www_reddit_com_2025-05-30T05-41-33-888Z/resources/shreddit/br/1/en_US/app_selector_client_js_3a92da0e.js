import{_ as t,n as e,J as i,m as s,e as o,aM as h,hz as n,hH as a,c}from"./shell-2264602c.js";import{s as r,x as d,l,a as p}from"./icon-82dd10b4.js";import{T as _}from"./TinyGesture-89d9957c.js";const u="var(--bottom-sheet-max-height)";let g=class extends r{constructor(){super(...arguments),this.open=!1,this.blocking=!1,this.docked=!1,this.focusManager=new h(this,this),this.inFocusTrap=!1,this._isModal=!1,this._isExpanded=!1,this._isExpandable=!1,this._isDockable=!1,this._gesture=new _(this,{mouseSupport:!1}),this._cachedHeight="auto",this._dockedHeight="auto",this._cachedHeightAtTouchStartPx=0,this._rafID=null,this._mutationObserver=void 0,this.show=t=>{this._isModal=!1,this._isExpanded=(t&&"expanded"in t&&t.expanded)??!1,this._isExpandable=t?.expandable??!1,this._isDockable=t?.dockable??!1,this.open=!0,this._isExpandable&&(this._gesture.on("panstart",this._onTouchStart),this._gesture.on("panmove",this._onTouchMove),this._gesture.on("panend",this._onTouchEnd)),this._isExpanded?this._content.style.height=u:""!==this._content.style.height&&"auto"!==this._content.style.height||(this._cachedHeight=this._content.clientHeight+"px",this._content.style.height=this._cachedHeight),this._dockedHeight=this._headerElements[0]?this._headerElements[0].clientHeight-1+"px":"auto",this._mutationObserver||this._connectMutationObserver()},this.showModal=t=>{if(this.open)throw new Error('The element already has an "open" attribute, and therefore cannot be opened modally');n.add(this),this.show(t),this._isModal=!0,a.add(this)},this.close=()=>{const t=c("faceplate-close");this.dispatchEvent(t),t.defaultPrevented||(this.open=!1,this._isExpanded=!1,this.inFocusTrap&&(a.remove(this),n.remove(this)),this._isExpandable&&(this._gesture.off("panstart",this._onTouchStart),this._gesture.off("panmove",this._onTouchMove),this._gesture.off("panend",this._onTouchEnd)),this._content.style.height=this._cachedHeight)},this.expand=()=>{if(this.open&&this._isExpandable&&!this._isExpanded){const t=c("faceplate-expand");if(this.dispatchEvent(t),t.defaultPrevented)return;this._cancelRAF(),this._content.style.height=u,this.docked=!1,this._isExpanded=!0}},this.collapse=()=>{if(this.open&&this._isExpandable&&this._isExpanded){const t=c("faceplate-collapse");if(this.dispatchEvent(t),t.defaultPrevented)return;this._cancelRAF(),this._content.style.height=this._cachedHeight,this.docked=!1,this._isExpanded=!1}},this.dock=()=>{if(!this.open||!this._isDockable||this.docked)return;const t=c("faceplate-dock");this.dispatchEvent(t),t.defaultPrevented||(this._cancelRAF(),this._content.style.height=this._dockedHeight,this.docked=!0)},this.undock=()=>{if(!this.open||!this._isDockable||!this.docked)return;const t=this._isExpandable&&this._isExpanded?u:this._cachedHeight,e=c("faceplate-undock");this.dispatchEvent(e),e.defaultPrevented||(this._cancelRAF(),this._content.style.height=t,this.docked=!1)},this.recalculateCachedHeight=()=>{const t=this._cachedHeight;this._content.style.height="auto";const e=this._content.clientHeight+"px";this._cachedHeight=e,this._isDockable&&this.docked?this._content.style.height=this._dockedHeight:this._isExpandable&&this._isExpanded?this._content.style.height=u:(this._content.style.height=t,window.requestAnimationFrame((()=>{this._content.style.height=e,this._cancelRAF()})));const i=c("__TEST-ONLY_bottom-sheet-recalculation",{cachedHeight:this._cachedHeight,dockedHeight:this._dockedHeight,expandedHeight:u});this.dispatchEvent(i)},this._onTouchStart=()=>{this._cancelRAF(),this._content.style.transitionDuration="0ms",this._cachedHeightAtTouchStartPx=this._content.clientHeight},this._onTouchMove=()=>{this._cancelRAF(),this._isExpanded&&(this._gesture.touchMoveY??0)<=0||(this._rafID=window.requestAnimationFrame((()=>{null!=this._gesture.touchMoveY&&(this._content.style.height=this._cachedHeightAtTouchStartPx-this._gesture.touchMoveY+"px")})))},this._onTouchEnd=()=>{if(this._cancelRAF(),this._content.style.transitionDuration="300ms",!this.open||null==this._gesture.touchMoveY)return;const t=this._gesture.touchMoveY>=this._gesture.thresholdY,e=this._gesture.touchMoveY<=-this._gesture.thresholdY;t?this._isExpanded?this.collapse():this._closeIfNotBlocked():e?this._isExpanded||this.expand():this._isExpanded?this._content.style.height=u:this._content.style.height=this._cachedHeight},this._cancelRAF=()=>{this._rafID&&(window.cancelAnimationFrame(this._rafID),this._rafID=null)},this._renderHandle=()=>this._isExpandable?d`<div id="handle" class="${this._isModal?"out":"in"}"></div>`:null,this._handleBackDropKeyUp=t=>{"Enter"===t.key&&this._closeIfNotBlocked()},this._closeIfNotBlocked=()=>{this.blocking||this.close()},this.render=()=>d` <div id="backdrop" part="backdrop" class="${this._isModal&&this.open?"blocker":""}" @click="${this._closeIfNotBlocked}" @keyup="${this._handleBackDropKeyUp}"></div> <div id="content" part="content" role="${l(this.open?"dialog":void 0)}" aria-label="${l(this.label??void 0)}" aria-modal="${l(this.open&&this._isModal?"true":void 0)}"> ${this._renderHandle()} <slot name="header"></slot> <slot></slot> </div> `}static get styles(){return p`:host{--bottom-sheet-max-height:85vh}@supports (height:95dvh){:host{--bottom-sheet-max-height:95dvh}}:host{position:fixed;bottom:0;left:0;opacity:0;transition-duration:.3s;transition-property:visibility,opacity;transition-timing-function:ease;visibility:hidden;pointer-events:none}:host([open]){opacity:1;z-index:2;visibility:visible}:host([open])>#content{pointer-events:auto;transform:translateY(0)}:host>#backdrop{position:fixed;--backdrop-position-value:-100%;left:var(--backdrop-position-value);right:var(--backdrop-position-value);top:var(--backdrop-position-value);bottom:var(--backdrop-position-value)}:host>#backdrop.blocker{background:var(--color-scrim);pointer-events:auto}:host>#content{align-items:center;background:var(--color-ui-modalbackground);bottom:0;border-top-left-radius:var(--rem12);border-top-right-radius:var(--rem12);box-shadow:var(--boxshadow-modal);box-sizing:border-box;display:flex;flex-direction:column;left:0;position:fixed;touch-action:none;transform:translateY(100%);transition-duration:.3s;transition-property:height,transform;transition-timing-function:ease;width:100vw;max-height:var(--bottom-sheet-max-height)}:host>slot:not([name]){align-items:center;display:flex;flex-direction:column;gap:var(--spacer-sm)}#handle{position:absolute;top:0;left:50%;transform:translateX(-50%);height:var(--rem4);width:var(--rem48);border-radius:var(--rem4)}#handle.in{top:var(--spacer-xs);background-color:var(--color-neutral-border)}#handle.out{top:calc(-1 * var(--spacer-xs));background-color:var(--color-global-white)}`}disconnectedCallback(){super.disconnectedCallback(),this._gesture.destroy(),a.remove(this),n.remove(this),this._mutationObserver?.disconnect()}_connectMutationObserver(){this._mutationObserver=new MutationObserver((()=>{window.requestAnimationFrame(this.recalculateCachedHeight)})),this._mutationObserver.observe(this,{characterData:!0,childList:!0,attributes:!1,subtree:!0})}};t([e({type:Boolean,reflect:!0})],g.prototype,"open",void 0),t([e({type:Boolean})],g.prototype,"blocking",void 0),t([e({type:Boolean,reflect:!0})],g.prototype,"docked",void 0),t([e({type:String,attribute:"ariaLabel"})],g.prototype,"label",void 0),t([i("#content")],g.prototype,"_content",void 0),t([s({slot:"header"})],g.prototype,"_headerElements",void 0),g=t([o("faceplate-bottom-sheet")],g);
