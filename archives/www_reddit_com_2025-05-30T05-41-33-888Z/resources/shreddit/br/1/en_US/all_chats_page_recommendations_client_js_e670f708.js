import{r as e,dp as t}from"./shell-2264602c.js";import{$ as i,cl as a,cm as r}from"./age-gate-standalone-client-js-5357b0cf.js";import"./icon-82dd10b4.js";class s extends HTMLElement{constructor(){super(),this.childAnchor=null,this.chatUrl=null,this.mobilePermalink=null,this.handleAnchorClick=async e=>{if(!this.chatUrl)return;if(e.preventDefault(),this.mobilePermalink){const e=new URL(this.mobilePermalink,window.location.href).searchParams.get("r"),t=document.querySelector(`faceplate-modal[name="${r}"]`),i=t?.querySelector("a.app-link");if(i?.href){const t=new URL(i.href);e&&t.searchParams.set("r",e),t.searchParams.set("$android_deeplink_path",`reddit${this.mobilePermalink}`),t.searchParams.set("$deeplink_path",this.mobilePermalink),t.searchParams.set("$og_redirect",`${CLIENT_CONFIG.ORIGIN}${this.mobilePermalink}`),t.searchParams.set("base_url",this.mobilePermalink),i.setAttribute("href",t.toString())}return void this.dispatchEvent(new CustomEvent(r,{bubbles:!0}))}let t=document.querySelector("reddit-chat-host");t||(await this.activateFeature(),t=document.querySelector("reddit-chat-host")),t.openChatUrl(this.chatUrl)}}async activateFeature(){try{await e({name:t})}catch(e){if(!e.message?.endsWith(`${t} not found`))throw e}}connectedCallback(){const e=this.querySelector(":scope > a, :scope > li > a"),t=e?.href;this.mobilePermalink=this.getAttribute("permalink");((e,t=!1)=>!!e&&(e.startsWith(i)||e.startsWith(a)||t&&e.startsWith("/c/")))(t||this.mobilePermalink||void 0,!!this.mobilePermalink)&&(this.childAnchor=e,!t&&this.mobilePermalink?this.chatUrl=this.mobilePermalink:t&&t.startsWith(i)?this.chatUrl="/"+t.replace(i,""):t&&(this.chatUrl="/"+t.replace(a,"")),this.childAnchor?.addEventListener("click",this.handleAnchorClick))}disconnectedCallback(){this.childAnchor?.removeEventListener("click",this.handleAnchorClick)}}customElements.define("reddit-chat-anchor",s);
