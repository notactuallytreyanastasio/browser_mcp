import{cG as t,l as e,L as i,a as n,_ as o,g as r,n as s,J as a,e as d,A as u,t as l,K as c,cH as h,cI as p,cJ as b,cK as k,cL as y,w as g,x as f,b6 as v}from"./shell-2264602c.js";import{s as L,x as m,l as O}from"./icon-82dd10b4.js";import{as as I,t as U,at as x,au as S,o as A,L as C}from"./age-gate-standalone-client-js-5357b0cf.js";function $(t){t&&e.setItem(i.AdEvents,JSON.stringify(t))}function N(t){t&&e.setItem(i.AdUserTargeting,JSON.stringify(t))}function P(t){const n=e.getItem(i.AdEvents);if(null===n)return null;let o;try{o=JSON.parse(n)}catch{return null}return o.impressionId!==t?null:(e.removeItem(i.AdEvents),o)}function B(){const t=e.getItem(i.AdUserTargeting);if(null===t)return null;let n;try{n=JSON.parse(t)}catch{return null}return e.removeItem(i.AdUserTargeting),n}const E="noopener nofollow sponsored",J=n(L),K=()=>v(C);let M=class extends J{constructor(){super(...arguments),this.postOutboundLink="",this.impressionId="0",this.clickLocation=u.UNKNOWN,this.renderAsButton=!1,this.ButtonProps={},this.anchorStyleClass="",this.isOutboundLinkInitialized=!1}static get styles(){return[l,c("a {\n  color: inherit;\n  text-decoration: none;\n}\nbutton {\n  all: unset;\n  display: inline-block;\n  height: 100%;\n  width: 100%;\n  background: transparent;\n  cursor: pointer;\n}\n")]}get effectiveOutboundLink(){if(K()){const t=this.outboundLinkOverride??(this.outboundLinkUrl||"");return h(t)&&this.metadata?p(t,this.metadata):t}return this.postOutboundLink}get calculatedTabIndex(){return this.disableKeyboardNav?"-1":""===this.effectiveOutboundLink?"0":void 0}connectedCallback(){super.connectedCallback(),K()&&!this.outboundLinkOverride&&(this.outboundLinkUrl=this.getOutboundLinkUrlFromParent(),this.isOutboundLinkInitialized=!0)}updated(t){K()&&!this.outboundLinkOverride&&t.has("galleryIndex")&&(this.outboundLinkUrl=this.getOutboundLinkUrlFromParent())}getOutboundLinkUrlFromParent(){const t=I(this);if(!t)return;if(void 0===this.galleryIndex)return t.getAttribute("outbound-link-url");const e=t.getAttribute("gallery-items");let i;try{i=JSON.parse(e||"[]")}catch{i=[]}return i[this.galleryIndex]?.outboundUrl}fetchAndUpdateMetadata(){if(!h(this.effectiveOutboundLink))return;const t=I(this);if(!t)return;const e=t.getMetadataForPixelEvent(b.CLICK);e&&(K()?this.metadata=e:this.postOutboundLink=p(this.postOutboundLink,e))}handleClick(e){if(("auxclick"!==e.type||1===e.button)&&(K()&&(this.outboundLinkOverride||this.isOutboundLinkInitialized||(this.outboundLinkUrl=this.getOutboundLinkUrlFromParent(),this.isOutboundLinkInitialized=!0)),k(this.effectiveOutboundLink)&&"_blank"===this.target&&y(this.impressionId),this.fetchAndUpdateMetadata(),U({el:this,clickLocation:this.clickLocation,galleryIndex:this.galleryIndex}),x({el:this,clickLocation:this.clickLocation,outboundUrl:this.effectiveOutboundLink,galleryIndex:this.galleryIndex}),function(e){const i=t=>{try{return t()}catch{return null}};let n=i((()=>new URL(e)));return n||(n=i((()=>new URL(e,location.origin)))),!!n&&"1"===n.searchParams.get(t)}(this.effectiveOutboundLink))){const t=this.closest("shreddit-ad-post");if(!t)return;$({impressionId:this.impressionId,adEvents:t.adEvents,clickRedirectUrl:this.effectiveOutboundLink}),N(t.adUserTargeting)}}render(){const t=this.effectiveOutboundLink||void 0,e=m`<slot></slot>`;if(this.renderAsButton)return g({appearance:S()?"secondary":"bordered",children:e,size:f.Medium,attributes:{href:t,onclick:this.handleClick,oncontextmenu:this.handleClick,target:this.target,rel:E,className:this.anchorStyleClass},...this.ButtonProps});const i=this.effectiveOutboundLink||"_self"===this.target,n=A(this.anchorStyleClass,i?"cursor-pointer":"cursor-default");return m`<a class="${n}" href="${O(t)}" target="${O(this.target)}" tabindex="${O(this.calculatedTabIndex)}" @click="${this.handleClick}" @mouseover="${this.fetchAndUpdateMetadata}" @focus="${this.fetchAndUpdateMetadata}" @contextmenu="${this.handleClick}" @auxclick="${this.handleClick}" rel="${E}" role="${t?"link":"button"}" aria-label="${O(this.ariaLabel)}"> ${e} </a>`}};o([s({type:String,attribute:"post-outbound-link",reflect:!0})],M.prototype,"postOutboundLink",void 0),o([s({type:String,attribute:"outbound-link-override",reflect:!0})],M.prototype,"outboundLinkOverride",void 0),o([s({type:String,attribute:"impression-id"})],M.prototype,"impressionId",void 0),o([s({type:String,attribute:"click-location"})],M.prototype,"clickLocation",void 0),o([s({type:String,attribute:"post-id"})],M.prototype,"postId",void 0),o([s({type:Number,attribute:"gallery-index",reflect:!0})],M.prototype,"galleryIndex",void 0),o([s({type:String})],M.prototype,"target",void 0),o([s({type:Boolean,attribute:"disable-keyboard-nav"})],M.prototype,"disableKeyboardNav",void 0),o([s({type:Boolean,attribute:"render-as-button"})],M.prototype,"renderAsButton",void 0),o([s({type:Object,attribute:"button-props"})],M.prototype,"ButtonProps",void 0),o([s({type:String,attribute:"anchor-style-class"})],M.prototype,"anchorStyleClass",void 0),o([a("a")],M.prototype,"anchorEl",void 0),o([a("slot")],M.prototype,"slotEl",void 0),o([r()],M.prototype,"outboundLinkUrl",void 0),o([r()],M.prototype,"metadata",void 0),M=o([d("shreddit-dynamic-ad-link")],M);export{M as S,B as a,N as b,P as g,$ as s};
