import{_ as e,g as t,aU as r,hy as o,a7 as n,c9 as i,hz as a,m as l,J as s,e as d,M as u,hA as c,O as h}from"./shell-2264602c.js";import{x as p,l as m,a as g}from"./icon-82dd10b4.js";import{be as f,bd as y}from"./age-gate-standalone-client-js-5357b0cf.js";let b=class extends o{constructor(){super(...arguments),this._fullscreenBlurEl=document.createElement("div"),this._appliedBlurFilter=null,this._blurElement=null,this.shouldContentScroll=!1,this.isFooterEmpty=!0,this.render=()=>{const e=p`<slot name="closeButton" class="${n({floating:this.shouldContentScroll})}"></slot>`,t=p`<div id="header" class="${n({"with-icon":this._titleGraphic.length>0})}"> <slot name="titleGraphic"></slot> <slot name="title"></slot> </div>`,r=p`<slot name="primaryButton" @slotchange="${this.calcFooterChildren}"></slot> <slot name="secondaryButton" @slotchange="${this.calcFooterChildren}"></slot> <slot name="tertiaryButton" @slotchange="${this.calcFooterChildren}"></slot>`;return p` ${i(this.modal?"\n  <style>\n    :host {\n      top: 50%;\n      transform: translateY(-50%);\n      position: fixed;\n    }\n  </style>\n":"\n  <style>\n    :host {\n      position: absolute;\n    }\n  </style>\n")} <div id="wrapper" role="${m(this.open?"dialog":void 0)}" aria-label="${m(this.ariaLabel??void 0)}" aria-labelledby="${m(null!=this.ariaLabel?void 0:"header-container")}" aria-modal="${m(this.open&&this.modal?"true":void 0)}"> <div id="content"> ${e} <div id="header-container"> ${t} </div> <slot></slot> </div> <div id="footer" class="${n({"sticky-footer":this.shouldContentScroll,empty:this.isFooterEmpty})}"> ${r} <slot name="footer" @slotchange="${this.calcFooterChildren}"></slot> </div> </div> `}}static get styles(){return g`${o.styles}:host{--content-padding:var(--spacer-md);box-sizing:border-box;max-width:none;border-radius:var(--rem16);padding:0;overflow:hidden}#wrapper{display:flex;flex-direction:column;align-items:center;height:100%;position:relative;font-size:16px;box-sizing:border-box;max-height:inherit;min-height:inherit;overflow:hidden}slot[name=closeButton]{display:inline-flex;position:absolute;position:absolute;top:0;right:0;margin:var(--content-padding)}#header{display:flex;flex-direction:column;gap:var(--spacer-sm);align-items:center;text-align:left;width:100%;box-sizing:border-box}#header.with-icon{text-align:center;padding:0 var(--rem40)}slot[name=title]{font-size:var(--rem18);font-weight:700}slot:not([name]){display:flex;flex-grow:1;width:100%;padding:var(--spacer-xs) 0;font-size:var(--rem14)}#footer{display:flex;flex-direction:column;gap:var(--spacer-sm);width:100%;background:var(--color-ui-modalbackground);padding:var(--spacer-md);box-sizing:border-box}slot[name=tertiaryButton]{display:inline-flex;justify-content:center;font-size:14px}#footer.empty{display:none}@media (min-width:640px){#content{padding:var(--content-padding)}#header,#header.with-icon{flex-direction:row;padding:0 var(--spacer-2xl) 0 0}#footer{flex-direction:row-reverse;align-items:center;justify-content:end}slot[name=tertiaryButton]{margin-right:auto}slot[name=title]{text-align:left}}#content{height:100%;max-height:100%;width:100%;overflow:auto;position:relative;--content-padding:var(--spacer-md);padding:var(--content-padding);box-sizing:border-box;flex:1}.overflowing-content{max-height:100%;overflow-y:auto}.sticky-footer{box-shadow:var(--elevation-md)}slot[name=closeButton].floating{box-shadow:var(--elevation-sm);border-radius:999px}`}connectedCallback(){super.connectedCallback(),Object.assign(this._fullscreenBlurEl.style,{position:"fixed",top:"0",bottom:"0",right:"0",left:"0",backdropFilter:v(4)})}disconnectedCallback(){this._fullscreenBlurEl.remove(),a.remove(this),this.resizeObserver?.disconnect()}firstUpdated(){this.resizeObserver=new ResizeObserver((()=>{this.measureShouldContentScroll()})),this.resizeObserver.observe(this.content)}calcFooterChildren(){this.isFooterEmpty=!(this._footerSlot?.length||this._primaryButtonSlot?.length||this._secondaryButtonSlot?.length||this._tertiaryButtonSlot?.length)}measureShouldContentScroll(){this.shouldContentScroll=Boolean(this.content?.scrollHeight&&this.content?.scrollHeight>this.content.offsetHeight)}showModal(e){if(a.add(this),super.showModal(),null!=e?.blur){const o=!0===e.blur?4:Number(e.blur);this._appliedBlurFilter=v(o),e?.blurElement?(this._blurElement=e.blurElement,t=this._blurElement,r=this._appliedBlurFilter,t.style.filter=t.style.filter+" "+r):(Object.assign(this._fullscreenBlurEl.style,{backdropFilter:this._appliedBlurFilter}),document.body.append(this._fullscreenBlurEl))}var t,r}close(){this.open&&(super.close(),a.remove(this),null!=this._blurElement&&null!=this._appliedBlurFilter?(!function(e,t){const r=e.style.filter.split(" ").filter(Boolean).reverse(),o=r.indexOf(t);if(-1===o)return;r.splice(o,1),e.style.filter=r.reverse().join(" ")}(this._blurElement,this._appliedBlurFilter),this._appliedBlurFilter=null,this._blurElement=null):this._fullscreenBlurEl.remove())}};function v(e){return`blur(${e}px)`}e([t()],b.prototype,"shouldContentScroll",void 0),e([l({slot:"titleGraphic"})],b.prototype,"_titleGraphic",void 0),e([s("#content")],b.prototype,"content",void 0),e([s("#footer")],b.prototype,"footer",void 0),e([t()],b.prototype,"isFooterEmpty",void 0),e([r({slot:"footer",flatten:!0})],b.prototype,"_footerSlot",void 0),e([r({slot:"primaryButton",flatten:!0})],b.prototype,"_primaryButtonSlot",void 0),e([r({slot:"secondaryButton",flatten:!0})],b.prototype,"_secondaryButtonSlot",void 0),e([r({slot:"tertiaryButton",flatten:!0})],b.prototype,"_tertiaryButtonSlot",void 0),b=e([d("faceplate-modal")],b);function w(e){return e?.[0]?.message??"Something went wrong"}const B=e=>({error:e||"There was an error uploading the file."});async function x(e,t){const r=f.get(e.type);if(!r)throw new Error(`${e.type} files are not supported.`);try{const o=await async function(e){const t=await u({operation:h.CreateSubredditStructuredStylesUploadLease,variables:{input:e}});if(t.errors?.length)throw new Error(w(t.errors));const r=t.data.createSubredditStructuredStylesUploadLease;if(r?.ok&&r.uploadLease)return{uploadLeaseUrl:r.uploadLease.uploadLeaseUrl,uploadLeaseHeaders:r.uploadLease.uploadLeaseHeaders};throw new Error(w(r?.errors))}({...t,filepath:e.name,mimetype:r}),n=await y(e,o);return n?{url:n}:B()}catch(e){return o=e.message,window.Sentry?.captureMessage?.(`Media file upload failed with error: ${o}`),B(e.message)}var o}class S{async makeGQLRequest(...e){return u(...e)}async uploadMedia(...e){return x(...e)}async saveImage({subredditId:e,url:t,fileContent:r,uploadType:o,gqlOperation:n}){if(r)try{const n=await this.uploadMedia(r,{subredditId:e,imagetype:o});if(t=n.url?decodeURIComponent(n.url):t,n.error)return this.handleError(o)}catch(e){return this.handleError(o)}try{await this.makeGQLRequest({operation:n,variables:{input:{subredditId:e,[this.getOperationArg(o)]:t??""}}})}catch(e){return this.handleError(o)}return null}async saveCommunityIcon(e,t,r){return this.saveImage({subredditId:e,url:t,fileContent:r,uploadType:c.CommunityIcon,gqlOperation:h.UpdateSubredditIcon})}async saveBanner(e,t,r){return this.saveImage({subredditId:e,url:t,fileContent:r,uploadType:c.BannerBackgroundImage,gqlOperation:h.UpdateSubredditBanner})}async saveMobileBanner(e,t,r){return this.saveImage({subredditId:e,url:t,fileContent:r,uploadType:c.MobileBannerImage,gqlOperation:h.UpdateSubredditBanner})}handleError(e){switch(e){case c.BannerBackgroundImage:return"Something went wrong while saving the banner.";case c.MobileBannerImage:return"Something went wrong while saving the mobile banner.";case c.CommunityIcon:default:return"Something went wrong saving the avatar."}}getOperationArg(e){switch(e){case c.BannerBackgroundImage:return"bannerBackgroundImage";case c.MobileBannerImage:return"mobileBannerImage";case c.CommunityIcon:default:return"communityIcon"}}}export{S as C,b as F,x as u};
