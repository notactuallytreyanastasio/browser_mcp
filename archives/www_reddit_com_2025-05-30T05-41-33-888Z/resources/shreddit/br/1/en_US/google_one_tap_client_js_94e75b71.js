import{b as e,bb as t,b3 as s,_ as i,g as o,n as a,e as n,E as r,b4 as c,bc as l,aJ as p,bd as h,be as d}from"./shell-2264602c.js";import{A as m,r as u}from"./auth-flow-controller-ebc6bc41.js";import{G as g}from"./google-api-3da8618d.js";import{W as w}from"./with-recaptcha-32f8e610.js";import{p as y}from"./password-recovery-11761f51.js";import{O as f,H as C}from"./age-gate-standalone-client-js-5357b0cf.js";import{s as b}from"./icon-82dd10b4.js";import"./helpers-e162eb2b.js";const v=new Set(t.map((e=>s({source:f,action:C,noun:e})))),S=w(b);let R=class extends S{constructor(){super(...arguments),this.useCaptcha=!1,this.isEmailPermissionRequired=!1,this.hasCredentials=!1,this.googleApiController=new g(this,g.OneTapUX),this.authFlowController=new m(this),this.events=new r(this),this.showPrompt=async()=>{await this.googleApiController.initialize(),window.google?.accounts.id.prompt(this.momentListener)},this.onGoogleCredentialResponse=async e=>{let t;const{credential:s,select_by:i}=e;try{const o=g.parseCredentialResponse(e);this.captchaSiteKey&&this.useCaptcha&&(t=await this.getRecaptchaToken()),this.authFlowController.identityProviderSigin({authFlow:c.OneTap,email:o.email,idToken:s,isSignedInAutomatically:"auto"===i||"fedcm_auto"===i,provider:l.Google,recaptchaToken:t,emailPermissionRequired:this.isEmailPermissionRequired})}catch(e){window.Sentry?.captureException?.(e),this.authFlowController.trackSSOFailure({authFlow:c.OneTap,provider:l.Google,reason:"unknown"})}},this.momentListener=t=>{if(t.isDismissedMoment()){const s=t.getDismissedReason();"credential_returned"!==s&&console.error(`Google One Tap prompt was dismissed: ${s}`),p(this,function(t){return e({source:"onboarding",action:"dismiss",noun:"google_one_tap"},{action_info:{reason:t,success:"credential_returned"===t}})}(s))}},this.onFaceplateResponse=this.events.define("faceplate-response",(e=>{const{response:t}=e.detail,s=y(t.url)?.pathname;s===h.IdentityProviderSignin&&t.status!==d.MultipleAccountsFound&&t.status!==d.UserAccountCreated&&t.status!==d.UserLoggedIn&&this.dismiss()})),this.onFaceplateTrack=this.events.define("faceplate-track",(e=>{e.SAN&&v.has(e.SAN)&&this.dismiss()}))}connectedCallback(){super.connectedCallback(),this.showPrompt(),this.insertRecaptcha()}insertRecaptcha(){this.captchaSiteKey=this.getAttribute("site-key")??void 0,this.captchaSiteKey&&this.useCaptcha&&this.insertRecaptchaScript()}reloadThePage(){u()}dismiss(){this.parentNode?.removeChild(this)}};i([a({type:Boolean,attribute:"use-captcha"})],R.prototype,"useCaptcha",void 0),i([a({type:Boolean,attribute:"is-email-permission-required"})],R.prototype,"isEmailPermissionRequired",void 0),i([o()],R.prototype,"hasCredentials",void 0),R=i([n("auth-flow-google-one-tap-prompt")],R);
