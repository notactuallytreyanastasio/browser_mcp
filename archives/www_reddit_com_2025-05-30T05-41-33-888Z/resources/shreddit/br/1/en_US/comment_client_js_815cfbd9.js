import{gu as e,gm as t,w as i,x as s,t as o,_ as n,n as r,e as a,Q as d,a as l,g as h,K as c,a2 as m,E as p,c as u,gc as g,b3 as v,T as b,bp as y,i as f,Y as C,gv as T,gw as k,gx as x}from"./shell-2264602c.js";import{x as w,c as S,I as L,s as E,ch as M,aL as I}from"./icon-82dd10b4.js";import{o as P,a3 as $,bL as A,bM as R,bN as _,bO as O,bP as q,bQ as B,bR as N,bS as D,bT as j}from"./age-gate-standalone-client-js-5357b0cf.js";import"./shop-gallery-data-fetcher-client-js-73ca6a07.js";import"./comment-link-post-client-js-3910d5c4.js";import{A as H}from"./award-controller-c1fa775d.js";import{a as U,O as F}from"./postFlair-707ffbfa.js";import{C as z}from"./cbau-81b2f8bd.js";import"./utils-19e4b642.js";import"./awardsTelemetryState-e939bf46.js";function X(e,t){const{html:i}=e,s=function(e){const t={bg:"",border:""};if(e.isPdpSeekerM1LO)return t;if(e.isHighlighted)return{bg:"bg-orangered-500 bg-opacity-[0.07]",border:"border-0 border-l border-solid border-global-orangered"};if(V(e))return{bg:"bg-yellow-200 bg-opacity-[0.07]",border:"border-0 border-l border-solid border-global-gold"};return t}(e),o=`Thread for ${e.author}'s comment`,n=e.ariaLabel||o;return i` <details role="article" ?open="${!e.collapsed}" @toggle="${e.handleToggle}" aria-label="${n}" tabindex="${e.withHotkeys?0:-1}"> <summary class="${P("grid grid-cols-[24px_minmax(0,1fr)]",!e.isPdpSeekerM1LO&&"xs:grid-cols-[32px_minmax(0,1fr)]",W(e)?"mt-[1px]":"")}" @click="${e.handleSummaryClick}" aria-label="Metadata for ${e.author}'s comment"> ${e.collapsed?e.uncollapseButton:i`<div class="relative"> ${W(e)?i` <div class="absolute top-[2px] left-[16px] right-0 h-full ${s.bg} pointer-events-none"></div>`:""} <slot name="commentAvatar"></slot> </div>`} <div class="flex relative ${W(e)?`${s.bg} rounded-tr-[0.5rem] mt-[2px] mb-[-2px]`:""}"> <slot name="commentMeta" @click="${e.handleCommentMetaSlotClick}" id="comment-meta"></slot> </div> </summary> <div class="${P("grid grid-cols-[24px_1fr] relative",!e.isPdpSeekerM1LO&&"xs:grid-cols-[32px_1fr]")}"> ${function(e){if(!e.hasMoreLink&&!e.hasRenderedComments)return"";const t=e.isPdpSeekerM1LO?"xs:w-lg":"xs:w-xl";return e.html` <div class="absolute top-0 left-0 bottom-0 w-lg ${t} flex justify-center items-center z-0 cursor-pointer group mb-sm" @mouseenter="${e.onThreadLineMouseEnter}" @mouseleave="${e.onThreadLineMouseLeave}" @click="${e.handleToggle}" aria-hidden="true"> <div data-testid="main-thread-line" class="w-[1px] h-full group-hover:bg-tone-2 ${e.isThreadLineHovered?"bg-tone-2":"bg-tone-4"}"></div> </div> `}(e)} <div class="contents"> <div class="${W(e)?"relative pointer-events-none":""}"> ${W(e)?i`<div class="absolute h-full w-[11.5px] xs:w-[15.5px] right-0 ${s.bg} ${s.border}"></div>`:""} </div> <div class="min-w-0 ${W(e)?s.bg:""}"> <slot @click="${e.handleContentSlotClick}"></slot> <slot name="comment-edit"></slot> ${function(e){if(e.isCommentDeleted||e.isInEditMode)return"";return e.html` <div class="relative"> <slot name="comment"></slot> </div> `}(e)} </div> </div> <div class="contents"> ${function(e){return"at-fold"!==e.currentTreePosition&&e.hasRenderedComments}(e)?e.collapseButton:i`<div></div>`} <div class="min-w-0 ${W(e)?`rounded-br-[0.5rem] relative pr-sm pb-2xs mb-[1px] ${s.bg}`:""}"> ${W(e)?i` <div class="absolute top-0 left-[-12.5px] w-[11.5px] xs:left-[-16.5px] xs:w-[15.5px] h-full pointer-events-none ${s.bg} ${s.border}"></div> `:""} <slot name="actionRow"></slot> <slot name="awardsRow"></slot> </div> </div> <div class="contents"> <div></div> <div class="min-w-0"> <slot name="next-reply"></slot> </div> </div> <div id="comment-children" class="contents ${e.isThreadLineHovered?"[&>.threadline>*]:border-tone-2":"[&>.threadline>*]:border-tone-4"}"> ${function(e){const{html:t,currentTreePosition:i,hasMoreLink:s,hasRenderedComments:o}=e;if(!s&&!o)return t``;if("at-fold"!==i)return t``;return t` ${G(e,{isLastRenderedNode:!0,isComment:!1})} <slot name="more-comments-permalink"></slot> `}(e)} ${t} </div> </div> <ac-call trigger="init" delay="10000" target="closest(shreddit-comment)" method="maybeScheduleReloadPolling"></ac-call> </details> `}function V(e){return e.awardCount>0}function W(e){return!e.isPdpSeekerM1LO&&(e.isHighlighted||V(e))}function G(e,{isLastRenderedNode:t,isComment:i}){const s="box-border h-md border-0 border-tone-4 border-solid border-b-[1px] "+(t?"cursor-pointer":""),o=`${s} w-[calc(50%+0.5px)] border-l-[1px] rounded-bl-[12px]`,n=`${s} w-xs absolute right-[-8px]`;return e.html` <div class="threadline flex justify-end align-start relative${t?" bg-neutral-background":" pointer-events-none"}" aria-hidden="true"> <div @mouseenter="${t?e.onThreadLineMouseEnter:void 0}" @mouseleave="${t?e.onThreadLineMouseLeave:void 0}" @click="${t?e.handleToggle:void 0}" class="${o}" data-testid="branch-line"></div> ${i?"":e.html`<div @mouseenter="${t?e.onThreadLineMouseEnter:void 0}" @mouseleave="${t?e.onThreadLineMouseLeave:void 0}" @click="${t?e.handleToggle:void 0}" class="${n}"></div>`} </div> `}var Y;function Q(e){const t=e?.childNodes[0];t&&t?.nodeType===Node.COMMENT_NODE&&"ssr-marker"===t.nodeValue&&(e.innerHTML="")}!function(e){e.TEXT="text",e.IMAGE="image",e.GIPHY="giphy"}(Y||(Y={}));const K="rpl-dialog-trigger:trigger-clicked",J=[];function Z(e,t){const i=t.getBoundingClientRect();Object.assign(e.style,{position:"fixed",left:`${i.left}px`,height:`${i.height}px`})}function ee(e){Object.assign(e.style,{position:"",left:"",height:"",opacity:"",transform:""})}let te=class extends(e(t(E))){constructor(){super(...arguments),this.open=!1,this.dialogId="",this.triggerElement=null,this.entityDialogRootContainer=null,this.prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,this.shouldEnableNavPersistence=!1,this.handleAfterNavigation=()=>{this.open&&(window.removeEventListener("afterRoute",this.handleAfterNavigation),this.connectedCallback(),this.rightSidebar.classList.add("hidden"));const e=this.rightSidebar.classList.contains("hidden");!J.length&&e&&this.close(!1)},this.handleTriggerEvent=e=>{const t=e.detail;if(t.dialogId===this.dialogId&&!this.open&&!this.triggerElement)return this.triggerElement=t.triggerElement,this.show()}}connectedCallback(){super.connectedCallback(),document.addEventListener(K,this.handleTriggerEvent),this.rightSidebar=document.getElementById("right-sidebar-container"),this.entityDialogRootContainer=document.getElementById(U),this.rightSidebar?.parentElement||console.log("Missing right sidebar element. Please make sure right sidebar is rendered before trigger this overlay."),super.portalRoot=this.entityDialogRootContainer??document.body,this.prefersReducedMotion||(this.portalContainer.style.transition="opacity 120ms linear, transform 280ms cubic-bezier(0.54, 1.15, 1, 1)",this.rightSidebar.style.transition="opacity 80ms linear, transform 200ms cubic-bezier(0.54, 1.15, 1, 1)"),this.portalContainer.className="\n    rounded-[16px] w-[316px] min-w-[316px] xs:max-h-[calc(100vh-var(--shreddit-header-height)-32px)]\n    xs:sticky xs:top-[calc(var(--shreddit-header-height)+16px)] xs:overflow-hidden box-border\n    flex flex-col border border-solid border-neutral-border-weak shadow-neutral-border-weak shadow-[0px_1px_8px_0px] hidden xs:flex",this.shouldEnableNavPersistence&&window.addEventListener("afterRoute",this.handleAfterNavigation)}disconnectedCallback(){document.removeEventListener(K,this.handleTriggerEvent),super.disconnectedCallback(),this.shouldEnableNavPersistence&&!this.open&&window.removeEventListener("afterRoute",this.handleAfterNavigation)}closeAllOpenOverlays(){J.forEach((e=>e.close(!1)))}handleTransitionEnd(e){e?(this.rightSidebar.classList.add("hidden"),ee(this.portalContainer)):(this.removePortal(),ee(this.rightSidebar))}runAnimation(e){const t={opening:{portal:{start:{transform:"translateX(32px)",opacity:"0"},end:{transform:"translateX(0px)",opacity:"1"}},rightSidebar:{start:{transform:"translateX(0px)",opacity:"1"},end:{transform:"translateX(-16px)",opacity:"0"}}},closing:{portal:{start:{transform:"translateX(0px)",opacity:"1"},end:{transform:"translateX(32px)",opacity:"0"}},rightSidebar:{start:{transform:"translateX(-16px)",opacity:"0"},end:{transform:"translateX(0px)",opacity:"1"}}}},i=e?t.opening:t.closing;Object.assign(this.portalContainer.style,i.portal.start),Object.assign(this.rightSidebar.style,i.rightSidebar.start),requestAnimationFrame((()=>{Object.assign(this.portalContainer.style,i.portal.end),Object.assign(this.rightSidebar.style,i.rightSidebar.end)})),this.portalContainer.addEventListener("transitionend",(()=>this.handleTransitionEnd(e)),{once:!0})}show(){this.open=!0,this.triggerElement?.addOpenAttributes();const e=J.length>0;this.closeAllOpenOverlays(),J.push(this),Z(this.portalContainer,this.rightSidebar),this.appendTemplateContentTo(this.portalContainer,{cache:!0}),this.attachPortal();this.prefersReducedMotion||e?this.handleTransitionEnd(!0):this.runAnimation(!0)}close(e=!0){this.open=!1,J.splice(J.indexOf(this),1),Z(this.rightSidebar,this.portalContainer),this.rightSidebar.classList.remove("hidden");this.prefersReducedMotion||!e?this.handleTransitionEnd(!1):this.runAnimation(!1),this.triggerElement&&(this.triggerElement.removeOpenAttributes(),this.triggerElement=null)}render(){return w` <div class="sticky top-0 bg-neutral-background z-10"> <div class="flex justify-between items-center"> <div class="flex justify-between py-md pl-md pr-0 items-center"> <slot name="header" class="font-semibold text-18 text-neutral-content-strong"></slot> </div> ${i({appearance:"secondary",attributes:{type:"button",onclick:()=>this.close(),className:"shrink-0 mx-sm mr-sm ml-xs"},size:s.Small,leadingIcon:S({size:L.Small})})} </div> <hr class="border-neutral-border-weak border-0 border-t mx-md my-0"> </div> <slot></slot> `}};te.styles=[o],n([r({type:Boolean,reflect:!0})],te.prototype,"open",void 0),n([r({type:String,reflect:!0,attribute:"dialog-id"})],te.prototype,"dialogId",void 0),n([r({type:Boolean,attribute:"should-enable-nav-persistence"})],te.prototype,"shouldEnableNavPersistence",void 0),te=n([a("shreddit-right-rail-overlay")],te),import("./shreddit-mod-comment-92f8cac6.js"),import("./shreddit-comment-action-row-5e0d7e09.js"),import("./shreddit-overflow-menu-edf5bded.js");const ie=["post_detail/click/collapse_comment","post_detail/click/expand_comment","post_detail/click/reply_comment","post_detail/click/upvote_comment","post_detail/click/downvote_comment","post_detail/click/comment_image","comment/click/load_more_comments","comment/consume/comment","comment/consume/collapsed_comment","comment/view/comment","comment/view/collapsed_comment","comment/click/report","comment/click/ignore_reports","comment/click/restore_reports"],se=["FACEPLATE-IMG","SHREDDIT-PLAYER-2","IMG"],oe='div[slot="comment"]',ne="shreddit-comment-action-row",re="none",ae="text-neutral-content-strong bg-neutral-background overflow-visible",de=d(l(E));let le=class extends de{getProps(){return{ariaLabel:this.ariaLabel,author:this.author,awardCount:this.awardCount,collapsed:this.collapsed,currentTreePosition:this.currentTreePosition,collapseButton:this.renderCollapseButton(),handleCommentMetaSlotClick:this.handleCommentMetaSlotClick,handleContentSlotClick:this.handleContentSlotClick,handleSummaryClick:this.handleSummaryClick,handleToggle:this.handleToggle,hasMoreLink:this.hasMoreLink,hasRenderedComments:this.hasRenderedComments,html:w,isCommentDeleted:this.isCommentDeleted,isHighlighted:this.isHighlighted,isInEditMode:this.isInEditMode,isPdpSeekerM1LO:this.isPdpSeekerM1LO,isThreadLineHovered:this.isThreadLineHovered,onThreadLineMouseEnter:this.onThreadLineMouseEnter,onThreadLineMouseLeave:this.onThreadLineMouseLeave,thingId:this.thingId,uncollapseButton:this.renderUncollapseButton(),withHotkeys:this.withHotkeys}}static get styles(){return[o,c(":host {\n  display: block;\n}\n:host([is-chosen-mq-comment]) slot[name='comment']::slotted(*) {\n  background-color: var(--color-neutral-background-selected);\n  padding-block: 8px;\n  margin-bottom: 4px;\n}\ndetails {\n  position: relative;\n}\ndetails > summary {\n  list-style: none;\n  padding-bottom: 2px;\n}\ndetails > summary:focus {\n  outline: none;\n}\ndetails > summary::-webkit-details-marker {\n  display: none;\n}\n.summary-flex {\n  display: flex;\n  margin-right: 0;\n  flex-direction: row;\n  align-items: center;\n}\nsummary > *,\n.summary-flex > * {\n  white-space: nowrap;\n}\nsummary > *,\n.summary-flex > * {\n  white-space: nowrap;\n}\n.contents {\n  padding-left: 1.75rem;\n  line-height: 1.0625rem;\n}\n:host([updateAnimation~='light']) {\n  animation: realtimeFade 3s;\n  animation-timing-function: ease-out;\n}\n:host([updateAnimation~='dark']) {\n  animation: realtimeFadeNight 3s;\n  animation-timing-function: ease-out;\n}\n@keyframes realtimeFade {\n  from {\n    background-color: #fff2bd;\n    border: 1px solid #dbaf00;\n  }\n  to {\n    background-color: #f0f5f9;\n    border: 1px solid transparent;\n  }\n}\n@keyframes realtimeFadeNight {\n  from {\n    background-color: #665505;\n    border: 1px solid #382d03;\n  }\n  to {\n    background-color: #030303;\n    border: 1px solid #343536;\n  }\n}\n")]}constructor(){super(),this.thingId="",this.avatar="",this.author="",this.parentId="",this.postId="",this.score="",this.awardCount=0,this.isAuthorDeleted=!1,this.isCommentDeleted=!1,this.isInEditMode=!1,this.depth=0,this.permalink="",this.isUserOP=!1,this.isHighlighted=!1,this.reloadUrl="",this.isCurrentPermalink=!1,this.contentType=Y.TEXT,this.isTranslatable=!1,this.isTranslationFetched=!1,this.isCommentTranslated=!1,this.previousActionsFeature=!1,this.collapsed=!1,this.isChosenMqComment=!1,this.updateAnimation=void 0,this.ariaLabel=null,this.isPdpSeekerM1=!1,this.isPdpSeekerM1LO=!1,this.withHotkeys=!1,this.updateState=void 0,this.observer=null,this.targetElement=null,this.consumeTimeoutId=void 0,this._outboundLinkTrackingController=new F(this,(()=>({pageType:m(),postId:this.postId,commentId:this.thingId}))),this._events=new p(this),this._awardController=new H(this,{getThingId:()=>this.thingId,onAward:()=>this.awardCount++}),this.currentTreePosition=null,this.onHotkeysFocus=e=>{this.shadowRoot?.querySelector("details")?.focus(e)},this.handleObserverIntersection=e=>{e.forEach((e=>{if(e.isIntersecting){const e={comment_id:this.thingId,comment_parent_id:this.parentId,comment_depth:this.depth};this.entityFilterId&&(e.entity_filter_id=this.entityFilterId),this.dispatchEvent(u("comments-viewed-event",{detail:e})),this.consumeTimeoutId=setTimeout((()=>{this.dispatchEvent(u("comments-consumed-event",{detail:e}))}),$)}else clearTimeout(this.consumeTimeoutId)}))},this.handleCommentEvents=e=>{const t=e.detail.details||e.detail;var i;(i=t,ie.includes(v(i)))&&(t.comment?.id||(t.comment={...t.comment,id:this.thingId,parent_id:this.parentId,post_id:this.postId,score:parseInt(this.score,10)||void 0,type:"comment",created_timestamp:g(this.created),content_type:this.contentType===Y.TEXT?void 0:this.contentType},"comment/click/report"===v(t)&&(t.thingId=this.thingId)))},this.handleSummaryClick=e=>{e.fromCommentMeta&&"A"!==e.target.tagName&&!e.target.closest("a")&&e.preventDefault()},this.handleCommentMetaSlotClick=e=>{e.fromCommentMeta="commentMeta"!==e.target.slot},this.handleMoreButtonClick=e=>{this.publish(b.TriggerCommentBlockingAuth,{source:z.Button});const t=u("track-event",{details:A()});this.dispatchEvent(t);const i=e.currentTarget;i?.addEventListener("faceplate-response",(()=>{const e=new MutationObserver((t=>{t.some((e=>Array.from(e.removedNodes).some((e=>e===i))))&&(this.updateChildren(),e.disconnect())}));e.observe(this,{childList:!0})}))},this.handleContentSlotClick=e=>{if(e.target&&this.contentType!==Y.TEXT){const t=e.target.tagName;se.includes(t)&&this.trackEvent(R())}},this.handleReload=e=>{e.stopPropagation(),this.reload()},this.handleCommentCreated=({parentThingId:e,body:t})=>{if(e!==this.thingId)return;if(!t)return;const[i]=y(t);"shreddit-comment"===i.tagName.toLowerCase()&&(i.setAttribute("slot","children"),i.setAttribute("depth",(this.depth+1).toString()),i.removeAttribute("class"),this.append(i),this.updateChildren())},this.convertCommentToDeleted=({commentId:e})=>{this.thingId===e&&(this.hideCommentActionRow(),this.hideOpIcon(),this.replaceCommentAuthorWithDeletedText(),this.hideCommentContent())},this.hideOpIcon=()=>{const e=this.querySelector('div[slot="commentMeta"] > span > .comment-op-icon-js');e&&(e.style.display=re)},this.hideCommentActionRow=()=>{const e=this.querySelector(ne);e&&(e.style.display=re)},this.replaceCommentAuthorWithDeletedText=()=>{const e=this.querySelector('div[slot="commentMeta"] .author-name-meta');e&&e.replaceWith(this.getDeletedAuthorHTML())},this.hideCommentContent=()=>{const e=this.querySelector(oe);e&&(e.style.display=re)},this.hasRenderedComments=!1,this.hasMoreLink=!1,this._children=null,this.unsubscribeFaceplateRequestListeners=[],this.isThreadLineHovered=!1,this.onThreadLineMouseEnter=()=>{this.isThreadLineHovered=!0,this.requestUpdate()},this.onThreadLineMouseLeave=()=>{this.isThreadLineHovered=!1,this.requestUpdate()},this.addEventListener("faceplate-track",this.handleCommentEvents),this.addEventListener("track-event",this.handleCommentEvents),this.addEventListener("reload-shreddit-comment",this.handleReload),this._events.define("click",(e=>{const t=e.composedPath().find((e=>e.hasAttribute?.("data-more-comments-partial-id")));t&&t.querySelectorAll("icon-load").forEach((e=>e.classList.add("animate-spin")))}))}get hasAwardedTreatment(){return this.awardCount>0}get isCommentHighlighted(){return this.isHighlighted||this.hasAwardedTreatment}getReplyPermalink(){const e=new URL(location.origin+this.permalink);return e.searchParams.set("reply",this.thingId),e.href.substring(e.origin.length)}setVisibility(e=Number.POSITIVE_INFINITY,t){const i=this.querySelector("shreddit-comment[is-chosen-mq-comment]")||this.closest("shreddit-comment[is-chosen-mq-comment]"),s=e-(this.depth+1);this.querySelector(ne)?.setAttribute("reply-permalink",0===s?this.getReplyPermalink():"");const o=!!i&&"number"==typeof t&&this.depth>=e&&this.depth<=t,n=this.currentTreePosition;this.currentTreePosition=i&&"number"==typeof t?!o&&this.depth<t?"hidden-above-fold":this.depth<e-1?"above-fold":this.depth===e-1?"at-fold":"below-fold":s>0?"above-fold":0===s?"at-fold":"below-fold",null!==n&&n===this.currentTreePosition||(this.style.display="below-fold"===this.currentTreePosition?"none":"",this.ariaHidden="below-fold"===this.currentTreePosition?"true":"false",this.updateChildren())}async setInitialVisibility(){customElements.get("shreddit-comment-tree")||await window.customElements.whenDefined("shreddit-comment-tree");const e=this.closest("shreddit-comment-tree");let t=e?.visibilityDetails;null===t&&e?.depthUpdated&&(t=await e.depthUpdated),this.setVisibility(t?.maxVisibleDepth,t?.minVisibleDepth)}connectedCallback(){Q(this.shadowRoot),super.connectedCallback(),this.initObserver(),this.setInitialVisibility(),this.isUserOP&&this.subscribe(b.CommentDeleted,this.convertCommentToDeleted),this.subscribe(b.CommentCreated,this.handleCommentCreated),this.addEventListener(_,this.resetToReadMode),this.addEventListener(O,this.resetToReadMode),this.addEventListener("comment-animation-trigger",this.handleTriggerAnimation)}firstUpdated(){this.querySelector(oe)?.addEventListener("click",this.handleContentSlotClick),this.isChosenMqComment&&this.updateComplete.then((()=>{setTimeout((()=>{const e=document.getElementById("mod-queue-pdp-panel");if(!e)return;const t=this.getBoundingClientRect().top-48-window.innerHeight/2,i=document.getElementsByTagName("shreddit-comment-tree")[0]||this;e?.scrollTop>i?.getBoundingClientRect().top||e.scrollTo({top:t,behavior:"auto"})}),200)}))}disconnectedCallback(){super.disconnectedCallback(),this.disconnectObserver(),this.clearConsumeTimeout(),this.isUserOP&&this.unsubscribe(b.CommentDeleted,this.convertCommentToDeleted),this.unsubscribe(b.CommentCreated,this.handleCommentCreated),this.removeEventListener(_,this.resetToReadMode),this.removeEventListener(O,this.resetToReadMode),this.removeEventListener("comment-animation-trigger",this.handleTriggerAnimation)}get shareButton(){return this.querySelector("[slot=actionRow]")?.querySelector("shreddit-comment-share-button")}get overlowMenuItemProps(){return this.querySelector("shreddit-overflow-menu")?.getMenuItemProps()}handleTriggerAnimation(e){this.updateState=e.detail,this.triggerRealtimeUpdateAnimation()}triggerRealtimeUpdateAnimation(){const e=f();this.updateAnimation=e?"dark":"light",this.updateState=void 0,setTimeout((()=>{this.updateAnimation=void 0}),3e3)}clearConsumeTimeout(){this.consumeTimeoutId&&(clearTimeout(this.consumeTimeoutId),this.consumeTimeoutId=void 0)}maybeScheduleReloadPolling(){this.reloadPollingIntervalMs&&this.reloadPollingDurationMs&&this.reloadPollingDurationMs>0&&this.reload()}async reload({richTextMedia:e,includeTranslation:t}={}){if(!this.reloadUrl||!this.parentNode)return;const i=new URL(location.origin+this.reloadUrl);e&&i.searchParams.set("richTextMedia",e),t&&i.searchParams.set("includeTranslation","true"),this.reloadPollingDurationMs&&this.reloadPollingIntervalMs&&i.searchParams.set(q,(this.reloadPollingDurationMs-(this.reloadPollingIntervalMs+100)).toString()),this.slot&&i.searchParams.set("slot",this.slot);const s=this.parentNode,o=document.createElement("faceplate-partial");o.setAttribute("loading",C.Programmatic),o.setAttribute("src",i.href.substring(i.origin.length)),o.setAttribute("slot","children");const n=this.slot;o.slot=n,s.insertBefore(o,this),this.slot="";const r=this.querySelector('[slot="actionRow"]'),a=r?.querySelector("shreddit-comment-action-row"),d=a?.isCommentComposerActive??!1;o.appendChild(this);const l=this.querySelectorAll(":scope > [slot^=children]");T(o),await o.load();const h=s.querySelector(`shreddit-comment[thingid=${this.thingId}]`);if(!0===d&&null!=r){const e=h?.querySelector('[slot="actionRow"]');e?.replaceWith(r)}if(l.length>0){for(const e of l)h?.appendChild(e);h&&(h.slot=n,h.updateChildren())}}initObserver(){this.targetElement=this.querySelector('div[slot="comment"]'),this.targetElement&&(this.observer=new IntersectionObserver(this.handleObserverIntersection,{root:null,threshold:.5}),this.observer.observe(this.targetElement))}addTranslationToggledObserver(e){this.targetElement=this.querySelector(e),this.targetElement&&this.observer&&this.observer.observe(this.targetElement)}disconnectObserver(){this.observer&&(this.clearConsumeTimeout(),this.observer.disconnect())}handleToggle(e){!e.target.open!==this.collapsed&&this.handleCollapse()}handleCollapse(){this.collapsed=!this.collapsed,this.trackEvent(this.collapsed?B():N())}iconIsSnoovatar(){return!!this.avatar&&(this.avatar.indexOf("profileIcon_snoo")>-1||this.avatar.endsWith("snoovatar_anonymous.svg"))}resetToReadMode(){this.removeAttribute("edit-mode"),this.querySelector("shreddit-comment-action-row")?.classList.remove("hidden");let e=`${D}?commentId=${this.thingId}`;this.isCommentTranslated&&(e=k(e,"isTranslated","true"));const t=x("faceplate-partial",{id:`comment-${this.thingId}-edit-partial`,src:e,loading:C.Programmatic}),i=x("faceplate-shimmer",{class:"h-[100px] w-full hidden",shape:"pill"});t.appendChild(i),this.querySelector(`[slot="comment-${this.thingId}-edit"]`)?.replaceWith(t)}renderCollapseButton(){const e=P("flex justify-center self-start py-[2px] bg-neutral-background relative",this.isPdpSeekerM1?"mt-[2px]":"mt-[6px]");return w` <div class="${e}"> ${i({appearance:"plain",attributes:{onclick:this.handleCollapse,className:P(ae,this.isCommentHighlighted?"!w-md h-md relative z-1":"w-md h-md"),"aria-expanded":this.collapsed?"false":"true","aria-label":"Toggle Comment Thread","aria-controls":"comment-children"},leadingIcon:this.collapsed?M({size:L.Small}):I({size:L.Small}),size:s.Small})} </div> `}renderUncollapseButton(){return w` <div class="flex justify-center"> ${i({appearance:"plain",attributes:{onclick:this.handleCollapse,className:P(ae,"w-lg xs:w-xl h-xl xs:h-[40px]")},leadingIcon:M({size:L.Small}),size:s.Small})} </div> `}getDeletedAuthorHTML(){const e=document.createElement("div");e.classList.add("flex","flex-row","items-center","overflow-hidden");const t=document.createElement("faceplate-tracker");t.setAttribute("source","post_detail"),t.setAttribute("action","click"),t.setAttribute("noun","comment_deleted_author"),t.classList.add("contents");const i=document.createElement("span");return i.classList.add("truncate","font-bold","hover:no-underline"),i.classList.add("text-neutral-content-strong","text-12"),i.innerText=j(),t.appendChild(i),e.appendChild(t),e}renderCommentBody(){return this.isCommentDeleted||this.isInEditMode?"":w` <div class="relative"> <slot name="comment"></slot> </div> `}renderChildren(e,{forceUpdate:t}={}){if(this._children&&!t)return"above-fold"===this.currentTreePosition||"hidden-above-fold"===this.currentTreePosition?this._children:[];const i=Array.from(this.querySelectorAll(':scope > [slot^="children"]'));if(this.hasRenderedComments=i.some((e=>"shreddit-comment"===e.tagName.toLowerCase())),this.hasMoreLink=i.some((e=>"shreddit-comment"!==e.tagName.toLowerCase())),"above-fold"!==this.currentTreePosition&&"hidden-above-fold"!==this.currentTreePosition)return[];this.unsubscribeFaceplateRequestListeners.forEach((e=>e())),this.unsubscribeFaceplateRequestListeners=[];const s=[];this._children=[];for(let e=0;e<i.length;e++){const t=i[e],o="shreddit-comment"===t.tagName.toLowerCase(),n="faceplate-partial"===t.tagName.toLowerCase();s.push(o);const r=`children-${this.thingId}-${e}`;t.slot=r,n&&(t.addEventListener("faceplate-request",this.handleMoreButtonClick),this.unsubscribeFaceplateRequestListeners.push((()=>{t.removeEventListener("faceplate-request",this.handleMoreButtonClick)})))}return this._children=function(e,t){const{html:i,currentTreePosition:s}=e;if("above-fold"!==s&&"hidden-above-fold"!==s)return[];const o=[];for(let s=0;s<t.length;s++){const n=s===t.length-1,r=t[s],a=`children-${e.thingId}-${s}`;o.push(G(e,{isLastRenderedNode:n,isComment:r})),o.push(i`<slot name="${a}"></slot>`)}return o}(e,s),this._children}updateChildren(){this.renderChildren(this.getProps(),{forceUpdate:!0}),this.requestUpdate()}render(){const e=this.renderChildren(this.getProps());return"hidden-above-fold"===this.currentTreePosition?e:X(this.getProps(),e)}};n([r({type:String})],le.prototype,"thingId",void 0),n([r({type:String})],le.prototype,"avatar",void 0),n([r({type:String})],le.prototype,"author",void 0),n([r({type:String})],le.prototype,"created",void 0),n([r({type:String})],le.prototype,"parentId",void 0),n([r({type:String})],le.prototype,"postId",void 0),n([r({type:String})],le.prototype,"score",void 0),n([r({type:Number,attribute:"award-count",reflect:!0})],le.prototype,"awardCount",void 0),n([r({type:Boolean,attribute:"is-author-deleted"})],le.prototype,"isAuthorDeleted",void 0),n([r({type:Boolean,attribute:"is-comment-deleted"})],le.prototype,"isCommentDeleted",void 0),n([r({type:Boolean,attribute:"edit-mode"})],le.prototype,"isInEditMode",void 0),n([r({type:Number})],le.prototype,"depth",void 0),n([r({type:String})],le.prototype,"permalink",void 0),n([r({type:Boolean,attribute:"is-user-op"})],le.prototype,"isUserOP",void 0),n([r({type:Boolean,attribute:"is-highlighted"})],le.prototype,"isHighlighted",void 0),n([r({type:String,attribute:"reload-url"})],le.prototype,"reloadUrl",void 0),n([r({type:Boolean,attribute:"is-current-permalink"})],le.prototype,"isCurrentPermalink",void 0),n([r({type:String,attribute:"content-type"})],le.prototype,"contentType",void 0),n([r({type:Boolean,attribute:"is-translatable"})],le.prototype,"isTranslatable",void 0),n([r({type:Boolean,attribute:"is-translation-fetched"})],le.prototype,"isTranslationFetched",void 0),n([r({type:Boolean,attribute:"is-comment-translated",reflect:!0})],le.prototype,"isCommentTranslated",void 0),n([r({type:String,attribute:"moderation-verdict"})],le.prototype,"moderationVerdict",void 0),n([r({type:Boolean,attribute:"previous-actions-feature"})],le.prototype,"previousActionsFeature",void 0),n([r({type:Number,attribute:"reload-polling-interval-ms"})],le.prototype,"reloadPollingIntervalMs",void 0),n([r({type:Number,attribute:"reload-polling-duration-ms"})],le.prototype,"reloadPollingDurationMs",void 0),n([r({type:Boolean,reflect:!0})],le.prototype,"collapsed",void 0),n([r({type:Boolean,attribute:"is-chosen-mq-comment"})],le.prototype,"isChosenMqComment",void 0),n([r({type:String,reflect:!0})],le.prototype,"updateAnimation",void 0),n([r({type:String})],le.prototype,"ariaLabel",void 0),n([r({type:String,attribute:"entity-filter-id",reflect:!0})],le.prototype,"entityFilterId",void 0),n([r({type:Boolean,attribute:"is-pdp-seeker-m1"})],le.prototype,"isPdpSeekerM1",void 0),n([r({type:Boolean,attribute:"is-pdp-seeker-m1-lo"})],le.prototype,"isPdpSeekerM1LO",void 0),n([r({type:Boolean,attribute:"with-hotkeys"})],le.prototype,"withHotkeys",void 0),n([h()],le.prototype,"updateState",void 0),le=n([a("shreddit-comment")],le);export{le as S,Q as c};
