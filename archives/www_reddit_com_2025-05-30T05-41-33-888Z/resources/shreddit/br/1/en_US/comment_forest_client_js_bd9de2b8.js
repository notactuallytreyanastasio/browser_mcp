import{a as t,_ as e,n as s,e as i,p as n,T as o,t as r,K as a,W as l,Q as c,bp as d,w as h,x as m,P as p,aQ as u,fF as b,fG as g,fH as C,bn as v,dI as y,fI as f,c as S,fJ as T,bN as k,J as x,ae as w,g as I,bM as A,h as E,I as P,a7 as j,fw as $,aF as M,fK as B,aj as D,aJ as O,b as L,H as F,fL as q,ay as V,az as _,ew as U,aA as R}from"./shell-2264602c.js";import{s as N,x as z,N as H,I as W,a as Q,A as K,Q as J,a5 as G,bt as Y,bU as X}from"./icon-82dd10b4.js";import{k as Z,e as tt}from"./links-9b598b77.js";import{c as et}from"./comment-client-js-815cfbd9.js";import{N as st,bw as it}from"./age-gate-standalone-client-js-5357b0cf.js";import{C as nt}from"./cbau-81b2f8bd.js";import"./shreddit-spoiler-3fa9e37d.js";import"./mod-queue-pdp-client-js-afe8c9d1.js";import"./author-flair-event-handler-87ee687a.js";import{B as ot}from"./base-translator-57da136d.js";import"./translation-feedback-modal-client-js-1348daab.js";import"./translation-intervention-modal-337135d6.js";import"./shreddit-comment-badges-e5d47862.js";import{P as rt}from"./postFlair-707ffbfa.js";import{R as at}from"./pdp-comment-search-close-f3698661.js";import{b as lt,S as ct}from"./search-params-9b432517.js";import{S as dt,a as ht,b as mt}from"./search-dynamic-id-fd96acc2.js";import"./reddit-feed-677ff449.js";import"./faceplate-search-input-ad8da225.js";import"./faceplate-tooltip-842394bc.js";import"./adjust-search-query-link-33365b7b.js";import"./suggested-search-queries-client-js-e9a5ef2a.js";import"./translation-contribution-toggle-62c89711.js";import"./shreddit-sort-dropdown-ef971160.js";import"./qr-code-modal-upsell-client-js-7b7451da.js";import"./hui-user-drawer-client-js-c899bcbc.js";import"./rpl-filter-chip-3cdf7455.js";import"./ad-reminder-button-e85252e5.js";import{g as pt}from"./password-recovery-11761f51.js";import"./shop-gallery-data-fetcher-client-js-73ca6a07.js";import"./utils-19e4b642.js";import"./comment-link-post-client-js-3910d5c4.js";import"./award-controller-c1fa775d.js";import"./awardsTelemetryState-e939bf46.js";import"./chat-mobile-xpromo-client-js-c803f3b0.js";import"./faceplate-textarea-input-97dc2a34.js";import"./text-input-7536667a.js";import"./filterNullish-60f7e90f.js";import"./constants-d65b7b38.js";import"./translations-8a80e526.js";import"./app-selector-client-js-3a92da0e.js";import"./TinyGesture-89d9957c.js";import"./distinguished-tags-ad178980.js";import"./comment-8177f9ce.js";import"./validate-image-b0892d29.js";import"./user-flair-afad799f.js";import"./index-911356a8.js";import"./helpers-8770159c.js";import"./select-controller-e11d5e4c.js";import"./community-picker-9f84d972.js";import"./expandable-section-header-edd4c2b3.js";import"./overflow-menu-actions-97fa1cfc.js";const ut=t(N);let bt=window.location,gt=class extends ut{constructor(){super(...arguments),this.commentId="",this.parentCommentPermalink="",this.postPermalink="",this.isInModQueue=!1,this.onLinkClick=(t,e)=>{this.isInModQueue&&(t.stopPropagation(),t.preventDefault(),n?.(o.ModQueuePdpLinkClick,{isFullDiscussionLink:e,parentCommentPermalink:this.parentCommentPermalink,postPermalink:this.postPermalink}))}}static get styles(){return[r,a(".single-comment-thread-toolbar {\n  align-items: center;\n  display: flex;\n  flex-flow: row nowrap;\n  font: var(--font-title-h6);\n  justify-content: space-between;\n  padding: 0.5rem 1rem;\n}\n")]}firstUpdated(){this.updateComplete.then((()=>{if(this.isInModQueue)return;if("1"===new URLSearchParams(bt.search).get("draft"))return;const t=this.getBoundingClientRect().top;window.scrollTo({top:t-48,behavior:"auto"})}))}handleSeeFullDiscussionLink(t){this.onLinkClick(t,!0);const e=document.querySelector("shreddit-post");e&&this.trackEvent(Z(e))}render(){if(!this.commentId)return;const t=this.isInModQueue?"View parent comment":"Single comment thread",e="no-underline hover:no-underline visited:no-underline text-primary";return z` <div> <div class="single-comment-thread-toolbar text-neutral-content-weak"> ${this.parentCommentPermalink?z` <a href="${this.parentCommentPermalink}" class="${e}" @click="${this.onLinkClick}"> ${t} </a> `:z` <span>${t}</span> `} <span class="flex-1 h-px mx-xs bg-tone-4" data-id="line"></span> <a href="${this.postPermalink}" class="${e}" @click="${this.handleSeeFullDiscussionLink}"> See full discussion </a> </div> </div> `}};e([s({type:String,attribute:"comment-id"})],gt.prototype,"commentId",void 0),e([s({type:String,attribute:"parent-comment-permalink"})],gt.prototype,"parentCommentPermalink",void 0),e([s({type:String,attribute:"post-permalink"})],gt.prototype,"postPermalink",void 0),e([s({type:Boolean,attribute:"is-in-modqueue"})],gt.prototype,"isInModQueue",void 0),gt=e([i("shreddit-comments-page-tools")],gt);const Ct=l(N);let vt=class extends Ct{constructor(){super(...arguments),this.isVisible=!1}connectedCallback(){super.connectedCallback(),this.enableObserver({threshold:1})}disconnectedCallback(){super.disconnectedCallback(),this.disableObserver()}publishEvent(){n(o.TriggerCommentBlockingAuth,{source:nt.Scroll})}publishCloseEvent(){n(o.TriggerCommentBlockingAuth,{source:nt.Close})}observerIsIntersectingCallback(){this.publishEvent(),this.isVisible=!0}observerIsNotIntersectingCallback(t){const{boundingClientRect:e,rootBounds:s}=t;s&&this.isVisible&&e.top>s.bottom&&(this.isVisible=!1,this.publishCloseEvent())}render(){return z`<div></div> `}};vt=e([i("cbau-trigger")],vt);const yt=t(c(N));let ft=class extends yt{constructor(){super(...arguments),this.postId="",this.isTruncated=!1,this.ui="mobile",this._visibilityDetails=null,this.depthUpdated=null,this.handleCommentCreated=({parentThingId:t,body:e})=>{this.postId===t&&e&&this.querySelector("#next-comment")?.after(...d(e))}}static get styles(){return[r,a(":host {\n  display: block;\n  background-color: var(--shreddit-content-background);\n  padding-bottom: var(--spacer-xs);\n}\n")]}get visibilityDetails(){return null===this._visibilityDetails&&null===this.depthUpdated&&(this.depthUpdated=new Promise((t=>{requestAnimationFrame((()=>{const e=this.getVisibilityDetails();this._visibilityDetails=e,t(e)}))}))),this._visibilityDetails}getVisibilityDetails({containerWidth:t}={}){const e=this.querySelector(":scope > shreddit-comment"),s=e?.depth??0;t??(t=this.getBoundingClientRect().width);const i="mobile"===this.ui?232:320,n="mobile"===this.ui?18:32,o="mobile"===this.ui?4:10,r=Math.floor((t-i)/n),a=Math.max(1,Math.min(r,o)),l=a+s,c=this.querySelector(":scope shreddit-comment[is-chosen-mq-comment]"),d=c?.depth??0,h=Math.max(s,d-a+1);return c?{maxVisibleDepth:h+a,minVisibleDepth:h}:{maxVisibleDepth:l}}connectedCallback(){et(this.shadowRoot),super.connectedCallback(),this.subscribe(o.CommentCreated,this.handleCommentCreated),this.resizeObserver=new ResizeObserver(st((t=>{let e=0;for(const s of t){const t=s.contentBoxSize.at(0)?.inlineSize;if(t){e=t;break}}if(0===e)return;const s=this.getVisibilityDetails({containerWidth:e});if(this._visibilityDetails?.maxVisibleDepth!==s.maxVisibleDepth||this._visibilityDetails?.minVisibleDepth!==s.minVisibleDepth){this._visibilityDetails=s,this.depthUpdated=Promise.resolve(s);for(const t of this.querySelectorAll("shreddit-comment"))t.setVisibility(s.maxVisibleDepth,s.minVisibleDepth)}}),128,!0)),this.resizeObserver.observe(this,{box:"content-box"})}disconnectedCallback(){super.disconnectedCallback(),this.unsubscribe(o.CommentCreated,this.handleCommentCreated),this.resizeObserver?.unobserve(this),this.resizeObserver?.disconnect()}showAllComments(){this.publish(o.TriggerCommentBlockingAuth,{source:nt.Button}),this.isTruncated=!1,this.trackEvent(it())}renderShredtopViewMoreCommentsButton(t){return h({attributes:{type:"button",className:"ml-sm xs:ml-0 font-semibold mt-md",onclick:t},appearance:"brand",shape:"pill",leadingIcon:H({size:W.Medium}),size:m.Small,children:"View more comments"})}renderTruncatedExpandButton(){return this.renderShredtopViewMoreCommentsButton(this.showAllComments)}renderContent(){return function(t,e){const s="Comments Section";return t` <section class="flex flex-col px-md xs:px-0 gap-md relative" aria-label="Comments"> <h1 class="absolute -top-full -left-full w-px h-px overflow-hidden" aria-label="${s}"> ${s} </h1> <slot></slot> ${e?"":t`<slot name="truncated"></slot>`} </section> `}(z,this.isTruncated)}renderExpandButton(){return this.isTruncated?this.renderTruncatedExpandButton():""}render(){return z` ${this.renderContent()} ${this.renderExpandButton()} `}};e([s({type:String,attribute:"post-id"})],ft.prototype,"postId",void 0),e([s({type:Boolean})],ft.prototype,"isTruncated",void 0),e([s({type:String,attribute:"ui"})],ft.prototype,"ui",void 0),ft=e([i("shreddit-comment-tree")],ft);let St=class extends N{constructor(){super(),this.postId="",this.handleCommentCreated=({postId:t})=>{t===this.postId&&this.remove()},this.pubsub=new p(this)}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(o.CommentCreated,this.handleCommentCreated)}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(o.CommentCreated,this.handleCommentCreated)}render(){return z`<slot></slot>`}};St.styles=[Q`:host{display:contents}`,r],e([s({type:String,attribute:"post-id"})],St.prototype,"postId",void 0),St=e([i("comment-forest-empty-state")],St);let Tt=class extends ot{constructor(){super(...arguments),this.mtSeoLanguage="",this.isSeoVisit=!1,this.withInterventionModal=!1,this.isLoadingTranslations=!1,this._partialRequestController=new u(this),this.seoVisitSettled=!1,this.pubsub=new p(this),this.onPostTranslationOverride=t=>{"PDP"===t.pageType&&(t.isContextUpdateEvent||(t.isTranslationActive?this.onTranslationsEnabled():this.onTranslationsDisabled()))},this.onCommentTranslationOverride=t=>{this.onCommentTranslationToggle(t.id,t.isTranslationActive)}}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(o.I18nPostTranslationOverride,this.onPostTranslationOverride,!1),this.pubsub.subscribe(o.I18nCommentTranslationOverride,this.onCommentTranslationOverride,!1),this.addEventListener(b,this.handleTranslationFeedback),this.addEventListener("faceplate-load",this.handleCommmentPartialsLoaded)}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(o.I18nPostTranslationOverride,this.onPostTranslationOverride),this.pubsub.unsubscribe(o.I18nCommentTranslationOverride,this.onCommentTranslationOverride),this.removeEventListener(b,this.handleTranslationFeedback),this.removeEventListener("faceplate-load",this.handleCommmentPartialsLoaded)}updated(t){t.has("translationContextValue")&&void 0!==this.translationContextValue.isTranslationActive&&(this.seoVisitSettled||!this.isSeoVisit?super.onUpdateTranslationContextValue(t):this.seoVisitSettled=!0)}async onCommentTranslationToggle(t,e){const s=this.getCommentMetadataById(t);if(!s||!s.isTranslatable)return;const i=this.objectTranslationCache.get(t);if(!(e?!!i?.translatedElement:!!i?.originalElement)){const s=await this.fetchComments([t],e?"translated":"original");this.storeCommentTranslationCache(s)}this.renderTranslationCache(e,t)}async onTranslationsEnabled(){const t=await this.runTranslations(!0);g(!0),C(!0,this.mtSeoLanguage),this.submitTranslationMetrics(),this.toggleObserverForComments(t.fetchedComments)}async onTranslationsDisabled(){const t=await this.runTranslations(!1);g(!1),C(!1,this.mtSeoLanguage),this.submitTranslationMetrics(),this.toggleObserverForComments(t.fetchedComments)}async runTranslations(t){const e=t??!!this.translationContextValue.isTranslationActive,s=this.getCommentsMetadata();this.storeCommentTranslationCache(s.map((t=>({id:t.id,translation:t.isTranslated?t.slot.innerHTML:void 0,original:t.isTranslated?void 0:t.slot.innerHTML}))));const i=[];this.objectTranslationCache.forEach(((t,s)=>{(e&&!t.translatedElement||!e&&!t.originalElement)&&i.push(s)}));let n=[];return i.length&&(n=await this.fetchComments(i,e?"translated":"original"),this.storeCommentTranslationCache(n||[])),this.renderTranslationCache(e),{fetchedComments:n}}getCommentMetadataById(t){const e=this.querySelector(`shreddit-comment[thingid="${t}"]`);if(e)return this.getCommentMetadata(e)}getCommentsMetadata(){const t=this.querySelectorAll("shreddit-comment");return Array.from(t).filter((t=>{const e=t.getAttribute("thingid"),s=null!==t.getAttribute("is-translatable"),i=t.querySelector('div[slot="comment"]');return!!e&&s&&!!i})).map((t=>this.getCommentMetadata(t)))}getCommentMetadata(t){return{id:t.getAttribute("thingid"),isTranslated:null!==t.getAttribute("is-comment-translated"),isTranslatable:null!==t.getAttribute("is-translatable"),element:t,slot:t.querySelector('div[slot="comment"]'),cache:this.objectTranslationCache.get(t.getAttribute("thingid"))}}async fetchComments(t,e){const s=new FormData;t.forEach((t=>s.append("commentIds[]",t))),s.append("includeTranslation","translated"===e?"true":"false");const i=await this.fetchRequestPartial("/svc/shreddit/translated-comment/",{method:v.Post,body:s});return i?this.parseFetchCommentResponse(i):[]}parseFetchCommentResponse(t){return t.map((t=>{const e=t.getAttribute("data-comment-id"),s=t.querySelector(`[data-translated-comment-id="${e}"]`),i=s?.querySelector(`#${e}-translated-post-rtjson-content`),n=t.querySelector(`[data-original-comment-id="${e}"]`),o=n?.querySelector(`#${e}-post-rtjson-content`),r=t=>t?`<div class="py-0 xs:mx-xs mx-2xs inline-block">${t}</div>`:void 0;return{id:e,original:r(o?.innerHTML),translation:r(i?.innerHTML)}}))}storeCommentTranslationCache(t){t.forEach((t=>{this.updateTranslationCache(t.id,{originalElement:t.original?{content:t.original}:void 0,translatedElement:t.translation?{content:t.translation}:void 0})}))}renderTranslationCache(t,e){const s=t??!!this.translationContextValue.isTranslationActive;(e?[this.getCommentMetadataById(e)]:this.getCommentsMetadata()).filter((t=>t&&t.isTranslated!==s&&(s?!!t.cache?.translatedElement:!!t.cache?.originalElement))).forEach((t=>{const e=s?t.cache.translatedElement:t.cache.originalElement;t.slot.innerHTML=e?.content||"",s?t.element.setAttribute("is-comment-translated","true"):t.element.removeAttribute("is-comment-translated")}))}handleTranslationFeedback(t){const{postId:e,commentId:s}=t.detail,i=document.querySelector("shreddit-post"),n=i?.querySelector('[slot="title"]'),o=i?.querySelector('[slot="text-body"]'),r=this.shadowRoot?.getElementById(y.ID.PDP_COMMENT_FEEDBACK_MODAL);r&&r.show?.({post:{id:tt(e),title:n?.textContent?.trim(),body_text:o?.textContent?.trim(),translation_state:this.translationContextValue.isTranslationActive},comment:{id:s,post_id:tt(e),translation_state:this.translationContextValue.isTranslationActive}})}toggleObserverForComments(t){t?.forEach((t=>{const e=document.querySelector(`shreddit-comment[thingid="${t.id}"]`);e&&e?.addTranslationToggledObserver?.('div[slot="comment"]')}))}submitTranslationMetrics(t){if(!this.reportMetrics)return;const e=this.querySelectorAll("shreddit-comment"),s=this.translationContextValue?.isTranslationActive||!1,i={},n=[];e.length&&Array.from(e).filter((t=>{const e=this.getCommentMetadata(t);if(!t||!e)return;const i=e.slot?.textContent||"",o=e.cache;let r=s?"":i,a=s?i:"";o&&(r=o.originalElement?.content||r,a=o.translatedElement?.content||a),n.push({id:e.id,originalBody:r,translatedBody:a,isTranslated:e.isTranslated,isTranslatable:e.isTranslatable})})),i.scenario=t||this.metricsScenario,i.comments=f(s,n),this.dispatchEvent(S(T,i))}handleCommmentPartialsLoaded(t){"faceplate-load"===t.type&&this.translationContextValue.isTranslationActive&&"src"in t.detail&&t.detail.src.startsWith("/svc/shreddit/more-comments/")&&t.detail.src.includes("translated=1")&&(this.submitTranslationMetrics(k.LoadMore),this.pubsub.publish(o.I18nMoreCommentsPostMetrics,{}))}render(){return z` <div><slot></slot></div> ${this.withInterventionModal?z`<translation-intervention-modal mode="comment" page-type="pdp" ?is-immersive-visit="${this.isImmersiveVisit}"></translation-intervention-modal>`:K} <translation-feedback-modal id="${y.ID.PDP_COMMENT_FEEDBACK_MODAL}"></translation-feedback-modal> `}};e([s({type:String,attribute:"mt-seo-language"})],Tt.prototype,"mtSeoLanguage",void 0),e([s({type:Boolean,attribute:"is-seo-visit"})],Tt.prototype,"isSeoVisit",void 0),e([s({type:Boolean,attribute:"is-immersive-visit"})],Tt.prototype,"isImmersiveVisit",void 0),e([s({type:Boolean,attribute:"with-intervention-modal"})],Tt.prototype,"withInterventionModal",void 0),Tt=e([i("comment-translator")],Tt);let kt=class extends N{constructor(){super(),this.target="",this.path="",this.isMobile=!1,this.isEntityFilterEnabled=!1,this.hiddenChips=[],this.isSearchActive=!1,this.amaCommentTab=null,this.commentSearch=null,this.commentSort=null,this.pubsub=new p(this),this.replaceComments=async({sort:t="",filter:e="",entityFilterId:s=""})=>{t!==this.getCurrentSort()&&this.updateLocation({sort:t});const i=new URL(`${location.origin}${this.path}`);t&&i.searchParams.set(rt.Sort,t.toLowerCase()),e&&i.searchParams.set(rt.Filter,e.toLowerCase()),s&&i.searchParams.set(rt.EntityFilterId,s),i.searchParams.set(rt.InlineRefresh,"true");const n=i.toString().substring(location.origin.length);this.replaceContentController.loadAndReplaceContent({src:n,target:this.target,afterSuccess:()=>A(this,{message:"The comments are sorted successfully",options:{priority:E.assertive}}),afterFailure:()=>this.dispatchEvent(S("faceplate-alert",{level:P.error,cause:"uncategorized",message:"Failed to load the comments."}))})},this.handleCommentFilterUpdated=({sort:t,filter:e,entityFilterId:s})=>{this.replaceComments({entityFilterId:s,filter:e??this.getCurrentFilter(),sort:t??this.getCurrentSort()})},this.handleSortEvent=async t=>{this.replaceComments({sort:t.detail.selected?.toLowerCase(),filter:this.getCurrentFilter()}),this.pubsub.publish(o.CommentSort,{sort:t.detail.selected});const e=this.querySelector("rpl-filter-chip[selected]"),s=this.allChip?.assignedElements()?.[0];e?.removeAttribute("selected"),s?.setAttribute("selected","")},this.handleAmaTabClick=t=>{const e=t.target?.closest("button")?.getAttribute("value");e&&(this.replaceComments({filter:e,sort:this.getCurrentSort()}),t.preventDefault())},this.replaceContentController=new at,this.handleCommentSearchToggle=t=>{const e=t.detail.isHidden;this.isSearchActive=e;const s=this.querySelector("search-dynamic-id-cache-controller");s?.classList.toggle("min-w-full",e)},this.handleSelect=t=>{if(t instanceof KeyboardEvent&&"Enter"!==t.key)return;let e=t.target?.closest("rpl-filter-chip");if(!e)return;const s=this.querySelector("rpl-filter-chip[selected]");s===e&&(e=this.allChip.assignedElements()[0]),s?.removeAttribute("selected"),e?.setAttribute("selected",""),this.handleCommentFilterUpdated({entityFilterId:e?.dataset.entityId,sort:"confidence"});const i=this.querySelector("shreddit-sort-dropdown");i?.silentlySelectItemByValue("CONFIDENCE")}}updateLocation({sort:t}){const e=new URL(location.href);e.searchParams.set(rt.Sort,t.toLowerCase()),history.replaceState({},"",e.toString())}getCurrentFilter(){return this.querySelector("[faceplate-tab-selected]")?.getAttribute("value")?.toLowerCase()||""}getCurrentSort(){return new URLSearchParams(location.search).get(rt.Sort)||""}connectedCallback(){super.connectedCallback(),this.commentSearch=this.querySelector('[slot="comment-search"]'),this.amaCommentTab=this.querySelector('[slot="ama-comment-tab"]'),this.commentSort=this.querySelector('[slot="comment-sort"]')}getNextBatchCount(){return 0===this.hiddenChips.length?10:Math.min(this.hiddenChips.filter(Boolean).length,10)}handleShowAllClick(){const t=this.getNextBatchCount(),e=this.hiddenChips.findIndex(Boolean)+t;this.hiddenChips=this.hiddenChips.map(((t,s)=>s>e))}renderDivider(){return this.isEntityFilterEnabled&&!this.isSearchActive?z`<hr class="border-neutral-border-weak my-0 mx-2xs p-0 h-xl border-[0.5px]">`:K}renderEntityFilterSlots(){const t=this.querySelectorAll('[slot^="entity-"]');if(!this.isEntityFilterEnabled||this.isSearchActive||0===t.length)return K;const e=this.getNextBatchCount(),s=0===e||this.isMobile,i=z` <slot name="all" @click="${this.handleSelect}" @keydown="${this.handleSelect}" class="chip all-chip flex flex-shrink-0"></slot> ${Array.from({length:t.length}).map(((t,e)=>{const s=!this.isMobile&&this.hiddenChips[e];return z` <slot name="entity-${e}" @click="${this.handleSelect}" @keydown="${this.handleSelect}" class="chip entity flex flex-shrink-0 ${s?"hidden":""}"></slot> `}))} ${h({appearance:"bordered",size:m.Small,children:`+ ${e} more`,attributes:{className:"chip show-all-chip flex "+(s?"hidden":""),onclick:this.handleShowAllClick,type:"button"}})}`;return this.isMobile?z` <div class="flex gap-xs w-full overflow-x-auto hide-scrollbar">${i}</div>`:i}firstUpdated(t){super.firstUpdated(t),requestAnimationFrame((()=>{this.measureAndHideOverflow()}))}getSpaceTakenByElement(t){const e=t?.clientWidth??0;return e+(e>0?8:0)}measureAndHideOverflow(){if(!this.container)return;const t=Array.from(this.entities);if(0===t.length)return;this.hiddenChips=t.map((()=>!1));const e=this.getSpaceTakenByElement(this.stickyContainer)+this.getSpaceTakenByElement(this.allChip)+(this.showAllChip?.clientWidth??0),s=this.container.clientWidth-e;let i=0;const n=[...this.hiddenChips];let o=!1;for(let e=0;e<t.length;e++){const r=t[e],a=this.getSpaceTakenByElement(r);i+a>s&&(o=!0),n[e]=o,i+=a}this.hiddenChips=n}renderSortbar(){const t=j({flex:!0,"xs:ml-auto":!!this.amaCommentTab,hidden:this.isSearchActive});return this.commentSort?z`<slot name="comment-sort" class="${t}"></slot>`:K}renderSearchToggle(){return this.commentSearch?z`<slot name="comment-search"></slot>`:K}renderAMATab(){const t=j({flex:!0,hidden:this.isSearchActive});return this.amaCommentTab?z` <slot name="ama-comment-tab" @click="${this.handleAmaTabClick}" @keydown="${this.handleAmaTabClick}" class="${t}"></slot> `:K}renderToolbar(){const t=j({"toolbar-container relative bg-neutral-background flex gap-xs items-center":!0,"flex-wrap":!this.isEntityFilterEnabled,"flex-1":this.isSearchActive});return z` ${this.renderAMATab()} <div class="${t}"> ${this.renderSortbar()} ${this.renderSearchToggle()} ${this.renderDivider()} </div> `}renderDesktop(t){return z` <div class="${t}"> ${this.renderToolbar()} ${this.renderEntityFilterSlots()} </div> `}renderMobile(t){return z` <div class="${t}">${this.renderToolbar()}</div> ${this.renderEntityFilterSlots()} `}render(){const t=j({"flex gap-xs outer-container items-center flex-wrap ":!0,"w-full":!this.isMobile||this.isSearchActive,"justify-between w-full":Boolean(this.amaCommentTab)});return z` <div class="flex gap-xs w-full" @comment-sort="${this.handleSortEvent}" @pdp-comment-search-toggle="${this.handleCommentSearchToggle}"> ${this.isMobile?this.renderMobile(t):this.renderDesktop(t)} </div> `}};kt.styles=[r,Q`.hide-scrollbar{-ms-overflow-style:none;scrollbar-width:none}`],e([s({type:String})],kt.prototype,"target",void 0),e([s({type:String})],kt.prototype,"path",void 0),e([s({type:Boolean,attribute:"is-mobile"})],kt.prototype,"isMobile",void 0),e([x(".outer-container")],kt.prototype,"container",void 0),e([x(".all-chip")],kt.prototype,"allChip",void 0),e([x(".show-all-chip")],kt.prototype,"showAllChip",void 0),e([w(".entity")],kt.prototype,"entities",void 0),e([x(".toolbar-container")],kt.prototype,"stickyContainer",void 0),e([s({type:Boolean,attribute:"entity-filter-enabled"})],kt.prototype,"isEntityFilterEnabled",void 0),e([I()],kt.prototype,"hiddenChips",void 0),e([I()],kt.prototype,"isSearchActive",void 0),kt=e([i("shreddit-comments-sort-dropdown")],kt);const xt="expand-pdp-comment-search-button";let wt=class extends N{constructor(){super(...arguments),this.target="",this.path="",this.showOnLoad=!1,this.initialValue="",this.isEntityFilterEnabled=!1,this.open=this.showOnLoad,this.commentSearchActive=this.showOnLoad,this.focusSearchInput=()=>{this.open||(this.open=!0),this.searchInput?.innerInput?.focus()},this.resetSearchInput=()=>{this.handleClear(),this.open=!1,dt.update($.PdpCommentSearch),this.commentSearchActive=!1,this.expandSearchButton?.focus()},this.replaceContentController=new at,this.handlePdpCommentSearch=M((async()=>{const t=this.searchInput?.value??"";if(t){this.commentSearchActive=!0;const e={conversationId:ht.get($.PdpCommentSearch),cursor:{},impressionId:dt.getUUID(),pane:B.Comments,query:t,scope:{type:D.PDP,path:this.path}};this.addSearchParamsToUrl(e);const s=new URLSearchParams({...lt(e)});O(this,L({source:"search",action:"click",noun:"full_search_button"},this.searchTelemetryData));const i=document.createElement("span");i.id=this.target,this.replaceContentController.loadAndReplaceContent({src:`/svc/shreddit${this.path}pdp-comment-search-results?${s.toString()}`,target:this.target,wrapPartialElement:t=>(i.appendChild(t),i)})}}),300),this.handleKeyDown=t=>{dt.update($.PdpCommentSearch),"Enter"===t.key&&t.target===this.searchInput&&this.handlePdpCommentSearch(),"Escape"===t.key&&t.target===this.searchInput&&(t.stopPropagation(),this.commentSearchActive?this.searchInput?.blur():this.resetSearchInput())},this.handleClear=()=>{this.searchInput?.value&&(this.searchInput.value="")},this.searchCommentText=()=>"Search Comments"}hideElementsVisibility(t){this.dispatchEvent(S("pdp-comment-search-toggle",{isHidden:t}))}connectedCallback(){super.connectedCallback(),this.commentSearchActive=this.showOnLoad,this.open=this.showOnLoad}get searchTelemetryData(){const t=this.searchInput?.value??"";return{action_info:{page_type:F.PostDetail},search:{conversation_id:ht.get($.PdpCommentSearch),impression_id:dt.get($.PdpCommentSearch),query:t,query_id:mt.get({query:t,scope:{type:D.PDP,path:this.path}},$.PdpCommentSearch),origin_element:q.CommentSearchBar,origin_page_type:F.PostDetail}}}addSearchParamsToUrl(t){const e=location.href,s=new URL(e);s.searchParams.set(ct.Query,t.query),s.searchParams.set(ct.Pane,B.Comments),s.searchParams.set(ct.ConversationId,t.conversationId??ht.get($.PdpCommentSearch)),s.searchParams.set(ct.ImpressionId,t.impressionId??dt.getUUID());const i=s.toString();i!==e&&history.replaceState({},"",i)}updated(t){if(t.has("open")){const e=!t.get("open")&&this.open,s=t.get("open")&&!this.open;e?this.focusSearchInput():s&&this.expandSearchButton?.focus()}this.hideElementsVisibility(this.commentSearchActive||this.open)}renderSearchButton(){const t={"aria-controls":"pdp-comment-search-form","aria-expanded":`${this.open}`,id:xt,onclick:this.focusSearchInput,type:"button"},e={appearance:"bordered",screenReaderContent:"Expand comment search"};return this.isEntityFilterEnabled?h({attributes:{...t,className:""+(this.open?"hidden":"")},leadingIcon:J({size:W.Small}),size:m.Small,...e}):h({attributes:{...t,className:"border-neutral-border-weak hover:border-neutral-content-weak text-secondary-weak font-normal "+(this.open?"hidden":"")},children:z`<span class="flex pr-xs">${this.searchCommentText()}</span>`,leadingIcon:z`<span class="flex pl-xs">${J({size:W.Small})}</span>`,...e})}render(){return z`<div class="block" data-faceplate-tracking-context="${JSON.stringify(this.searchTelemetryData)}"> <faceplate-tracker source="search" action="click" noun="search_bar"> ${this.renderSearchButton()} </faceplate-tracker> <form class="flex w-full ${j({hidden:!this.open})}" id="pdp-comment-search-form" @submit="${this.handlePdpCommentSearch}"> <faceplate-search-input class="text-secondary-plain m-0 rounded-full outline outline-1 outline-neutral-border-weak flex-grow focus:outline-neutral-content-weak" placeholder="${this.searchCommentText()}" enterkeyhint="search" @keydown="${this.handleKeyDown}" @focus="${()=>{this.open=!0}}" value="${this.initialValue}"> ${h({attributes:{id:"search-input-clear-button",slot:"clearIcon",type:"button",onclick:this.handleClear},appearance:"plain",size:m.Small,screenReaderContent:"Clear search",leadingIcon:G({size:W.Small})})}</faceplate-search-input> ${h({appearance:"plain",attributes:{className:"ml-xs"+(this.commentSearchActive?" hidden":""),id:"cancel-pdp-comment-search-button",onclick:this.resetSearchInput,type:"button"},children:"Cancel"})} </form> </div>`}};wt.styles=[r],e([s({type:String})],wt.prototype,"target",void 0),e([s({type:String})],wt.prototype,"path",void 0),e([s({attribute:"show-on-load",type:Boolean})],wt.prototype,"showOnLoad",void 0),e([s({type:String,attribute:"initial-value"})],wt.prototype,"initialValue",void 0),e([s({type:Boolean,attribute:"entity-filter-enabled"})],wt.prototype,"isEntityFilterEnabled",void 0),e([x(`#${xt}`)],wt.prototype,"expandSearchButton",void 0),e([x("faceplate-search-input")],wt.prototype,"searchInput",void 0),e([I()],wt.prototype,"open",void 0),e([I()],wt.prototype,"commentSearchActive",void 0),wt=e([i("pdp-comment-search-input")],wt);let It=class extends N{constructor(){super(...arguments),this.commentId="",this.dedupe=!1,this.shouldTrackPosition=!1,this.pubsub=new p(this),this.loadInAd=()=>{const t=this.shouldTrackPosition?this:this.shadowRoot;if(!t||t.childNodes.length>0)return;const e=document.querySelector(`shreddit-comment-tree-ads > template#comment-tree-ad_${this.commentId}`),s=e?.content.querySelector("shreddit-comments-page-ad");e&&s&&this.isNotADuplicate(s)&&(t.replaceChildren(e.content.cloneNode(!0)),s.hasAttribute("is-blank")||this.removeAttribute("class"))},this.isNotADuplicate=t=>{if(!this.dedupe||t.hasAttribute("is-blank"))return!0;const e=document.querySelector("shreddit-comments-page-ad");return!e||t.getAttribute("campaign-id")!==e.getAttribute("campaign-id")}}createRenderRoot(){return this.shouldTrackPosition?this:super.createRenderRoot()}connectedCallback(){super.connectedCallback(),this.commentId&&(this.loadInAd(),this.pubsub.subscribe(o.CommentTreeAdsLoaded,this.loadInAd))}disconnectedCallback(){this.commentId&&this.pubsub.unsubscribe(o.CommentTreeAdsLoaded,this.loadInAd),super.disconnectedCallback()}render(){return K}};It.styles=[r],e([s({type:String,attribute:"comment-id"})],It.prototype,"commentId",void 0),e([s({type:Boolean,attribute:"dedupe"})],It.prototype,"dedupe",void 0),e([s({type:Boolean,attribute:"should-track-position"})],It.prototype,"shouldTrackPosition",void 0),It=e([i("shreddit-comment-tree-ad")],It);let At=class extends N{constructor(){super(...arguments),this.translationContextValue=_,this.isCommentPretranslated=!1,this.pubsub=new p(this),this.onPostTranslationOverride=t=>{(t.id===this.postId||t.isContextUpdateEvent)&&(this.postTranslationOverrideActive=t.isTranslationActive,this.commentTranslationOverrideActive=void 0)},this.onCommentTranslationOverride=t=>{t.id===this.commentId&&(this.commentTranslationOverrideActive=t.isTranslationActive)}}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(o.I18nCommentTranslationOverride,this.onCommentTranslationOverride,!1),this.pubsub.subscribe(o.I18nPostTranslationOverride,this.onPostTranslationOverride,!1),this.isMTSEOUserPage=U(),this.globalSetting=this.isCommentPretranslated||this.isMTSEOUserPage}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(o.I18nCommentTranslationOverride,this.onCommentTranslationOverride),this.pubsub.unsubscribe(o.I18nPostTranslationOverride,this.onPostTranslationOverride)}render(){const t=this.postTranslationOverrideActive,e=this.commentTranslationOverrideActive,s="boolean"==typeof t?"boolean"==typeof e&&e!==t:"boolean"==typeof e&&e!==this.globalSetting,i=!!s&&!e;return s?z`<div class="flex items-center text-neutral-content-weak" data-testid="comment-translation-status-icon"> ${!!s&&e?Y({size:W.ExtraSmall,attributes:{"data-testid":"comment-translation-status-icon-translated-icon","aria-label":"Comment is translated"}}):K} ${i?X({size:W.ExtraSmall,attributes:{"data-testid":"comment-translation-status-icon-original-icon","aria-label":"Comment is in original language",className:i?"":"hidden"}}):K} </div>`:K}};At.styles=[r],e([V({context:R,subscribe:!0}),I()],At.prototype,"translationContextValue",void 0),e([I()],At.prototype,"commentTranslationOverrideActive",void 0),e([I()],At.prototype,"postTranslationOverrideActive",void 0),e([I()],At.prototype,"isMTSEOUserPage",void 0),e([I()],At.prototype,"globalSetting",void 0),e([s({type:String,attribute:"comment-id"})],At.prototype,"commentId",void 0),e([s({type:String,attribute:"post-id"})],At.prototype,"postId",void 0),e([s({type:Boolean,attribute:"comment-pretranslated"})],At.prototype,"isCommentPretranslated",void 0),At=e([i("comment-translation-status-icon")],At);let Et=class extends N{connectedCallback(){const t=this.getFullUrl();t.includes(":~:text=")?this.goToCommentWithTextFragment(t):this.goToCommentWithId(),super.connectedCallback()}goToCommentWithId(){const t=window.location.hash;if(!t)return;const e=t.substring(1);if(!e)return;const s=`t1_${e}-comment-rtjson-content`,i=document.getElementById(s);if(!i)return;const n=document.querySelector(`shreddit-comment[thingid="t1_${e}"]`);if(!n)return;i.style.fontWeight="900";const o=n.getBoundingClientRect(),r=n.offsetHeight,a=o.top+window.pageYOffset-r/2;a>window.innerHeight&&window.scrollTo({top:a,behavior:"smooth"})}goToCommentWithTextFragment(t){document.fragmentDirective&&this.setWindowHref(t)}getFullUrl(){const t=performance.getEntriesByType("navigation");return t.length>0?t[0].name:window.location.href}setWindowHref(t){window.location.href=t}render(){return z``}};Et=e([i("comment-url-fragment-manager")],Et),"enabled"===window.CLIENT_EXPERIMENTS?.shreddit_pdp_no_mod_js_lo?pt()&&import("./index-logged-in-0cfade66.js"):import("./index-logged-in-0cfade66.js");
