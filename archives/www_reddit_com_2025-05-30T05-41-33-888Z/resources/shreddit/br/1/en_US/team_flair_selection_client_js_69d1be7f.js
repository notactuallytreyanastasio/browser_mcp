import{b as e,H as t,a as s,l as a,L as i,c as r,I as o,ah as l,U as n,M as d,O as c,w as p,x as u,t as h,_ as m,J as b,n as f,e as y}from"./shell-2264602c.js";import{x as S,c as w,I as v,s as g}from"./icon-82dd10b4.js";import{l as T,L as x}from"./expandable-section-header-edd4c2b3.js";import"./faceplate-bottom-sheet-header-63783c3a.js";import"./app-selector-client-js-3a92da0e.js";import"./chat-mobile-xpromo-client-js-c803f3b0.js";import"./TinyGesture-89d9957c.js";import"./age-gate-standalone-client-js-5357b0cf.js";const I=({actionReason:s,subredditId:a,subredditName:i})=>e({source:"global",action:"view",noun:"screen"},{action_info:{page_type:t.FlairsList,reason:s},subreddit:{id:a,name:i}}),F=({eventType:t,actionReason:s,subredditId:a,subredditName:i,flairId:r,flairText:o})=>e({source:"flair_prompt",action:"submit",noun:"flair"},{action_info:{type:t,reason:s},user_flair:{id:r,title:o},subreddit:{id:a,name:i}});var k,N,E;!function(e){e.Subreddit="community",e.Post="post_detail",e.Leaderboard="leaderboard"}(k||(k={})),function(e){e.Success="success",e.Failure="failure"}(N||(N={})),function(e){e.Emoji="emoji",e.Text="text"}(E||(E={}));const A=/:(.*?):/g;var U;!function(e){e.DEFAULT="team",e.COUNTRY="country"}(U||(U={}));let j=class extends(s(g)){constructor(){super(...arguments),this.isDesktopViewport=!1,this.subredditId="",this.subredditName="",this.username="",this.flairs=[],this.teamType=U.DEFAULT,this.actionReason=k.Subreddit,this.isAlwaysShown=!1,this.TeamTypesCopies={[U.DEFAULT]:"Team selected!",[U.COUNTRY]:"Country selected!"},this.open=()=>{const e={actionReason:this.isAlwaysShown?k.Leaderboard:this.actionReason,subredditId:this.subredditId,subredditName:this.subredditName};if(this.isDesktopViewport?this.modal?.open||(this.modal?.showModal(),this.trackEvent(I(e))):this.bottomSheet?.open||(this.bottomSheet?.showModal(),this.trackEvent(I(e))),a.isAvailable()){const e=JSON.parse(a.getItem(i.TeamFlairSelectionIsShown)||"{}");a.setItem(i.TeamFlairSelectionIsShown,JSON.stringify({...e,[this.subredditId]:!0}))}},this.close=()=>{this.isDesktopViewport?this.modal?.close():this.bottomSheet?.close()}}get flairTemplateRadioBtns(){return document.querySelectorAll('faceplate-radio-input[name="flairTemplateId"]')}firstUpdated(){requestAnimationFrame((()=>{if(a.isAvailable()){const e=JSON.parse(a.getItem(i.TeamFlairSelectionIsShown)||"{}");if(Array.isArray(e)){const t={};if(e.forEach((e=>{t[e]=!0})),a.setItem(i.TeamFlairSelectionIsShown,JSON.stringify({...t})),t[this.subredditId]&&!this.isAlwaysShown)return}if(e[this.subredditId]&&!this.isAlwaysShown)return}this.open()}))}async onFlairSelect(e,t,s){e.preventDefault();const a={actionReason:this.isAlwaysShown?k.Leaderboard:this.actionReason,flairId:t,flairText:s.toString(),subredditId:this.subredditId,subredditName:this.subredditName};try{const e=await this.makeUpdateUserFlairRequest(t,s);if(e?.data?.updateUserFlair?.ok){this.dispatchEvent(r("faceplate-alert",{level:o.success,message:this.TeamTypesCopies[this.teamType]})),this.trackEvent(F({...a,eventType:N.Success}));for(const e of this.flairTemplateRadioBtns){e.getAttribute("value")===t&&e.click()}}else this.showErrorMessage(l.QueryBadResponse),this.trackEvent(F({...a,eventType:N.Failure}))}catch(e){window.Sentry?.captureError?.(e),this.showErrorMessage(n(e)),this.trackEvent(F({...a,eventType:N.Failure}))}this.close()}async makeUpdateUserFlairRequest(e,t){return d({operation:c.UpdateUserFlairAndEnabledStatus,variables:{subredditId:this.subredditId??"",isEnabled:!0,flairTemplateId:e,text:t,shouldUpdateUserFlair:!0,shouldUpdateUserFlairEnabledStatus:!0,username:this.username??""}})}showErrorMessage(e){this.dispatchEvent(r("faceplate-alert",{level:o.error,message:"Something went wrong",cause:e}))}getTitleText(){return"Who are you cheering for?"}renderCloseButton(){return S`<faceplate-tracker source="flair_prompt" action="click" noun="${t.FlairsList}" data-faceplate-tracking-context="${JSON.stringify({action_info:{type:"dismiss"},subreddit:{id:this.subredditId,name:this.subredditName}})}" slot="closeButton"> ${p({appearance:"secondary",leadingIcon:w({size:v.Small}),size:u.Small,attributes:{onclick:this.close,className:"close-button","aria-label":"Close team flair selection modal"}})}</faceplate-tracker>`}renderFlairLabel(e){if(!e.text.match(A)||!e.richtext)return{label:e.text.replace(A,"").trim()};const t=JSON.parse(e.richtext);let s="",a=S``;for(const e of t)e.e===E.Emoji&&e.u&&(a=S` <img alt="Custom emoji set by the subreddit moderatos" src="${e.u}" class="w-md h-md mx-xs">`),e.e===E.Text&&e.t&&(s=e.t);return{label:s,leadingIcon:a}}renderFlairsList(){return S` ${this.flairs.map((e=>S`<faceplate-tracker source="flair_prompt" action="click" noun="${t.FlairsList}" data-faceplate-tracking-context="${JSON.stringify({action_info:{type:"choose"},subreddit:{id:this.subredditId,name:this.subredditName},user_flair:{id:e.id,title:e.text}})}">${T({...this.renderFlairLabel(e),size:x.Medium,onClick:t=>this.onFlairSelect(t,e.id,e.text),attributes:{className:"w-full text-18","aria-label":`A label for ${e.text}`}})} </faceplate-tracker>`))} `}renderModal(){return S`<faceplate-modal ?shouldContentScroll="${!0}" class="z-10 rounded-lg w-[370px] max-h-[600px] s:w-[454px] m:w-[455px]"> ${this.renderCloseButton()} <div slot="title" class="text-18">${this.getTitleText()}</div> <div class="flex flex-col justify-center w-full">${this.renderFlairsList()}</div> </faceplate-modal>`}renderBottomSheet(){return S`<faceplate-bottom-sheet> <faceplate-bottom-sheet-header slot="header" has-divider> ${this.getTitleText()} <span slot="trailing"> ${this.renderCloseButton()}</span> </faceplate-bottom-sheet-header> <div class="box-border p-md pb-lg w-full overflow-y-scroll">${this.renderFlairsList()}</div> </faceplate-bottom-sheet>`}render(){return this.isDesktopViewport?this.renderModal():this.renderBottomSheet()}};j.styles=[h],m([b("faceplate-modal")],j.prototype,"modal",void 0),m([b("faceplate-bottom-sheet")],j.prototype,"bottomSheet",void 0),m([f({type:Boolean,attribute:"is-desktop-viewport"})],j.prototype,"isDesktopViewport",void 0),m([f({type:String,attribute:"subreddit-id"})],j.prototype,"subredditId",void 0),m([f({type:String,attribute:"subreddit-name"})],j.prototype,"subredditName",void 0),m([f({type:String,attribute:"username"})],j.prototype,"username",void 0),m([f({type:Array,attribute:"flairs"})],j.prototype,"flairs",void 0),m([f({type:String,attribute:"team-type"})],j.prototype,"teamType",void 0),m([f({type:String,attribute:"action-reason"})],j.prototype,"actionReason",void 0),m([f({type:Boolean,attribute:"is-always-shown"})],j.prototype,"isAlwaysShown",void 0),j=m([y("team-flair-selection-modal")],j);
