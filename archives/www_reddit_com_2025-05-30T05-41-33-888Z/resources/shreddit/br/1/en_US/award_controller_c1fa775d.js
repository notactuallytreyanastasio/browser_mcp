import{P as e,T as i,r as t,bg as a,u as s,bh as r}from"./shell-2264602c.js";import{a as n}from"./awardsTelemetryState-e939bf46.js";var o;!function(e){e.Banner="education_banner",e.Dialog="education_module",e.Tooltip="tooltip"}(o||(o={}));class l{constructor(i){this.isActivatingExplainer=!1,this.handleExplainerClosed=({explainerId:e,dismissed:i})=>{this.resolver&&this.resolver.explainerId===e&&(this.resolver.resolve({dismissed:i}),this.resolver=void 0)},(this.host=i).addController(this),this.pubsub=new e(this.host)}hostConnected(){this.pubsub.subscribe(i.ExplainerClosed,this.handleExplainerClosed,!1)}hostDisconnected(){this.pubsub.unsubscribe(i.ExplainerClosed,this.handleExplainerClosed)}getExplainerDialogByExplainerId(e){return document.querySelector(`[dialog-id=explainer-dialog][data-explainer-id="${e}"]`)}async showExplainer({explainerExperience:e,explainerId:i,explainerType:r,correlationId:n}){if(this.isActivatingExplainer||l.activatedExplainers.has(i)||!r?.endsWith(o.Dialog))return{dismissed:!1};try{this.isActivatingExplainer=!0,await t({name:a,routeParams:{explainerId:i},queryParams:{explainerExperience:e,explainerType:r,correlationId:n},renderMode:s.Contents});if(!this.getExplainerDialogByExplainerId(i))throw new Error(`Explainer dialog for explainer ID \`${i}\` not found after activation`);l.activatedExplainers.add(i)}catch(e){window.Sentry?.captureError?.(e)}finally{this.isActivatingExplainer=!1}return l.activatedExplainers.has(i)?new Promise((e=>this.resolver={explainerId:i,resolve:e})):{dismissed:!1}}}l.activatedExplainers=new Set;class d{constructor(i,t){this.isActivatingDialog=!1,this.handleAwardContent=({thingId:e,award:i})=>{e===this.getThingId()&&this.onAward?.(i)},(this.host=i).addController(this),this.pubsub=new e(this.host),this.explainerController=new l(this.host),this.getThingId=t.getThingId,this.getAwardPromoConfig=t.getAwardPromoConfig,this.onAward=t.onAward}hostConnected(){this.onAward&&this.pubsub.subscribe(i.AwardContent,this.handleAwardContent,!1)}hostDisconnected(){this.pubsub.unsubscribe(i.AwardContent,this.handleAwardContent)}async activateDialog(){if(!this.isActivatingDialog)try{this.isActivatingDialog=!0;const{experience:e,id:i,type:a}=this.getAwardPromoConfig?.()??{},o=e&&i&&a?await this.explainerController.showExplainer({explainerExperience:e,explainerId:a,explainerType:i,correlationId:n.getCorrelationId()}):void 0;o?.dismissed||await t({name:r,routeParams:{thingId:this.getThingId()},renderMode:s.Contents})}finally{this.isActivatingDialog=!1}}}export{d as A};
