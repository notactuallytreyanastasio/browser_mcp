import{e4 as t,b as e,a as n,_ as s,n as i,e as o,P as r,c1 as c,e5 as a,T as m,aX as d}from"./shell-2264602c.js";import{o as u,u as h}from"./errors-8d0111b7.js";import{s as l}from"./icon-82dd10b4.js";let _;const p=new Uint8Array(16);function w(){if(!_&&(_="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!_))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _(p)}var f=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const v=[];for(let t=0;t<256;++t)v.push((t+256).toString(16).slice(1));function y(t,e=0){return(v[t[e+0]]+v[t[e+1]]+v[t[e+2]]+v[t[e+3]]+"-"+v[t[e+4]]+v[t[e+5]]+"-"+v[t[e+6]]+v[t[e+7]]+"-"+v[t[e+8]]+v[t[e+9]]+"-"+v[t[e+10]]+v[t[e+11]]+v[t[e+12]]+v[t[e+13]]+v[t[e+14]]+v[t[e+15]]).toLowerCase()}function b(t){if(!function(t){return"string"==typeof t&&f.test(t)}(t))throw TypeError("Invalid UUID");let e;const n=new Uint8Array(16);return n[0]=(e=parseInt(t.slice(0,8),16))>>>24,n[1]=e>>>16&255,n[2]=e>>>8&255,n[3]=255&e,n[4]=(e=parseInt(t.slice(9,13),16))>>>8,n[5]=255&e,n[6]=(e=parseInt(t.slice(14,18),16))>>>8,n[7]=255&e,n[8]=(e=parseInt(t.slice(19,23),16))>>>8,n[9]=255&e,n[10]=(e=parseInt(t.slice(24,36),16))/1099511627776&255,n[11]=e/4294967296&255,n[12]=e>>>24&255,n[13]=e>>>16&255,n[14]=e>>>8&255,n[15]=255&e,n}function g(t,e,n){function s(t,s,i,o){var r;if("string"==typeof t&&(t=function(t){t=unescape(encodeURIComponent(t));const e=[];for(let n=0;n<t.length;++n)e.push(t.charCodeAt(n));return e}(t)),"string"==typeof s&&(s=b(s)),16!==(null===(r=s)||void 0===r?void 0:r.length))throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)");let c=new Uint8Array(16+t.length);if(c.set(s),c.set(t,s.length),c=n(c),c[6]=15&c[6]|e,c[8]=63&c[8]|128,i){o=o||0;for(let t=0;t<16;++t)i[o+t]=c[t];return i}return y(c)}try{s.name=t}catch(t){}return s.DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8",s.URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8",s}function C(t){return 14+(t+64>>>9<<4)+1}function E(t,e){const n=(65535&t)+(65535&e);return(t>>16)+(e>>16)+(n>>16)<<16|65535&n}function U(t,e,n,s,i,o){return E((r=E(E(e,t),E(s,o)))<<(c=i)|r>>>32-c,n);var r,c}function V(t,e,n,s,i,o,r){return U(e&n|~e&s,t,e,i,o,r)}function j(t,e,n,s,i,o,r){return U(e&s|n&~s,t,e,i,o,r)}function S(t,e,n,s,i,o,r){return U(e^n^s,t,e,i,o,r)}function A(t,e,n,s,i,o,r){return U(n^(e|~s),t,e,i,o,r)}g("v3",48,(function(t){if("string"==typeof t){const e=unescape(encodeURIComponent(t));t=new Uint8Array(e.length);for(let n=0;n<e.length;++n)t[n]=e.charCodeAt(n)}return function(t){const e=[],n=32*t.length,s="0123456789abcdef";for(let i=0;i<n;i+=8){const n=t[i>>5]>>>i%32&255,o=parseInt(s.charAt(n>>>4&15)+s.charAt(15&n),16);e.push(o)}return e}(function(t,e){t[e>>5]|=128<<e%32,t[C(e)-1]=e;let n=1732584193,s=-271733879,i=-1732584194,o=271733878;for(let e=0;e<t.length;e+=16){const r=n,c=s,a=i,m=o;n=V(n,s,i,o,t[e],7,-680876936),o=V(o,n,s,i,t[e+1],12,-389564586),i=V(i,o,n,s,t[e+2],17,606105819),s=V(s,i,o,n,t[e+3],22,-1044525330),n=V(n,s,i,o,t[e+4],7,-176418897),o=V(o,n,s,i,t[e+5],12,1200080426),i=V(i,o,n,s,t[e+6],17,-1473231341),s=V(s,i,o,n,t[e+7],22,-45705983),n=V(n,s,i,o,t[e+8],7,1770035416),o=V(o,n,s,i,t[e+9],12,-1958414417),i=V(i,o,n,s,t[e+10],17,-42063),s=V(s,i,o,n,t[e+11],22,-1990404162),n=V(n,s,i,o,t[e+12],7,1804603682),o=V(o,n,s,i,t[e+13],12,-40341101),i=V(i,o,n,s,t[e+14],17,-1502002290),s=V(s,i,o,n,t[e+15],22,1236535329),n=j(n,s,i,o,t[e+1],5,-165796510),o=j(o,n,s,i,t[e+6],9,-1069501632),i=j(i,o,n,s,t[e+11],14,643717713),s=j(s,i,o,n,t[e],20,-373897302),n=j(n,s,i,o,t[e+5],5,-701558691),o=j(o,n,s,i,t[e+10],9,38016083),i=j(i,o,n,s,t[e+15],14,-660478335),s=j(s,i,o,n,t[e+4],20,-405537848),n=j(n,s,i,o,t[e+9],5,568446438),o=j(o,n,s,i,t[e+14],9,-1019803690),i=j(i,o,n,s,t[e+3],14,-187363961),s=j(s,i,o,n,t[e+8],20,1163531501),n=j(n,s,i,o,t[e+13],5,-1444681467),o=j(o,n,s,i,t[e+2],9,-51403784),i=j(i,o,n,s,t[e+7],14,1735328473),s=j(s,i,o,n,t[e+12],20,-1926607734),n=S(n,s,i,o,t[e+5],4,-378558),o=S(o,n,s,i,t[e+8],11,-2022574463),i=S(i,o,n,s,t[e+11],16,1839030562),s=S(s,i,o,n,t[e+14],23,-35309556),n=S(n,s,i,o,t[e+1],4,-1530992060),o=S(o,n,s,i,t[e+4],11,1272893353),i=S(i,o,n,s,t[e+7],16,-155497632),s=S(s,i,o,n,t[e+10],23,-1094730640),n=S(n,s,i,o,t[e+13],4,681279174),o=S(o,n,s,i,t[e],11,-358537222),i=S(i,o,n,s,t[e+3],16,-722521979),s=S(s,i,o,n,t[e+6],23,76029189),n=S(n,s,i,o,t[e+9],4,-640364487),o=S(o,n,s,i,t[e+12],11,-421815835),i=S(i,o,n,s,t[e+15],16,530742520),s=S(s,i,o,n,t[e+2],23,-995338651),n=A(n,s,i,o,t[e],6,-198630844),o=A(o,n,s,i,t[e+7],10,1126891415),i=A(i,o,n,s,t[e+14],15,-1416354905),s=A(s,i,o,n,t[e+5],21,-57434055),n=A(n,s,i,o,t[e+12],6,1700485571),o=A(o,n,s,i,t[e+3],10,-1894986606),i=A(i,o,n,s,t[e+10],15,-1051523),s=A(s,i,o,n,t[e+1],21,-2054922799),n=A(n,s,i,o,t[e+8],6,1873313359),o=A(o,n,s,i,t[e+15],10,-30611744),i=A(i,o,n,s,t[e+6],15,-1560198380),s=A(s,i,o,n,t[e+13],21,1309151649),n=A(n,s,i,o,t[e+4],6,-145523070),o=A(o,n,s,i,t[e+11],10,-1120210379),i=A(i,o,n,s,t[e+2],15,718787259),s=A(s,i,o,n,t[e+9],21,-343485551),n=E(n,r),s=E(s,c),i=E(i,a),o=E(o,m)}return[n,s,i,o]}(function(t){if(0===t.length)return[];const e=8*t.length,n=new Uint32Array(C(e));for(let s=0;s<e;s+=8)n[s>>5]|=(255&t[s/8])<<s%32;return n}(t),8*t.length))}));var I={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function L(t,e,n){if(I.randomUUID&&!t)return I.randomUUID();const s=(t=t||{}).random||(t.rng||w)();return s[6]=15&s[6]|64,s[8]=63&s[8]|128,y(s)}function k(t,e,n,s){switch(t){case 0:return e&n^~e&s;case 1:case 3:return e^n^s;case 2:return e&n^e&s^n&s}}function F(t,e){return t<<e|t>>>32-e}g("v5",80,(function(t){const e=[1518500249,1859775393,2400959708,3395469782],n=[1732584193,4023233417,2562383102,271733878,3285377520];if("string"==typeof t){const e=unescape(encodeURIComponent(t));t=[];for(let n=0;n<e.length;++n)t.push(e.charCodeAt(n))}else Array.isArray(t)||(t=Array.prototype.slice.call(t));t.push(128);const s=t.length/4+2,i=Math.ceil(s/16),o=new Array(i);for(let e=0;e<i;++e){const n=new Uint32Array(16);for(let s=0;s<16;++s)n[s]=t[64*e+4*s]<<24|t[64*e+4*s+1]<<16|t[64*e+4*s+2]<<8|t[64*e+4*s+3];o[e]=n}o[i-1][14]=8*(t.length-1)/Math.pow(2,32),o[i-1][14]=Math.floor(o[i-1][14]),o[i-1][15]=8*(t.length-1)&4294967295;for(let t=0;t<i;++t){const s=new Uint32Array(80);for(let e=0;e<16;++e)s[e]=o[t][e];for(let t=16;t<80;++t)s[t]=F(s[t-3]^s[t-8]^s[t-14]^s[t-16],1);let i=n[0],r=n[1],c=n[2],a=n[3],m=n[4];for(let t=0;t<80;++t){const n=Math.floor(t/20),o=F(i,5)+k(n,r,c,a)+m+e[n]+s[t]>>>0;m=a,a=c,c=F(r,30)>>>0,r=i,i=o}n[0]=n[0]+i>>>0,n[1]=n[1]+r>>>0,n[2]=n[2]+c>>>0,n[3]=n[3]+a>>>0,n[4]=n[4]+m>>>0}return[n[0]>>24&255,n[0]>>16&255,n[0]>>8&255,255&n[0],n[1]>>24&255,n[1]>>16&255,n[1]>>8&255,255&n[1],n[2]>>24&255,n[2]>>16&255,n[2]>>8&255,255&n[2],n[3]>>24&255,n[3]>>16&255,n[3]>>8&255,255&n[3],n[4]>>24&255,n[4]>>16&255,n[4]>>8&255,255&n[4]]}));const R=n(l);let O=class extends R{constructor(){super(...arguments),this.totalComments=0,this.pubsub=new r(this),this.pageUnloaded=!1,this.initialViewStats={num_comments_viewed:0,comments_viewed_json:[],comments_viewed_list:[],num_comments_consumed:0,comments_consumed_json:[],comments_consumed_list:[]},this.view_stats=this.cloneObject(this.initialViewStats),this.viewedEntityFilterChips=new Set,this.correlation_id=L(),this.page_request_id=c(),this.handleCommentCreated=()=>{this.totalComments+=1},this.handleVisibilityChange=t=>{t?(this.pageUnloaded=!1,this.resetViewStats()):this.pageUnloaded||this.flushEvents()},this.onBeforeUnload=()=>{this.pageUnloaded=!0,this.flushEvents()},this.flushEvents=()=>{const n=a(),s=((n,s,i,o,r,c,a)=>{let m={};const d=t("post"),u=s.slice(0,1e3);return m={correlation_id:r,translation_metrics:a,view_stats:{num_comments_viewed:n,comments_viewed_json:JSON.stringify(u),comments_viewed_list:i},post:{...d,number_comments:o},action_info:{page_request_id:c}},e({source:"post",action:"view",noun:"comments"},m)})(this.view_stats.num_comments_viewed,this.view_stats.comments_viewed_json,this.view_stats.comments_viewed_list,this.totalComments,this.correlation_id,this.page_request_id,n);this.trackEvent(s);const i=((n,s,i,o,r,c,a)=>{let m={};const d=t("post"),u=s.slice(0,1e3);return m={correlation_id:r,translation_metrics:a,view_stats:{num_comments_consumed:n,comments_consumed_json:JSON.stringify(u),comments_consumed_list:i},post:{...d,number_comments:o},screen:{height:window?.screen.height,width:window?.screen.width},action_info:{page_request_id:c}},e({source:"post",action:"consume",noun:"comments"},m)})(this.view_stats.num_comments_consumed,this.view_stats.comments_consumed_json,this.view_stats.comments_consumed_list,this.totalComments,this.correlation_id,this.page_request_id,n);if(this.trackEvent(i),this.viewedEntityFilterChips.size){const n=((n,s,i)=>{let o={};return o={correlation_id:s,view_stats:{entity_ids:n},post:{...t("post")},action_info:{page_request_id:i}},e({source:"post_detail",action:"view",noun:"comment_filter"},o)})(Array.from(this.viewedEntityFilterChips),this.correlation_id,this.page_request_id);this.trackEvent(n)}this.resetViewStats()},this.commentsViewedListener=t=>{this.updateCommentsViewedStats(t.detail)},this.commentsConsumedListener=t=>{this.updateCommentsConsumedStats(t.detail)},this.handleEntityFilterViewTracking=t=>{t.entity_id&&this.viewedEntityFilterChips.add(t.entity_id)}}cloneObject(t){return JSON.parse(JSON.stringify(t))}connectedCallback(){super.connectedCallback(),this.parentElement.addEventListener("comments-viewed-event",this.commentsViewedListener),this.parentElement.addEventListener("comments-consumed-event",this.commentsConsumedListener),this.pubsub.subscribe(m.EntityFilterView,this.handleEntityFilterViewTracking),this.pubsub.subscribe(m.CommentCreated,this.handleCommentCreated),d.subscribe(this.onBeforeUnload,{unloadOnly:!0}),u(this.handleVisibilityChange,{immediate:!0}),window.addEventListener("beforeRoute",this.flushEvents)}disconnectedCallback(){super.disconnectedCallback(),this.parentElement.removeEventListener("comments-viewed-event",this.commentsViewedListener),this.parentElement.removeEventListener("comments-consumed-event",this.commentsConsumedListener),this.pubsub.unsubscribe(m.EntityFilterView,this.handleEntityFilterViewTracking),this.pubsub.unsubscribe(m.CommentCreated,this.handleCommentCreated),d.unsubscribe(this.onBeforeUnload),h(this.handleVisibilityChange),window.removeEventListener("beforeRoute",this.flushEvents)}resetViewStats(){this.correlation_id=L(),this.view_stats=this.cloneObject(this.initialViewStats),this.viewedEntityFilterChips=new Set}includesComment(t,e){return t.some((t=>t.comment_id===e))}updateCommentsViewedStats(t){const e=t?.detail;this.includesComment(this.view_stats.comments_viewed_json,e.comment_id)||(this.view_stats.comments_viewed_json.push(e),this.view_stats.comments_viewed_list.push(e.comment_id),this.view_stats.num_comments_viewed=this.view_stats.comments_viewed_json.length)}updateCommentsConsumedStats(t){const e=t?.detail;this.includesComment(this.view_stats.comments_consumed_json,e.comment_id)||(this.view_stats.comments_consumed_json.push(e),this.view_stats.comments_consumed_list.push(e.comment_id),this.view_stats.num_comments_consumed=this.view_stats.comments_consumed_json.length)}};s([i({type:Number,attribute:"total-comments"})],O.prototype,"totalComments",void 0),O=s([o("shreddit-comment-tree-stats")],O);
