import{Y as e,aM as t,_ as s,n as i,m as o,g as n,e as r}from"./shell-2264602c.js";import{x as a,l as h,a as l}from"./icon-82dd10b4.js";import{P as c}from"./user-flair-afad799f.js";import{F as u}from"./age-gate-standalone-client-js-5357b0cf.js";import{FaceplateTooltip as d}from"./faceplate-tooltip-842394bc.js";const p=new WeakSet,v=async(t,{includeShadowRoot:s=!1}={})=>{const i="faceplate-partial",o=Array.from(t.querySelectorAll(i));s&&o.push(...Array.from(t.shadowRoot?.querySelectorAll(i)??[]));return(await Promise.all(o.map((async t=>!t||p.has(t)||t.loading!==e.Programmatic?Promise.resolve(!1):(p.add(t),t.load().then((()=>!0))))))).filter(Boolean).length>0},m=e=>t=>(e(t),t);let g=class extends d{constructor(){super(...arguments),this.mouseEnterDelay=750,this.mouseLeaveDelay=500,this.closeOnTrack=!1,this.disableTouchActivation=!1,this.partialLoading=e.Action,this.label="",this.mouseOnly=!1,this.sleepAfterEscape=!1,this.enterTimeout=-1,this.leaveTimeout=-1,this._popperController=new c(this,{position:this.position,referenceElementKey:"referenceElement",popperElementKey:"_tooltip"}),this._isHandlingTouch=!1,this.cleanupTimeouts=()=>{this.enterTimeout=this.leaveTimeout=-1},this.triggerEvent="hover",this.emitter=u(this),this.handleFocusOut=e=>{const t=e.relatedTarget;this.hidden||this.hasUserInteraction(t)||(this.close(),this.anchorEl&&(this.sleepAfterEscape=!0,this.anchorEl?.focus({preventScroll:!0})))},this.onEscape=e=>{"Escape"===e.key&&(this.sleepAfterEscape=!0,this.close(),this.trigger?.focus())},this.mouseOverTrigger=e=>{this.setAttribute("trigger","mouse"),this.handleMouseenter(e)},this.handleClick=e=>{"hover"===this.triggerEvent&&this._isHandlingTouch&&this.disableTouchActivation&&(this.cleanupTimeouts(),this._isHandlingTouch=!1),super.handleClick(e)},this.handleTouchstart=()=>{this._isHandlingTouch=!0},this.handleMouseenter=t=>{if(this.mouseOnly&&"focusin"===t?.type)return;if(this.sleepAfterEscape)return void(this.sleepAfterEscape=!1);if(!this.hidden)return this.cleanupTimeouts();this.emitter.dispatch("entered"),this.partialLoading===e.Intent&&this.load();const s=window.setTimeout((()=>{s===this.enterTimeout&&this.hasUserInteraction()&&this.show()}),this.mouseEnterDelay);this.enterTimeout=s,document.addEventListener("keydown",this.onEscape),t?.currentTarget?.addEventListener("mouseleave",this.handleMouseleave,{once:!0})},this.handleMouseleave=()=>{if(this.hidden)return this.cleanupTimeouts();const e=window.setTimeout((()=>{e===this.leaveTimeout&&this.close()}),this.mouseLeaveDelay);this.leaveTimeout=e},this.handleMouseEnterTooltip=()=>{this.cleanupTimeouts()},this.handleMouseLeaveTooltip=()=>{this.handleMouseleave(),document.removeEventListener("keydown",this.onEscape)},this.handleFaceplateTrack=()=>{this.closeOnTrack&&this.close()},this.handleSlotChange=()=>{this.initializeFocusManager(),!this.hidden&&this.focusManager?.focus()},this.initializeFocusManager=()=>{this.content&&(this.focusManager=new t(this,this.content))},this.render=()=>{const e=this._popperController.actualPosition||this.position;return a` <slot aria-describedby="faceplate-tooltip" faceplate-popper-trigger @click="${this.handleClick}" @touchstart="${this.handleTouchstart}" @mouseenter="${this.mouseOverTrigger}" @mouseleave="${this.handleMouseleave}" @focusin="${this.handleMouseenter}" @focusout="${this.handleMouseleave}"></slot> <div aria-label="${h((this.label||this.ariaLabel)??void 0)}" id="faceplate-tooltip" role="dialog" part="content-container" position="${e}" @keydown="${this.handleKeydown}" @mouseenter="${this.handleMouseEnterTooltip}" @mouseleave="${this.handleMouseLeaveTooltip}" @focusin="${this.handleMouseEnterTooltip}" @focusout="${this.handleMouseLeaveTooltip}" @slotchange="${this.handleSlotChange}" faceplate-popper-content> <slot name="content" @faceplate-track="${this.handleFaceplateTrack}"></slot> </div> `}}get content(){return this.contents[0]??null}get trigger(){return this.anchorEl??this.triggers[0]??null}get anchorEl(){try{if(this.anchor&&"string"==typeof this.anchor){return this.getRootNode().getElementById(this.anchor)}return this.anchor instanceof HTMLElement?this.anchor:null}catch{return null}}get referenceElement(){return this.trigger??this}setupAnchorElListeners(){const{anchorEl:e}=this;e&&(e.addEventListener("click",this.handleClick),e.addEventListener("touchstart",this.handleTouchstart),e.addEventListener("mouseenter",this.mouseOverTrigger),e.addEventListener("mouseleave",this.handleMouseleave),e.addEventListener("focusin",this.handleMouseenter),e.addEventListener("focusout",this.handleMouseleave))}cleanupAnchorElListeners(){const{anchorEl:e}=this;e&&(e.removeEventListener("click",this.handleClick),e.removeEventListener("touchstart",this.handleTouchstart),e.removeEventListener("mouseenter",this.mouseOverTrigger),e.removeEventListener("mouseleave",this.handleMouseleave),e.removeEventListener("focusin",this.handleMouseenter),e.removeEventListener("focusout",this.handleMouseleave))}hasUserInteraction(e){const t=Boolean(this.querySelector(":hover")||this.trigger?.matches(":hover")),s=Boolean(e&&(this.contains(e)||this.trigger?.contains(e))||this.querySelector(":focus")||this.trigger?.matches(":focus"));return t||s}hovercardShowHandler(e){e.target!==this&&this.close()}load(){return v(this).then(m(this._popperController.reposition)).then(m((e=>{this.hidden||e&&(this.focusManager?.refresh(),this.focusManager?.focus())})))}async show(){super.show(),this.partialLoading===e.Action&&this.load(),await this._popperController.currentState.animationFinished,this.focusManager?.focus(),this.addEventListener("focusout",this.handleFocusOut),document.addEventListener(this.emitter.eventId("open"),this.hovercardShowHandler),this.cleanupTimeouts()}async close(){const e=super.close();document.removeEventListener(this.emitter.eventId("open"),this.hovercardShowHandler),this.cleanupTimeouts(),await e,this.removeTrigger()}removeTrigger(){this.removeAttribute("trigger")}handleKeydown(){this.removeTrigger()}connectedCallback(){super.connectedCallback(),this.setupAnchorElListeners()}disconnectedCallback(){this.cleanupAnchorElListeners(),super.disconnectedCallback(),this.cleanupTimeouts()}static get styles(){return[...super.styles,l`:host{display:contents}#faceplate-tooltip{display:flex;flex-direction:column;width:fit-content;justify-content:flex-start;align-items:flex-start;box-sizing:border-box;border-radius:1rem;box-shadow:var(--elevation-md);z-index:var(--faceplate-hovercard-z-index,1)}#faceplate-tooltip::after{display:none}`]}};s([i({type:String})],g.prototype,"anchor",void 0),s([o({slot:""})],g.prototype,"triggers",void 0),s([o({slot:"content"})],g.prototype,"contents",void 0),s([i({type:Number,attribute:"enter-delay"})],g.prototype,"mouseEnterDelay",void 0),s([i({type:Number,attribute:"leave-delay"})],g.prototype,"mouseLeaveDelay",void 0),s([i({type:Boolean,attribute:"close-on-track"})],g.prototype,"closeOnTrack",void 0),s([i({type:Boolean,attribute:"disable-touch-activation",reflect:!0})],g.prototype,"disableTouchActivation",void 0),s([i({type:String,attribute:"partial-loading"})],g.prototype,"partialLoading",void 0),s([i({type:String})],g.prototype,"label",void 0),s([i({type:Boolean,attribute:"mouse-only"})],g.prototype,"mouseOnly",void 0),s([n()],g.prototype,"sleepAfterEscape",void 0),g=s([r("faceplate-hovercard")],g);var f=Object.freeze({__proto__:null,get FaceplateHovercard(){return g}});export{g as F,f,v as l,m as s};
